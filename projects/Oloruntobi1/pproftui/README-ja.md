# pproftui: ターミナルでのインタラクティブなGoプロファイリング

`pproftui` はGoの `pprof` のためのターミナルベースUIで、プロファイリングをインタラクティブに、直感的に、かつ高速にします。ブラウザのコンテキスト切り替えなしにパフォーマンス問題を特定し、プロファイリングの概念についての内蔵説明を提供するよう設計されています。

![Demo](https://raw.githubusercontent.com/Oloruntobi1/pproftui/main/./demo.gif)

---

## なぜ `pproftui` なのか？

標準の `go tool pprof` は強力ですが直感的ではないことがあります。よく次のように感じませんか？
*   「`flat` と `cum` は実際にはどう違うのか？」
*   「これら100のランタイム関数の中で*自分の*コードはどれ？」
*   「このバージョンと前のバージョンで何が変わったかどうやって見つける？」
*   「なぜブラウザとコードの間を何度も行き来しなければならないの？」

`pproftui` はこれらの問題を直接解決します：
*   **統合されたソース＆グラフビュー：** 任意の関数のソースコードを見たり、その呼び出しグラフをターミナルを離れずにナビゲートできます。
*   **自分のコードにフォーカス：** プロジェクトの関数を自動的にハイライト。`p`キーでランタイムやベンダーのノイズを即座に非表示に。
*   **強力で直感的な差分表示：** 2つのプロファイルを比較し、*何が*変わったかだけでなく、*なぜ*変わったかも把握。UIはコールスタックを通じて回帰の原因を追跡するのに役立ちます。
*   **ライブプロファイリング：** 実行中のサービスを `pproftui` に指定すると、そのプロファイルがリアルタイムで更新されます。
*   **内蔵ヘルプ（F1）：** プロファイリング用語（`cpu`、`inuse_space`、`flat` vs `cum`）の明確で簡単な説明を必要な時にすぐに得られます。

---

## はじめに

### インストール
```sh
go install github.com/Oloruntobi1/pproftui@latest
```

### クックブック：一般的なプロファイリングワークフロー

ここでは、`pproftui` を使った一般的なパフォーマンス問題の解決に役立つ実践的なレシピを紹介します。

#### レシピ1：ローカルバイナリの遅延調査
関数が遅いことに気づきました。CPUプロファイルを取得して調査しましょう。

1.  **プロファイルの生成：**
    ```sh
    go test -bench=. -cpuprofile=cpu.prof
    ```

2.  **`pproftui`で解析する：**
    ```sh
    pproftui cpu.prof
    ```
    *   ソースコードビューと呼び出し元／呼び出し先グラフの切り替えは `c` を押してください。
    *   プロファイルタイプの意味がわからない場合はいつでも `F1` を押してください。

#### レシピ 2: パフォーマンスの回帰を見つける（差分ワークフロー）
最近のコミットで動作が遅くなったと疑っています。`pproftui` の差分機能はその強みです。

1.  **`main` ブランチからプロファイルを取得します：**
    ```sh
    git checkout main
    go test -bench=. -cpuprofile=main.prof
    ```
2.  **フィーチャーブランチからプロファイルを取得する：**

    ```sh
    git checkout your-feature-branch
    go test -bench=. -cpuprofile=feature.prof
    ```
3.  **差分を取る:**

    ```sh
    pproftui main.prof feature.prof
    ```
    `pproftui` は現在、*デルタ* を表示します。緑色の (`+`) は `feature.prof` でより多くのリソースが使用されたことを意味し、赤色の (`-`) はより少ないことを意味します。これを使ってグラフをナビゲートし、新たなオーバーヘッドをもたらした正確な関数を見つけてください。

#### レシピ 3: ライブサービスのプロファイリング
ステージング環境でロード時のアプリケーションの挙動を確認したい場合。

1.  **アプリが pprof エンドポイントを公開していることを確認します。**（例：`net/http/pprof` をインポートする）
2.  **ライブモードで `pproftui` を実行します：**
    ```sh
    # This will fetch a 5-second CPU profile every 10 seconds.
    pproftui -live="http://localhost:6060/debug/pprof/profile?seconds=5" -refresh=10s
    ```
    *   ライブアップデートの一時停止と再開は `space` キーを押してください。

#### レシピ4: ノイズを切り抜ける
プロファイルはランタイムやライブラリのコードでいっぱいです。重要なのは、**あなたのコード**に焦点を当てることです。

```sh
# Provide your project's go module path
pproftui --module-path="github.com/your/project" cpu.prof
```
*   プロジェクトの関数は `★` でマークされます。
*   `p` を押すと「プロジェクトのみ」モードが切り替わり、それ以外を即座に非表示にします。

---

## キーバインド

| キー         | 動作                                                   |
| :---------- | :---------------------------------------------------- |
| `↑`/`↓`     | 関数リストをナビゲート                                |
| `t`         | プロファイルタイプを切り替え（`inuse_space`、`alloc_objects`） |
| `c`         | **c**ode と **c**all グラフビューを切り替え           |
| `p`         | **p**roject-only コードフィルターを切り替え            |
| `s`         | **s**ort 順序を切り替え（`Self`、`Total`、`Name`）     |
| `f`         | **f**lame グラフビューを切り替え                      |
| `Enter`     | *フレームグラフ内:* 選択した関数をズームイン            |
| `Esc`       | *フレームグラフ内:* ズームアウト                      |
| `F1`        | 詳細な **help** と説明を表示                           |
| `q` / `ctrl+c`| **Q**uit（終了）                                     |


---

## ライセンス

MIT

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-09-09

---