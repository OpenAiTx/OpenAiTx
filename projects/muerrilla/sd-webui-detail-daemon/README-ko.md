
# 디테일 데몬
이것은 [Stable Diffusion Web UI](https://github.com/AUTOMATIC1111/stable-diffusion-webui)를 위한 확장 기능으로, 사용자가 샘플링 단계 동안 이미지의 디테일/부드러움 정도를 조정할 수 있게 해줍니다.

LORA, ControlNet 등을 사용하지 않으며, 그 결과 특정 스타일에 편향되지 않고 생성 과정에 새로운 스타일적 혹은 의미적 특성을 도입하지 않습니다. 이는 어떤 모델이나 이미지 유형에도 작동할 수 있음을 의미합니다.

<sub>*모델: SSD-1B*<br></sub>
![a close up portrait of a cyberpunk knight-1Lv-0](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/561c33d9-9a5d-4cfc-bee8-de9126b280c1)
*왼쪽: 디테일 감소, 가운데: 원본, 오른쪽: 디테일 증가*<br>

<sub>*모델: SD 1.5 (파인튜닝됨)*<br></sub>
![face of a cute cat love heart symbol-Zn6-0](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/9fbfb39f-81fb-4951-8f32-20eab410020a)
*왼쪽: 디테일 감소, 가운데: 원본, 오른쪽: 디테일 증가*<br>

## 작동 원리
디테일 데몬은 사용자 정의 가능한 스케줄에 따라 매 샘플링 단계에서 원래 노이즈 레벨을 조작하여 작동합니다.

### 이론적 배경
노이즈 레벨(시그마, 즉 노이즈의 표준 편차)은 모델에게 각 디노이징 단계에서 예상하고 제거해야 할 노이즈 양을 알려줍니다. 특정 단계에서 시그마 값이 높으면 모델은 해당 단계에서 더 적극적으로 노이즈를 제거하려 하고, 반대의 경우 덜 제거하려 합니다.

일반적인 시그마 스케줄에서는 디노이징 과정 초반에 시그마 값이 매우 높다가 중간에 급격히 낮아지고, 과정 끝무렵에는 매우 낮은 값이 됩니다. 이 곡선(타임스텝 스케줄과 함께, 그러나 그것은 나중에 이야기할 주제입니다)이 이미지의 큰 특징(저주파)이 초반 단계에서 정의되고, 과정 끝에는 작은 특징(고주파)에서만 미세한 변화가 일어나도록 만듭니다. 이 부분은 나중에 다시 다루겠습니다.

이제 원본보다 낮은 시그마 값 스케줄을 모델에 전달하면, 각 단계에서 모델은 덜 디노이징하고 그 단계에서 더 노이즈가 많은 잠재 공간을 출력합니다. 그러나 이후 단계에서 모델은 이 추가 노이즈를 이해하고 이미지 특징으로 변환하려 최선을 다합니다. 따라서 이론상 *적당히 할 경우* 더 디테일한 이미지를 얻을 수 있습니다. 너무 강하게 하면 모델이 추가된 노이즈를 처리하지 못해 최종 결과가 순수 노이즈로 변질됩니다. 그러므로 적당함이 중요합니다.

### 그러나 실제로는
적당함만으로는 한계가 있습니다! 그리고 저게 뭐야? 아래 예시들이 보여주듯, 이미지에 너무 많은 디테일을 추가하려 하면 이미지가 깨지거나 전혀 다른 것으로 변합니다.

<sub>*SD 1.5*<br></sub>
![Modesty](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/2f011a28-0948-48f8-b171-350add6fdd67)
원본 시그마 (왼쪽) 에 0.9, 0.85, 0.8 곱함<br>

<sub>*SDXL*<br></sub>
![1](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/eff2356e-a6dd-4a4e-9c7e-861dec7713eb)
원본 시그마 (왼쪽) 에 0.95, 0.9, 0.85, 0.875, 0.8 곱함<br>

그 이유는:
1. 우리는 계속해서 노이즈를 추가하지만 모델이 그것을 처리할 충분한 시간을 주지 않고,
2. 이미지의 저주파 특징(색상, 구성 등)이 정의되는 초기 단계를 조작하기 때문입니다.

### 스케줄 도입
일반적으로 "디테일"이라 할 때는 중고주파 영역에 속하며, 이는 샘플링 과정의 중후반 단계에 해당합니다. 따라서 초기 단계를 건너뛰어 이미지의 주요 특징을 그대로 두고, 후반 단계를 남겨 모델이 추가 노이즈를 유용한 디테일로 변환할 시간을 주면 아래와 같은 스케줄을 만들 수 있습니다:

![3](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/cd47e882-8b56-4321-8c47-c0d689562780)

그리고 스케줄을 좀 더 정교하게 만들어 크기가 다른 디테일에 대응하는 특정 단계를 타겟팅할 수도 있습니다:

![4](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/ea5027d2-3359-4733-afb4-5ae4a1218f38)

어떤 단계가 어떤 주파수 범위에 해당하는지는 사용하는 모델, 샘플러, 프롬프트(특히 프롬프트 편집 등 사용 시), 그리고 아마도 여러 다른 요소에 따라 다릅니다. 또한 시그마를 너무 낮게 설정해 많은 노이즈를 추가했다가 다시 높여서 과잉 노이즈를 정리하고 멋진 디테일을 남기는 등, 스케줄로 할 수 있는(그리고 해야 하는) 더 정교한 작업들도 있습니다. 따라서 생성하는 각 이미지 또는 디테일 수준 조정이 필요한 이미지에 최적의 스케줄을 찾기 위해 조정이 필요합니다. 이상적으로는 모든 이미지에 완벽한 디테일 조정 스케줄을 만들기 위해 수많은 시간을 투자해야 합니다. 그것이 바로 우리가 이곳에 있는 이유입니다.

곧 다양한 시나리오에 대응하는 구체적인 예제와 제가 생각해낸 기법들을 제공할 예정입니다. (자기 메모: 이 내용을 위키 페이지로 옮기기)

## 설치 방법
SD WebUI를 열고 > Extensions 탭으로 이동 > Available 탭으로 이동 > Load from: 클릭 > Detail Daemon 찾아 설치

또는 Install from URL 탭으로 가서 > 이 저장소의 URL을 첫 번째 입력란에 붙여넣고 > 설치 클릭

또는 WebUI 폴더로 가서 수동으로 이 저장소를 extensions 폴더에 클론:

`git clone "https://github.com/muerrilla/sd-webui-detail-daemon" extensions/sd-webui-detail-daemon`

## 시작하기
설치 후 txt2img 및 img2img 탭에서 확장 기능을 찾을 수 있습니다.
![2024-07-08 01_43_21-011366](https://github.com/muerrilla/sd-webui-detail-daemon/assets/48160881/045574cb-465c-4991-83c4-d02f803a330b)
### 슬라이더:
슬라이더(및 체크박스 하나)는 조정량(양수 → 디테일 추가, 음수 → 디테일 감소)과 적용할 샘플링 단계(즉, 스케줄)를 설정합니다. 그래프의 X축은 (0,1) 범위로 정규화된 샘플링 단계이고, Y축은 조정량입니다. 나머지는 설명이 필요 없을 정도로 직관적입니다. 그냥 드래그하며 그래프 변화를 보세요.
### 숫자 입력:
아래 세 숫자 입력란은 때때로 슬라이더의 최대/최소 한계가 너무 제한적일 때 사용하도록 제공됩니다.
### 모드:
`cond`와 `uncond` 모드는 각각 해당 잠재 공간에만 영향을 주며, `both`는 둘 다에 영향을 줍니다(당연하죠!). `cond`와 `uncond` 모드는 강도가 낮고, 다른 잠재 공간이 그대로 유지되므로 더 이른 단계에서도 원본 생성과 크게 벗어나지 않는 변화를 허용합니다.

약간의 꼬임도 있습니다: `both` 모드에서 `detail amount`가 양수일 때, cond와 uncond 잠재 공간 모두 더 디테일해집니다. 따라서 더 디테일한 cond 잠재 공간은 생성물을 더 디테일하게 만들려 하고, 더 디테일한 uncond 잠재 공간은 디테일을 줄이려 시도합니다. 이로 인해 이 모드에서는 이미지에 더 많은 새로운 특징/아티팩트가 나타납니다.

### 팁:
가능한 한 빨리 최적의 매개변수 설정법에 관한 정식 문서를 작성할 예정입니다. 지금은 슬라이더를 조작하며 스케줄 모양이 이미지에 어떻게 영향을 주는지 직접 경험해 보세요. 라이브 미리보기 업데이트 주기를 매 프레임 또는 두 프레임마다로 설정해, 샘플링 과정 각 단계에서 무슨 일이 일어나는지, 디테일 데몬이 어떻게 영향을 주는지 명확히 볼 수 있도록 하는 것을 추천합니다.

## 참고 사항:
- Compositional Diffusion(즉, AND 구문)을 제대로 지원하지 않습니다. 특히 배치 크기가 1 초과이거나 프롬프트에 음수 가중치가 있을 때, 모드가 `cond` 또는 `uncond`로 설정되어 있으면 그렇습니다.
- 적은 단계 모델(Turbo, Lightning 등)과는 사용이 불가능하거나 매우 어렵습니다. 수정: 관리 가능합니다.
- Forge와 함께 작동합니다(`cond`와 `uncond` 모드는 지원되지 않음).
- AlignYourSteps, FreeU 등과는 다릅니다.
- Haoming의 [ReSharpen Extension](https://github.com/Haoming02/sd-webui-resharpen)과 비슷한 목적을 가졌으나(방법은 다름) 유사합니다.



---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-23

---