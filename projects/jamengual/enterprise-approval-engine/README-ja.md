# ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ‰¿èªã‚¨ãƒ³ã‚¸ãƒ³

[![en](https://img.shields.io/badge/lang-en-blue.svg)](README.md)
[![es](https://img.shields.io/badge/lang-es-yellow.svg)](ES/README.md)

ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã®é–¾å€¤ï¼ˆNäººä¸­Xäººï¼‰ã«ã‚ˆã‚‹ãƒãƒªã‚·ãƒ¼ãƒ™ãƒ¼ã‚¹ã®æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®ORãƒ­ã‚¸ãƒƒã‚¯ã€ãŠã‚ˆã³è‡ªå‹•ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚¿ã‚°ä½œæˆã‚’å‚™ãˆãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘GitHubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚

## æ©Ÿèƒ½

- **æŸ”è»Ÿãªæ‰¿èªãƒ­ã‚¸ãƒƒã‚¯**ï¼šã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®ANDï¼ˆå…¨å“¡æ‰¿èªï¼‰ãŠã‚ˆã³é–¾å€¤ï¼ˆNäººä¸­Xäººï¼‰ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ
- **ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®ORãƒ­ã‚¸ãƒƒã‚¯**ï¼šè¤‡æ•°ã®æ‰¿èªçµŒè·¯ - ã„ãšã‚Œã‹ã®ã‚°ãƒ«ãƒ¼ãƒ—ãŒè¦ä»¶ã‚’æº€ãŸã›ã°æ‰¿èª
- **æ··åˆæ‰¿èªè€…**ï¼šåŒã˜ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§å€‹äººãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨GitHubãƒãƒ¼ãƒ ã‚’çµ„ã¿åˆã‚ã›å¯èƒ½
- **æ®µéšçš„ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**ï¼šå˜ä¸€ã®èª²é¡Œã§è¤‡æ•°ç’°å¢ƒï¼ˆdev â†’ qa â†’ stage â†’ prodï¼‰ã‚’è¿½è·¡
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å¯è¦–åŒ–**ï¼šãƒ‡ãƒ—ãƒ­ã‚¤é€²è¡ŒçŠ¶æ³ã‚’ç¤ºã™è‰²åˆ†ã‘ã•ã‚ŒãŸMermaidãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆå›³
- **ã‚µãƒ–èª²é¡Œã«ã‚ˆã‚‹æ‰¿èª**ï¼šå„ã‚¹ãƒ†ãƒ¼ã‚¸å°‚ç”¨ã®æ‰¿èªã‚µãƒ–èª²é¡Œã‚’ä½œæˆã—ã€æ‰¿èªæ™‚ã«ã‚¯ãƒ­ãƒ¼ã‚º
- **å¼·åŒ–ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆUX**ï¼šæ‰¿èªã‚³ãƒ¡ãƒ³ãƒˆã¸ã®çµµæ–‡å­—ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚³ãƒãƒ³ãƒ‰å‚ç…§ä»˜ãã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- **èª²é¡Œã‚¯ãƒ­ãƒ¼ã‚ºä¿è­·**ï¼šæ¨©é™ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰¿èªèª²é¡Œã®ã‚¯ãƒ­ãƒ¼ã‚ºã‚’é˜²æ­¢ï¼ˆè‡ªå‹•å†ã‚ªãƒ¼ãƒ—ãƒ³ï¼‰
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ‰¿èªãƒ¢ãƒ¼ãƒ‰**ï¼šãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¾ãŸã¯ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«ã‚³ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã¨ã‚µãƒ–èª²é¡Œæ‰¿èªã‚’æ··åœ¨
- **PRãŠã‚ˆã³ã‚³ãƒŸãƒƒãƒˆè¿½è·¡**ï¼šãƒ‡ãƒ—ãƒ­ã‚¤èª²é¡Œã«PRã¨ã‚³ãƒŸãƒƒãƒˆã‚’è‡ªå‹•ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãƒªãƒªãƒ¼ã‚¹ç®¡ç†
- **ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ä½œæˆ**ï¼šæ‰¿èªæ™‚ã«è‡ªå‹•ã§gitã‚¿ã‚°ã‚’ä½œæˆ
- **ãƒãƒªã‚·ãƒ¼ãƒ™ãƒ¼ã‚¹è¨­å®š**ï¼šYAMLã§å†åˆ©ç”¨å¯èƒ½ãªæ‰¿èªãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©
- **èª²é¡Œãƒ™ãƒ¼ã‚¹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ï¼šGitHubèª²é¡Œã‚’é€šã˜ãŸé€æ˜ãªç›£æŸ»è¨¼è·¡
- **Jiraçµ±åˆ**ï¼šã‚³ãƒŸãƒƒãƒˆã‹ã‚‰èª²é¡Œã‚­ãƒ¼ã‚’æŠ½å‡ºã—æ‰¿èªèª²é¡Œã«è¡¨ç¤ºã€Fix Versionsã‚’æ›´æ–°
- **ãƒ‡ãƒ—ãƒ­ã‚¤è¿½è·¡**ï¼šãƒ‡ãƒ—ãƒ­ã‚¤ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å¯è¦–åŒ–ã™ã‚‹ãŸã‚GitHubãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
- **å¤–éƒ¨è¨­å®š**ï¼šæ‰¿èªãƒãƒªã‚·ãƒ¼ã‚’å…±æœ‰ãƒªãƒã‚¸ãƒˆãƒªã§é›†ä¸­ç®¡ç†
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™å‡¦ç†**ï¼šGitHub APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«å¯¾ã—æŒ‡æ•°çš„ãƒãƒƒã‚¯ã‚ªãƒ•ã§è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
- **GitHub Enterprise Serverå¯¾å¿œ**ï¼šGHESç’°å¢ƒã‚’å®Œå…¨ã‚µãƒãƒ¼ãƒˆ
- **å¤–éƒ¨ä¾å­˜ãªã—**ï¼šç´”ç²‹ãªGitHub Actionsã§å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä¸è¦

ğŸ“‹ **å‹•ä½œä¾‹ã¯ã“ã¡ã‚‰ï¼š** [æ‰¿èªèª²é¡Œã®ä¾‹](https://github.com/jamengual/enterprise-approval-engine/issues/7)

## ç›®æ¬¡

- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#quick-start)
- [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#action-reference)
  - [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³](#actions)
  - [å…¥åŠ›](#inputs)
  - [å‡ºåŠ›](#outputs)
- [è¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#configuration-reference)
  - [ãƒãƒªã‚·ãƒ¼](#policies)
  - [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#workflows)
  - [ã‚¿ã‚°ä»˜ã‘](#tagging-configuration)
  - [ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](#custom-issue-templates)
  - [ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ](#defaults)
  - [ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°](#semver)
- [å®Œå…¨ãªè¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#complete-configuration-reference)
- [æ©Ÿèƒ½ã®è©³ç´°](#feature-details)
  - [æ‰¿èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰](#approval-keywords)
  - [ãƒãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆ](#team-support)
  - [æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#progressive-deployment-pipelines)
  - [ãƒªãƒªãƒ¼ã‚¹å€™è£œæˆ¦ç•¥](#release-candidate-strategies)
  - [Jiraçµ±åˆ](#jira-integration)
  - [ãƒ‡ãƒ—ãƒ­ã‚¤è¿½è·¡](#deployment-tracking)
  - [å¤–éƒ¨è¨­å®šãƒªãƒã‚¸ãƒˆãƒª](#external-config-repository)
  - [æ‰¿èªã®ãƒ–ãƒ­ãƒƒã‚¯](#blocking-approvals)
  - [ã‚¿ã‚°å‰Šé™¤](#tag-deletion-on-issue-close)
- [å®Œå…¨ãªä¾‹](#complete-examples)
- [ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼](#schema-validation)
- [GitHub Enterprise Server](#github-enterprise-server)

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. è¨­å®šã®ä½œæˆ

ãƒªãƒã‚¸ãƒˆãƒªå†…ã« `.github/approvals.yml` ã‚’ä½œæˆã—ã¦ãã ã•ã„:

```yaml
version: 1

policies:
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2

  platform-team:
    approvers: [team:platform-engineers]
    require_all: true

workflows:
  production-deploy:
    require:
      # OR logic: either path satisfies approval
      - policy: dev-team        # 2 of 3 developers
      - policy: platform-team   # ALL platform engineers
    on_approved:
      create_tag: true
      close_issue: true
```

### 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

`.github/workflows/request-approval.yml` ã‚’ä½œæˆã—ã¾ã™ï¼š

```yaml
name: Request Deployment Approval

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy (e.g., v1.2.3)'
        required: true
        type: string

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Output Results
        run: |
          echo "Issue: ${{ steps.approval.outputs.issue_url }}"
          echo "Status: ${{ steps.approval.outputs.status }}"
```

### 3. æ‰¿èªã‚³ãƒ¡ãƒ³ãƒˆã®å‡¦ç†

`.github/workflows/handle-approval.yml` ã‚’ä½œæˆã—ã¾ã™:

```yaml
name: Handle Approval Comments

on:
  issue_comment:
    types: [created]

jobs:
  process:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Trigger Deployment
        if: steps.process.outputs.status == 'approved'
        run: |
          echo "Approved by: ${{ steps.process.outputs.approvers }}"
          echo "Tag created: ${{ steps.process.outputs.tag }}"
```

---

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€`action` å…¥åŠ›ã‚’é€šã˜ã¦4ã¤ã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ï¼š

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|--------|-------------|-------------|
| `request` | æ–°ã—ã„æ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ä½œæˆã™ã‚‹ | ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ãƒªãƒªãƒ¼ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹å§‹æ™‚ |
| `process-comment` | æ‰¿èªãƒ»æ‹’å¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹ | `issue_comment` ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ |
| `check` | ç¾åœ¨ã®æ‰¿èªçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ | æ‰¿èªå®Œäº†ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ |
| `close-issue` | ã‚¤ã‚·ãƒ¥ãƒ¼ã®ã‚¯ãƒ­ãƒ¼ã‚ºã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹ | `issues: [closed]` ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ |

### å…¥åŠ›

#### ã‚³ã‚¢å…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `action` | å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š`request`, `check`, `process-comment`, `close-issue` | ã¯ã„ | - |
| `workflow` | è¨­å®šã‹ã‚‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åï¼ˆ`request` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ï¼‰ | `request` ã®å ´åˆ | - |
| `version` | ã‚¿ã‚°ä½œæˆç”¨ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹ï¼š`1.2.3` ã¾ãŸã¯ `v1.2.3`ï¼‰ | ã„ã„ãˆ | - |
| `issue_number` | ã‚¤ã‚·ãƒ¥ãƒ¼ç•ªå·ï¼ˆ`check`, `process-comment`, `close-issue` ç”¨ï¼‰ | check/process/close ã®å ´åˆ | - |
| `token` | APIæ“ä½œç”¨GitHubãƒˆãƒ¼ã‚¯ãƒ³ | ã¯ã„ | - |

#### è¨­å®šå…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `config_path` | approvals.ymlè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ | ã„ã„ãˆ | `.github/approvals.yml` |
| `config_repo` | å…±æœ‰è¨­å®šç”¨ã®å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªï¼ˆä¾‹ï¼š`org/.github`ï¼‰ | ã„ã„ãˆ | - |

#### ãƒãƒ¼ãƒªãƒ³ã‚°å…¥åŠ›ï¼ˆ`check`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ï¼‰

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `wait` | ã™ãã«æˆ»ã‚‰ãšæ‰¿èªå®Œäº†ã¾ã§å¾…ã¤ï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰ | ã„ã„ãˆ | `false` |
| `timeout` | å¾…æ©Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆä¾‹ï¼š`24h`ã€`1h30m`ã€`30m`ï¼‰ | ã„ã„ãˆ | `72h` |

#### ãƒãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆå…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `app_id` | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯ç”¨ã®GitHubã‚¢ãƒ—ãƒªID | ã„ã„ãˆ | - |
| `app_private_key` | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯ç”¨ã®GitHubã‚¢ãƒ—ãƒªç§˜å¯†éµ | ã„ã„ãˆ | - |

#### Jiraçµ±åˆå…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `jira_base_url` | Jira Cloudã®ãƒ™ãƒ¼ã‚¹URLï¼ˆä¾‹ï¼š`https://yourcompany.atlassian.net`ï¼‰ | ã„ã„ãˆ | - |
| `jira_user_email` | APIèªè¨¼ç”¨ã®Jiraãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | ã„ã„ãˆ | - |
| `jira_api_token` | èªè¨¼ç”¨ã®Jira APIãƒˆãƒ¼ã‚¯ãƒ³ | ã„ã„ãˆ | - |
| `jira_update_fix_version` | æ‰¿èªæ™‚ã«Fix Versionã§Jiraèª²é¡Œã‚’æ›´æ–°ã™ã‚‹ã‹ | ã„ã„ãˆ | `true` |
| `include_jira_issues` | æ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ¬æ–‡ã«Jiraèª²é¡Œã‚’å«ã‚ã‚‹ã‹ | ã„ã„ãˆ | `true` |

#### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°å…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `create_deployment` | ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ç”¨ã«GitHubãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã‹ | ã„ã„ãˆ | `true` |
| `deployment_environment` | å¯¾è±¡ç’°å¢ƒï¼ˆä¾‹ï¼š`production`ã€`staging`ï¼‰ | ã„ã„ãˆ | `production` |
| `deployment_environment_url` | ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ç’°å¢ƒã®URL | ã„ã„ãˆ | - |

#### ãã®ä»–ã®å…¥åŠ›

| å…¥åŠ› | èª¬æ˜ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-------|-------------|----------|---------|
| `issue_action` | `close-issue`ç”¨ã®Issueã‚¤ãƒ™ãƒ³ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`closed`ã€`reopened`ï¼‰ | ã„ã„ãˆ | - |
| `previous_tag` | ã‚³ãƒŸãƒƒãƒˆæ¯”è¼ƒå¯¾è±¡ã®å‰ã®ã‚¿ã‚°ï¼ˆæŒ‡å®šãŒãªã„å ´åˆã¯è‡ªå‹•æ¤œå‡ºï¼‰ | ã„ã„ãˆ | - |

### å‡ºåŠ›

#### ã‚³ã‚¢å‡ºåŠ›

| å‡ºåŠ› | èª¬æ˜ | åˆ©ç”¨å¯èƒ½å¯¾è±¡ |
|--------|-------------|---------------|
| `status` | æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š`pending`ã€`approved`ã€`denied`ã€`timeout`ã€`tag_deleted`ã€`skipped` | ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `issue_number` | ä½œæˆã¾ãŸã¯ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸèª²é¡Œç•ªå· | ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `issue_url` | æ‰¿èªèª²é¡Œã®URL | ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |

#### æ‰¿èªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

| å‡ºåŠ› | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|-------------|---------------|
| `approvers` | æ‰¿èªã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒªã‚¹ãƒˆ | `process-comment`ã€`check` |
| `denier` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‹’å¦ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ | `process-comment`ã€`check` |
| `satisfied_group` | æ‰¿èªæ¡ä»¶ã‚’æº€ãŸã—ãŸã‚°ãƒ«ãƒ¼ãƒ—å | `process-comment`ã€`check` |
| `tag` | ä½œæˆã•ã‚ŒãŸã‚¿ã‚°å | `process-comment`ï¼ˆæ‰¿èªæ™‚ï¼‰ |
| `tag_deleted` | å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚° | `close-issue` |

#### Jira ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

| å‡ºåŠ› | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|-------------|---------------|
| `jira_issues` | æœ¬ãƒªãƒªãƒ¼ã‚¹ã«å«ã¾ã‚Œã‚‹Jiraèª²é¡Œã‚­ãƒ¼ã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒªã‚¹ãƒˆ | `request` |
| `jira_issues_json` | Jiraèª²é¡Œã®è©³ç´°ï¼ˆã‚­ãƒ¼ã€æ¦‚è¦ã€ã‚¿ã‚¤ãƒ—ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ã‚’å«ã‚€JSONé…åˆ— | `request` |

#### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

| å‡ºåŠ› | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|-------------|---------------|
| `deployment_id` | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ç”¨ã®GitHubãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆID | `request` |
| `deployment_url` | GitHubä¸Šã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆURL | `request` |

#### ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

| å‡ºåŠ› | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|-------------|---------------|
| `release_notes` | ã‚³ãƒŸãƒƒãƒˆã¨Jiraèª²é¡Œã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ | `request` |
| `commits_count` | æœ¬ãƒªãƒªãƒ¼ã‚¹ã®ã‚³ãƒŸãƒƒãƒˆæ•° | `request` |

---

## è¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ãƒãƒªã‚·ãƒ¼

ãƒãƒªã‚·ãƒ¼ã¯å†åˆ©ç”¨å¯èƒ½ãªæ‰¿èªè€…ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®šç¾©ã—ã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯2ã¤ã‚ã‚Šã¾ã™ï¼š

#### ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```yaml
policies:
  # Threshold-based: X of N must approve
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2

  # All must approve (AND logic)
  security:
    approvers: [team:security, security-lead]
    require_all: true

  # Mixed teams and individuals
  production:
    approvers:
      - team:sre
      - tech-lead
      - product-owner
    min_approvals: 2
```

#### é«˜åº¦ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆã‚½ãƒ¼ã‚¹ã”ã¨ã®ã—ãã„å€¤ï¼‰

ã€Œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰2ã¤ã‹ã¤ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‹ã‚‰1ã¤ã€ã®ã‚ˆã†ãªè¤‡é›‘ãªè¦ä»¶ã®å ´åˆï¼š

```yaml
policies:
  # Complex AND gate
  production-gate:
    from:
      - team: platform-engineers
        min_approvals: 2        # 2 of the platform team
      - team: security
        min_approvals: 1        # 1 of the security team
      - user: alice             # alice must also approve
    logic: and                  # ALL sources must be satisfied

  # Flexible OR gate
  flexible-review:
    from:
      - team: security
        require_all: true       # All security team
      - team: platform
        min_approvals: 2        # OR 2 platform members
    logic: or                   # ANY source is enough

  # Executive approval: any one exec
  exec-approval:
    from:
      - user: ceo
      - user: cto
      - user: vp-engineering
    logic: or

  # User list with threshold
  leads:
    from:
      - users: [tech-lead, product-lead, design-lead]
        min_approvals: 2
```

**ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼š**

- `team: slug` - GitHubãƒãƒ¼ãƒ ï¼ˆAppãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ï¼‰
- `user: username` - å˜ä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆæš—é»™çš„ã«require_allï¼‰
- `users: [a, b, c]` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆ

**ãƒãƒªã‚·ãƒ¼ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼š**

- `logic: and` - ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- `logic: or` - ã„ãšã‚Œã‹ã®ã‚½ãƒ¼ã‚¹ã‚’æº€ãŸã›ã°ååˆ†

#### ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆAND/ORã®æ··åˆï¼‰

è¤‡é›‘ãªå¼ã®å ´åˆã€å„ã‚½ãƒ¼ã‚¹ã«`logic:`ã‚’ä½¿ç”¨ã—ã¦æ¬¡ã®ã‚½ãƒ¼ã‚¹ã¨ã®æ¥ç¶šæ–¹æ³•ã‚’æŒ‡å®šï¼š

```yaml
policies:
  # (2 security AND 2 platform) OR alice
  complex-gate:
    from:
      - team: security
        min_approvals: 2
        logic: and              # AND with next source
      - team: platform
        min_approvals: 2
        logic: or               # OR with next source
      - user: alice            # alice alone can satisfy

  # (security AND platform) OR (alice AND bob) OR manager
  multi-path:
    from:
      - team: security
        min_approvals: 1
        logic: and
      - team: platform
        min_approvals: 1
        logic: or               # End first AND group
      - user: alice
        logic: and
      - user: bob
        logic: or               # End second AND group
      - user: manager          # Third path
```

**æ¼”ç®—å­ã®å„ªå…ˆé †ä½:** AND ã¯ OR ã‚ˆã‚Šã‚‚çµåˆåŠ›ãŒå¼·ã„ï¼ˆæ¨™æº–çš„ãªãƒ–ãƒ¼ãƒ«è«–ç†ï¼‰ã€‚

å¼ `A and B or C and D` ã¯ `(A AND B) OR (C AND D)` ã¨è©•ä¾¡ã•ã‚Œã¾ã™ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯æ‰¿èªè¦ä»¶ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¾ã™ï¼š

```yaml
workflows:
  my-workflow:
    description: "Optional description"

    # Trigger conditions (for filtering)
    trigger:
      environment: production

    # Approval requirements (OR logic between items)
    require:
      - policy: dev-team
      - policy: security
      # Or inline approvers:
      - approvers: [alice, bob]
        require_all: true

    # Issue configuration
    issue:
      title: "Approval: {{version}}"
      body: |                          # Inline custom template (optional)
        ## My Custom Approval Issue
        Version: {{.Version}}
        Requested by: @{{.Requestor}}
        {{.GroupsTable}}
      body_file: "templates/my-template.md"  # Or load from file
      labels: [production, deploy]
      assignees_from_policy: true

    # Actions on approval
    on_approved:
      create_tag: true
      tag_prefix: "v"  # Creates v1.2.3
      close_issue: true
      comment: "Approved! Tag {{version}} created."

    # Actions on denial
    on_denied:
      close_issue: true
      comment: "Denied by {{denier}}."

    # Actions when issue is manually closed
    on_closed:
      delete_tag: true   # Delete the tag if issue is closed
      comment: "Deployment cancelled. Tag {{tag}} deleted."
```

### ã‚¿ã‚®ãƒ³ã‚°è¨­å®š

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã”ã¨ã«ã‚¿ã‚°ã®ä½œæˆæ–¹æ³•ã‚’åˆ¶å¾¡ã—ã¾ã™:

```yaml
workflows:
  dev-deploy:
    require:
      - policy: dev-team
    on_approved:
      tagging:
        enabled: true
        start_version: "0.1.0"      # No 'v' prefix, start at 0.1.0
        auto_increment: patch        # Auto-bump: 0.1.0 -> 0.1.1 -> 0.1.2
        env_prefix: "dev-"           # Creates: dev-0.1.0, dev-0.1.1

  staging-deploy:
    require:
      - policy: qa-team
    on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # 'v' prefix (inferred from start_version)
        auto_increment: minor        # v1.0.0 -> v1.1.0 -> v1.2.0
        env_prefix: "staging-"       # Creates: staging-v1.0.0

  production-deploy:
    require:
      - policy: prod-team
    on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # Manual version required (no auto_increment)
```
**ã‚¿ã‚°ä»˜ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|--------|-------------|
| `enabled` | ã‚¿ã‚°ä½œæˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ |
| `start_version` | é–‹å§‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨å½¢å¼ï¼ˆä¾‹ï¼š"v1.0.0" ã¾ãŸã¯ "1.0.0"ï¼‰ |
| `prefix` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¥é ­è¾ï¼ˆæœªè¨­å®šã®å ´åˆã¯ `start_version` ã‹ã‚‰æ¨æ¸¬ï¼‰ |
| `auto_increment` | è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼š`major`ã€`minor`ã€`patch`ã€ã¾ãŸã¯æ‰‹å‹•ã®å ´åˆã¯çœç•¥ |
| `env_prefix` | ç’°å¢ƒæ¥é ­è¾ï¼ˆä¾‹ï¼š"dev-" ã¯ "dev-v1.0.0" ã‚’ä½œæˆï¼‰ |

### ã‚«ã‚¹ã‚¿ãƒ èª²é¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

Goãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦èª²é¡Œæœ¬æ–‡ã‚’å®Œå…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¯ `body`ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€å ´åˆã¯ `body_file` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**åˆ©ç”¨å¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°:**

| å¤‰æ•° | èª¬æ˜ |
|----------|-------------|
| `{{.Title}}` | èª²é¡Œã‚¿ã‚¤ãƒˆãƒ« |
| `{{.Description}}` | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ |
| `{{.Version}}` | ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| `{{.Requestor}}` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸGitHubãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| `{{.Environment}}` | ç’°å¢ƒå |
| `{{.RunURL}}` | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã¸ã®ãƒªãƒ³ã‚¯ |
| `{{.RepoURL}}` | ãƒªãƒã‚¸ãƒˆãƒªURL |
| `{{.CommitSHA}}` | å®Œå…¨ãªã‚³ãƒŸãƒƒãƒˆSHA |
| `{{.CommitURL}}` | ã‚³ãƒŸãƒƒãƒˆã¸ã®ãƒªãƒ³ã‚¯ |
| `{{.Branch}}` | ãƒ–ãƒ©ãƒ³ãƒå |
| `{{.GroupsTable}}` | äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿æ‰¿èªçŠ¶æ…‹ãƒ†ãƒ¼ãƒ–ãƒ« |
| `{{.Timestamp}}` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— |
| `{{.PreviousVersion}}` | ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ã‚¿ã‚° |
| `{{.CommitsCount}}` | ã“ã®ãƒªãƒªãƒ¼ã‚¹ã®ã‚³ãƒŸãƒƒãƒˆæ•° |
| `{{.HasJiraIssues}}` | ãƒ–ãƒ¼ãƒ«å€¤ - Jiraèª²é¡Œã®æœ‰ç„¡ |
| `{{.JiraIssues}}` | Jiraèª²é¡Œãƒ‡ãƒ¼ã‚¿ã®é…åˆ— |
| `{{.JiraIssuesTable}}` | äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿Jiraèª²é¡Œãƒ†ãƒ¼ãƒ–ãƒ« |
| `{{.PipelineTable}}` | äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ« |
| `{{.PipelineMermaid}}` | äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿Mermaidãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆå›³ |
| `{{.Vars.key}}` | ã‚«ã‚¹ã‚¿ãƒ å¤‰æ•° |


**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢æ•°:**

| é–¢æ•° | ä¾‹ | èª¬æ˜ |
|----------|---------|-------------|
| `slice` | `{{slice .CommitSHA 0 7}}` | ã‚µãƒ–ã‚¹ãƒˆãƒªãƒ³ã‚°ï¼ˆçŸ­ç¸®SHAï¼‰ |
| `title` | `{{.Environment \| title}}` | ã‚¿ã‚¤ãƒˆãƒ«ã‚±ãƒ¼ã‚¹ |
| `upper` | `{{.Version \| upper}}` | å¤§æ–‡å­—å¤‰æ› |
| `lower` | `{{.Version \| lower}}` | å°æ–‡å­—å¤‰æ› |
| `join` | `{{join .Groups ","}}` | é…åˆ—ã‚’çµåˆ |
| `contains` | `{{if contains .Branch "feature"}}` | éƒ¨åˆ†æ–‡å­—åˆ—ã®ç¢ºèª |
| `replace` | `{{replace .Version "v" ""}}` | æ–‡å­—åˆ—ã®ç½®æ› |
| `default` | `{{default "N/A" .Environment}}` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |

**ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹** (`.github/templates/deploy.md`):

```markdown
## {{.Title}}

### Release Information

- **Version:** `{{.Version}}`
- **Requested by:** @{{.Requestor}}
{{- if .CommitSHA}}
- **Commit:** [{{slice .CommitSHA 0 7}}](https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/{{.CommitURL}})
{{- end}}
{{- if .CommitsCount}}
- **Changes:** {{.CommitsCount}} commits since {{.PreviousVersion}}
{{- end}}

{{if .HasJiraIssues}}
### Jira Issues

{{.JiraIssuesTable}}
{{end}}

### Approval Status

{{.GroupsTable}}

---

**Approve:** Comment `approve` | **Deny:** Comment `deny`
```

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

ã™ã¹ã¦ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«é©ç”¨ã•ã‚Œã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼š

```yaml
defaults:
  timeout: 72h                    # Default approval timeout
  allow_self_approval: false      # Whether requestors can approve their own requests
  issue_labels:                   # Labels added to all approval issues
    - approval-required
```

### ã‚»ãƒ ãƒãƒ¼

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®è¨­å®š:

```yaml
semver:
  prefix: "v"              # Tag prefix (v1.2.3)
  strategy: input          # Use version from input
  validate: true           # Validate semver format
  allow_prerelease: true   # Allow prerelease versions (e.g., v1.0.0-beta.1)
  auto:                    # Label-based auto-increment (when strategy: auto)
    major_labels: [breaking, major]
    minor_labels: [feature, minor]
    patch_labels: [fix, patch, bug]
```

---

## å®Œå…¨ãªè¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€`approvals.yml`ã§åˆ©ç”¨å¯èƒ½ãª**ã™ã¹ã¦ã®è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã‚’æ–‡æ›¸åŒ–ã—ã¾ã™ã€‚

### ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®æ§‹é€ 

```yaml
version: 1                    # Required: config version (always 1)
defaults: { ... }             # Optional: global defaults
policies: { ... }             # Required: reusable approval policies
workflows: { ... }            # Required: approval workflows
semver: { ... }               # Optional: version handling settings
```
### `defaults` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `timeout` | duration | `72h` | `wait: true` ã®ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚° `check` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€‚æ™‚é–“å˜ä½ã‚’ä½¿ç”¨ï¼ˆä¾‹: 1é€±é–“ã¯ `168h`ï¼‰ã€‚ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯ä¸è¦ã€‚ |
| `allow_self_approval` | bool | `false` | ãƒªã‚¯ã‚¨ã‚¹ã‚¿ãƒ¼ãŒè‡ªèº«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‰¿èªã§ãã‚‹ã‹ã©ã†ã‹ |
| `issue_labels` | string[] | `[]` | ã™ã¹ã¦ã®æ‰¿èªã‚¤ã‚·ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹ãƒ©ãƒ™ãƒ« |

### `policies.<name>` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«å½¢å¼ï¼‰

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `approvers` | string[] | - | ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ `team:slug` å‚ç…§ã®ãƒªã‚¹ãƒˆ |
| `min_approvals` | int | 0 | å¿…è¦ãªæ‰¿èªæ•°ï¼ˆ0 = `require_all` ã‚’ä½¿ç”¨ï¼‰ |
| `require_all` | bool | `false` | true ã®å ´åˆã€ã™ã¹ã¦ã®æ‰¿èªè€…ãŒæ‰¿èªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ |

### `policies.<name>` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé«˜åº¦ãªå½¢å¼ï¼‰

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `from` | source[] | - | å€‹åˆ¥ã®é–¾å€¤ã‚’æŒã¤æ‰¿èªè€…ã‚½ãƒ¼ã‚¹ã®ãƒªã‚¹ãƒˆ |
| `logic` | string | `"and"` | ã‚½ãƒ¼ã‚¹ã‚’çµåˆã™ã‚‹æ–¹æ³•: `"and"` ã¾ãŸã¯ `"or"` |

**æ‰¿èªè€…ã‚½ãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ`from[]`ï¼‰:**

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `team` | string | - | ãƒãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ï¼ˆä¾‹: `"platform"` ã¾ãŸã¯ `"org/platform"`ï¼‰ |
| `user` | string | - | å˜ä¸€ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| `users` | string[] | - | ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒªã‚¹ãƒˆ |
| `min_approvals` | int | 1 | ã“ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰å¿…è¦ãªæ‰¿èªæ•° |
| `require_all` | bool | `false` | ã“ã®ã‚½ãƒ¼ã‚¹ã®å…¨å“¡ãŒæ‰¿èªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ |
| `logic` | string | - | æ¬¡ã®ã‚½ãƒ¼ã‚¹ã¸ã®è«–ç†: `"and"` ã¾ãŸã¯ `"or"` |

### `workflows.<name>` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `description` | string | - | äººé–“ãŒèª­ã‚ã‚‹èª¬æ˜ |

| `trigger` | map | - | ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨ï¼‰ |
| `require` | requirement[] | - | **å¿…é ˆ:** æ‰¿èªè¦ä»¶ï¼ˆã‚¢ã‚¤ãƒ†ãƒ é–“ã¯ORãƒ­ã‚¸ãƒƒã‚¯ï¼‰ |
| `issue` | object | - | ã‚¤ã‚·ãƒ¥ãƒ¼ä½œæˆè¨­å®š |
| `on_approved` | object | - | æ‰¿èªæ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `on_denied` | object | - | å¦èªæ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `on_closed` | object | - | ã‚¤ã‚·ãƒ¥ãƒ¼ãŒæ‰‹å‹•ã§ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸæ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `pipeline` | object | - | æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š |

### `workflows.<name>.require[]` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `policy` | string | - | å®šç¾©æ¸ˆã¿ãƒãƒªã‚·ãƒ¼ã®å‚ç…§ |
| `approvers` | string[] | - | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ‰¿èªè€…ï¼ˆãƒãƒªã‚·ãƒ¼ã®ä»£æ›¿ï¼‰ |
| `min_approvals` | int | - | ãƒãƒªã‚·ãƒ¼ã®min_approvalsã‚’ä¸Šæ›¸ã |
| `require_all` | bool | - | ãƒãƒªã‚·ãƒ¼ã®require_allã‚’ä¸Šæ›¸ã |

### `workflows.<name>.issue` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `title` | string | `"Approval Required: {workflow}"` | ã‚¤ã‚·ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ`{{version}}`ã€`{{environment}}`ã€`{{workflow}}`å¯¾å¿œï¼‰ |
| `body` | string | - | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ã‚·ãƒ¥ãƒ¼ãƒœãƒ‡ã‚£ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆGoãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ï¼‰ |
| `body_file` | string | - | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆ`.github/`ã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ï¼‰ |
| `labels` | string[] | `[]` | ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”¨ã®è¿½åŠ ãƒ©ãƒ™ãƒ« |
| `assignees_from_policy` | bool | `false` | ãƒãƒªã‚·ãƒ¼ã‹ã‚‰å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ï¼ˆæœ€å¤§10äººï¼‰ |

### `workflows.<name>.on_approved` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `create_tag` | bool | `false` | gitã‚¿ã‚°ã‚’ä½œæˆï¼ˆå…¥åŠ›ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ï¼‰ |
| `close_issue` | bool | `false` | æ‰¿èªå¾Œã«ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ã‚¯ãƒ­ãƒ¼ã‚º |
| `comment` | string | - | æŠ•ç¨¿ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ`{{version}}`ã€`{{satisfied_group}}`å¯¾å¿œï¼‰ |
| `tagging` | object | - | è©³ç´°ãªã‚¿ã‚°ä»˜ã‘è¨­å®š |

### `workflows.<name>.on_approved.tagging` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `enabled` | bool | `false` | ã‚¿ã‚°ä½œæˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ |
| `start_version` | string | `"0.0.0"` | åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹ï¼š`"v1.0.0"` ã¾ãŸã¯ `"1.0.0"`ï¼‰ |
| `prefix` | string | (æ¨æ¸¬) | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¥é ­è¾ï¼ˆ`start_version`ã‹ã‚‰æ¨æ¸¬ï¼‰ |
| `auto_increment` | string | - | è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼š`"major"`ã€`"minor"`ã€`"patch"`ã€ã¾ãŸã¯æ‰‹å‹•ã®å ´åˆã¯çœç•¥ |
| `env_prefix` | string | - | ç’°å¢ƒæ¥é ­è¾ï¼ˆä¾‹ï¼š`"dev-"` ã§ `"dev-v1.0.0"` ã‚’ä½œæˆï¼‰ |

### `workflows.<name>.on_denied` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `close_issue` | bool | `false` | æ‹’å¦å¾Œã«Issueã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ |
| `comment` | string | - | æŠ•ç¨¿ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ`{{denier}}`ã‚’ã‚µãƒãƒ¼ãƒˆï¼‰ |

### `workflows.<name>.on_closed` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `delete_tag` | bool | `false` | Issueã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã«é–¢é€£ã‚¿ã‚°ã‚’å‰Šé™¤ã™ã‚‹ |
| `comment` | string | - | æŠ•ç¨¿ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ`{{tag}}`ã€`{{version}}`ã‚’ã‚µãƒãƒ¼ãƒˆï¼‰ |

### `workflows.<name>.pipeline` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `stages` | stage[] | - | **å¿…é ˆ:** ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ãƒ†ãƒ¼ã‚¸ã®é †åºä»˜ããƒªã‚¹ãƒˆ |
| `track_prs` | bool | `false` | Issueæœ¬æ–‡ã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã‚’å«ã‚ã‚‹ |
| `track_commits` | bool | `false` | Issueæœ¬æ–‡ã«ã‚³ãƒŸãƒƒãƒˆã‚’å«ã‚ã‚‹ |
| `compare_from_tag` | string | - | æ¯”è¼ƒé–‹å§‹ã‚¿ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä¾‹ï¼š`"v*"`ï¼‰ |
| `show_mermaid_diagram` | bool | `true` | ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã®Mermaidãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤º |
| `release_strategy` | object | - | ãƒªãƒªãƒ¼ã‚¹å€™è£œé¸æŠæˆ¦ç•¥ |

### `workflows.<name>.pipeline.stages[]` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | èª¬æ˜ |
|-----|------|---------|-------------|
| `name` | string | - | **å¿…é ˆ:** ã‚¹ãƒ†ãƒ¼ã‚¸åï¼ˆä¾‹ï¼š`"dev"`ã€`"prod"`ï¼‰ |
| `environment` | string | - | GitHubç’°å¢ƒå |
| `policy` | string | - | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ‰¿èªãƒãƒªã‚·ãƒ¼ |
| `approvers` | string[] | - | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ‰¿èªè€…ï¼ˆãƒãƒªã‚·ãƒ¼ã®ä»£æ›¿ï¼‰ |
| `on_approved` | string | - | ã‚¹ãƒ†ãƒ¼ã‚¸æ‰¿èªæ™‚ã«æŠ•ç¨¿ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆ |
| `create_tag` | bool | `false` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§gitã‚¿ã‚°ã‚’ä½œæˆã™ã‚‹ |
| `is_final` | bool | `false` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®å¾Œã«ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ |
| `auto_approve` | bool | `false` | äººé–“ã®ä»‹å…¥ãªã—ã«è‡ªå‹•æ‰¿èªã™ã‚‹ |

### `workflows.<name>.pipeline.release_strategy` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `type` | string | `"tag"` | æˆ¦ç•¥: `"tag"`, `"branch"`, `"label"`, `"milestone"` |
| `branch` | object | - | ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã®è¨­å®š |
| `label` | object | - | ãƒ©ãƒ™ãƒ«æˆ¦ç•¥ã®è¨­å®š |
| `milestone` | object | - | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³æˆ¦ç•¥ã®è¨­å®š |
| `auto_create` | object | - | æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹æˆæœç‰©ã‚’è‡ªå‹•ä½œæˆ |

### `release_strategy.branch` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `pattern` | string | `"release/{{version}}"` | ãƒ–ãƒ©ãƒ³ãƒå‘½åãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `base_branch` | string | `"main"` | æ¯”è¼ƒå¯¾è±¡ã®ãƒ–ãƒ©ãƒ³ãƒ |
| `delete_after_release` | bool | `false` | æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ |

### `release_strategy.label` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `pattern` | string | `"release:{{version}}"` | ãƒ©ãƒ™ãƒ«å‘½åãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `pending_label` | string | - | ãƒªãƒªãƒ¼ã‚¹å‰²ã‚Šå½“ã¦å¾…ã¡ã®PRç”¨ãƒ©ãƒ™ãƒ« |
| `remove_after_release` | bool | `false` | æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤ |

### `release_strategy.milestone` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `pattern` | string | `"v{{version}}"` | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³å‘½åãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `close_after_release` | bool | `false` | æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ã‚¯ãƒ­ãƒ¼ã‚º |

### `release_strategy.auto_create` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `enabled` | bool | `false` | æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†æ™‚ã«è‡ªå‹•ä½œæˆã‚’æœ‰åŠ¹åŒ– |
| `next_version` | string | `"patch"` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¢—åˆ†: `"patch"`ã€`"minor"`ã€`"major"` |
| `create_issue` | bool | `false` | æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ç”¨ã®æ–°è¦æ‰¿èªã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ä½œæˆ |
| `comment` | string | - | æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦æŠ•ç¨¿ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆ |

### `semver` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `prefix` | string | `"v"` | ã‚¿ã‚°ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ |
| `strategy` | string | `"input"` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æˆ¦ç•¥: `"input"`ã€`"auto"` |
| `validate` | bool | `false` | semverå½¢å¼ã‚’æ¤œè¨¼ |
| `allow_prerelease` | bool | `false` | ãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨±å¯ï¼ˆä¾‹: `v1.0.0-beta.1`ï¼‰ |
| `auto` | object | - | ãƒ©ãƒ™ãƒ«ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆè¨­å®š |

### `semver.auto` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `major_labels` | string[] | `[]` | ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ—ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹PRãƒ©ãƒ™ãƒ« |
| `minor_labels` | string[] | `[]` | ãƒã‚¤ãƒŠãƒ¼ãƒãƒ³ãƒ—ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹PRãƒ©ãƒ™ãƒ« |
| `patch_labels` | string[] | `[]` | ãƒ‘ãƒƒãƒãƒãƒ³ãƒ—ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹PRãƒ©ãƒ™ãƒ« |

---

## æ©Ÿèƒ½è©³ç´°

### æ‰¿èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¤ã‚·ãƒ¥ãƒ¼ã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã“ã¨ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‰¿èªã¾ãŸã¯æ‹’å¦ã§ãã¾ã™:

**æ‰¿èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:** `approve`ã€`approved`ã€`lgtm`ã€`yes`ã€`/approve`

**æ‹’å¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:** `deny`ã€`denied`ã€`reject`ã€`rejected`ã€`no`ã€`/deny`

### ãƒãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆ

GitHubã®ãƒãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹ã®æ‰¿èªè€…ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€æ˜‡æ ¼ã•ã‚ŒãŸæ¨©é™ãŒå¿…è¦ã§ã™ã€‚æ¨™æº–ã®`GITHUB_TOKEN`ã§ã¯ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã®ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚GitHub Appãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„:

```yaml
jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Generate GitHub App token
      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}

      # Use the app token for team membership checks
      - uses: jamengual/enterprise-approval-engine@v1
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
```

**å¿…è¦ãªGitHubã‚¢ãƒ—ãƒªã®æ¨©é™ï¼š**

- `Organization > Members: Read` - ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ãŸã‚

### ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

å˜ä¸€ã®æ‰¿èªã‚¤ã‚·ãƒ¥ãƒ¼ã§è¤‡æ•°ã®ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¿½è·¡ã—ã¾ã™ã€‚å„ã‚¹ãƒ†ãƒ¼ã‚¸ãŒæ‰¿èªã•ã‚Œã‚‹ã¨ã€ã‚¤ã‚·ãƒ¥ãƒ¼ãŒé€²æ—ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«æ›´æ–°ã•ã‚Œã€è‡ªå‹•çš„ã«æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã¿ã¾ã™ã€‚

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š

```yaml
# .github/approvals.yml or external config
version: 1

policies:
  developers:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1

  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1

  tech-leads:
    approvers: [lead1, lead2]
    min_approvals: 1

  production-approvers:
    approvers: [sre1, sre2, security-lead]
    require_all: true

workflows:
  deploy:
    description: "Deploy through all environments (dev â†’ qa â†’ stage â†’ prod)"
    require:
      - policy: developers  # Initial approval to start pipeline
    pipeline:
      track_prs: true       # Include PRs in the issue body
      track_commits: true   # Include commits in the issue body
      stages:
        - name: dev
          environment: development
          policy: developers
          on_approved: "âœ… **DEV** deployment approved! Proceeding to QA..."
        - name: qa
          environment: qa
          policy: qa-team
          on_approved: "âœ… **QA** deployment approved! Proceeding to STAGING..."
        - name: stage
          environment: staging
          policy: tech-leads
          on_approved: "âœ… **STAGING** deployment approved! Ready for PRODUCTION..."
        - name: prod
          environment: production
          policy: production-approvers
          on_approved: "ğŸš€ **PRODUCTION** deployment complete!"
          create_tag: true   # Create tag when PROD is approved
          is_final: true     # Close issue after this stage
    on_approved:
      close_issue: true
      comment: |
        ğŸ‰ **Deployment Complete!**

        Version `{{version}}` has been deployed to all environments.
```

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹

```yaml
# .github/workflows/request-pipeline.yml
name: Request Pipeline Deployment

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string

permissions:
  contents: write
  issues: write
  pull-requests: read  # Required for PR tracking

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Needed for commit/PR comparison

      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Output Results
        run: |
          echo "## Pipeline Deployment Started" >> $GITHUB_STEP_SUMMARY
          echo "- **Issue:** #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
```

#### ä»•çµ„ã¿

1. **èª²é¡Œä½œæˆ**ï¼šãƒˆãƒªã‚¬ãƒ¼ãŒç™ºå‹•ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ç¤ºã™è¦–è¦šçš„ãªMermaidå›³ã¨é€²æ—è¡¨ã‚’å«ã‚€å˜ä¸€ã®èª²é¡Œã‚’ä½œæˆã—ã¾ã™ï¼š

```markdown
## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³: v1.2.0

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

â€‹```mermaid
flowchart LR
    DEV(â³ DEV)
    QA(â¬œ QA)
    STAGE(â¬œ STAGE)
    PROD(â¬œ PROD)
    DEV --> QA --> STAGE --> PROD

    classDef completed fill:#28a745,stroke:#1e7e34,color:#fff
    classDef current fill:#ffc107,stroke:#d39e00,color:#000
    classDef pending fill:#6c757d,stroke:#545b62,color:#fff
    class DEV current
    class QA,STAGE,PROD pending
â€‹```

### Deployment Progress

| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | â³ Awaiting | - | - |
| QA | â¬œ Pending | - | - |
| STAGE | â¬œ Pending | - | - |
| PROD | â¬œ Pending | - | - |

**Current Stage:** DEV
```

Mermaidãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã¯ã€è‰²åˆ†ã‘ã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã§ä¸€ç›®ã§çŠ¶æ³ã‚’æŠŠæ¡ã§ãã¾ã™ï¼š
- ğŸŸ¢ **ç·‘** - å®Œäº†ã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸
- ğŸŸ¡ **é»„** - æ‰¿èªå¾…ã¡ã®ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸
- âšª **ç°è‰²** - ä¿ç•™ä¸­ã®ã‚¹ãƒ†ãƒ¼ã‚¸
- ğŸ”µ **ã‚·ã‚¢ãƒ³** - è‡ªå‹•æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¸

Mermaidãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šã§`show_mermaid_diagram: false`ã‚’è¨­å®šã—ã¾ã™ã€‚

2. **ã‚¹ãƒ†ãƒ¼ã‚¸ã®é€²è¡Œ**ï¼šã‚³ãƒ¡ãƒ³ãƒˆã«`approve`ã¨è¨˜å…¥ã™ã‚‹ã¨æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸é€²ã¿ã¾ã™ã€‚ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã¨è¡¨ã¯è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™ï¼š

```markdown
| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | âœ… Deployed | @developer1 | Dec 9 10:30 |
| QA | âœ… Deployed | @qa-lead | Dec 9 14:15 |
| STAGE | â³ Awaiting | - | - |
| PROD | â¬œ Pending | - | - |

**Current Stage:** STAGE
```

3. **PRãŠã‚ˆã³ã‚³ãƒŸãƒƒãƒˆè¿½è·¡**: ãƒªãƒªãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯ä½•ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ­£ç¢ºã«æŠŠæ¡ã§ãã¾ã™:

```markdown
### Pull Requests in this Release

| PR | Title | Author |
|----|-------|--------|
| [#42](https://...) | Add user authentication | @alice |
| [#45](https://...) | Fix payment processing bug | @bob |

### Commits

- [`abc1234`](https://...) feat: add OAuth2 support
- [`def5678`](https://...) fix: handle null payments
```
4. **å®Œäº†**: æœ€çµ‚æ®µéšãŒæ‰¿èªã•ã‚Œã‚‹ã¨:
   - ã‚¿ã‚°ãŒä½œæˆã•ã‚Œã‚‹ï¼ˆ`create_tag: true`ã®å ´åˆï¼‰
   - å®Œäº†ã‚³ãƒ¡ãƒ³ãƒˆãŒæŠ•ç¨¿ã•ã‚Œã‚‹
   - ã‚¤ã‚·ãƒ¥ãƒ¼ãŒè‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã‚‹

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|------------|------|
| `name` | ã‚¹ãƒ†ãƒ¼ã‚¸åï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºï¼‰ |
| `environment` | GitHubç’°å¢ƒå |
| `policy` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ‰¿èªãƒãƒªã‚·ãƒ¼ |
| `approvers` | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ‰¿èªè€…ï¼ˆãƒãƒªã‚·ãƒ¼ã®ä»£æ›¿ï¼‰ |
| `on_approved` | ã‚¹ãƒ†ãƒ¼ã‚¸æ‰¿èªæ™‚ã«æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| `create_tag` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§gitã‚¿ã‚°ã‚’ä½œæˆ |
| `is_final` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸å¾Œã«ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ã‚¯ãƒ­ãƒ¼ã‚º |
| `auto_approve` | äººé–“ã®ä»‹å…¥ãªã—ã§è‡ªå‹•çš„ã«ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æ‰¿èª |
| `approval_mode` | ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ‰¿èªãƒ¢ãƒ¼ãƒ‰ã‚’ä¸Šæ›¸ã |

#### æ‰¿èªãƒ¢ãƒ¼ãƒ‰

æ‰¿èªè€…ãŒæ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã©ã®ã‚ˆã†ã«ã‚„ã‚Šå–ã‚Šã™ã‚‹ã‹ã‚’é¸æŠ:

| ãƒ¢ãƒ¼ãƒ‰ | èª¬æ˜ |
|--------|------|
| `comments` | ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰æ‰¿èªè€…ãŒã‚¤ã‚·ãƒ¥ãƒ¼ã«`/approve`ã¾ãŸã¯`approve`ã¨ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ |
| `sub_issues` | å„ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«ã‚µãƒ–ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ä½œæˆ - ã‚¯ãƒ­ãƒ¼ã‚ºã§æ‰¿èª |
| `hybrid` | ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«ãƒ¢ãƒ¼ãƒ‰ã‚’æ··åœ¨ã•ã›ã‚‹ - å„ã‚¹ãƒ†ãƒ¼ã‚¸ã®`approval_mode`ã‚’ä½¿ç”¨ |

**ã‚µãƒ–ã‚¤ã‚·ãƒ¥ãƒ¼æ‰¿èªã®ä¾‹:**


```yaml
workflows:
  deploy:
    approval_mode: sub_issues
    sub_issue_settings:
      title_template: "â³ Approve: {{stage}} for {{version}}"  # Changes to âœ… when approved
      labels: [approval-stage]
      protection:
        only_assignee_can_close: true   # Prevents unauthorized approvals
        prevent_parent_close: true       # Parent can't close until all approved
    pipeline:
      stages:
        - name: dev
          policy: developers
        - name: prod
          policy: production-approvers
```
ã‚µãƒ–èª²é¡ŒãŒã‚ã‚‹å ´åˆã€è¦ªèª²é¡Œã«ã¯æ‰¿èªã•ã‚ŒãŸã‚µãƒ–èª²é¡Œã®è¡¨ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š


```markdown
### ğŸ“‹ Approval Sub-Issues

| Stage | Sub-Issue | Status | Assignees |
|-------|-----------|--------|----------|
| DEV | #124 | â³ Awaiting | @alice, @bob |
| PROD | #125 | â³ Awaiting | @sre1, @sre2 |
```

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼‰ï¼š**

```yaml
workflows:
  deploy:
    approval_mode: comments  # Default for this workflow
    pipeline:
      stages:
        - name: dev
          policy: developers
          # Uses comments (workflow default)
        - name: prod
          policy: production-approvers
          approval_mode: sub_issues  # Override for production only
```

#### å¼·åŒ–ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆUX

ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯å¼·åŒ–ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®æ‰¿èªUXãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

- **çµµæ–‡å­—ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ï¼šæ‰¿èªã‚³ãƒ¡ãƒ³ãƒˆã«è‡ªå‹•ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  - ğŸ‘ æ‰¿èªæ¸ˆã¿
  - ğŸ‘ æ‹’å¦æ¸ˆã¿
  - ğŸ‘€ ç¢ºèªæ¸ˆã¿ï¼ˆå‡¦ç†ä¸­ï¼‰

- **ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³**ï¼šIssueæœ¬æ–‡ã«ã‚³ãƒãƒ³ãƒ‰å‚ç…§è¡¨ã‚’å«ã‚€ï¼š

```markdown
### âš¡ Quick Actions

| Action | Command | Description |
|--------|---------|-------------|
| âœ… Approve | `/approve` | Approve the **DEV** stage |
| âŒ Deny | `/deny [reason]` | Deny with optional reason |
| ğŸ“Š Status | `/status` | Show current approval status |
```

**`comment_settings`ã‚’é€šã˜ã¦è¨­å®šï¼š**

```yaml
workflows:
  deploy:
    comment_settings:
      react_to_comments: true     # Add emoji reactions (default: true)
      show_quick_actions: true    # Show Quick Actions section (default: true)
```

#### ä½ç’°å¢ƒå‘ã‘ã®è‡ªå‹•æ‰¿èª

`auto_approve: true` ã‚’ã€æ‰‹å‹•ã®æ‰¿èªãªã—ã§è‡ªå‹•çš„ã«æ‰¿èªã•ã‚Œã‚‹ã¹ããƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã«ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€`dev` ã‚„ `integration` ã®ã‚ˆã†ãªä½ç’°å¢ƒã§ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã®æ‰¿èªã‚²ãƒ¼ãƒˆã‚’ç¶­æŒã—ã¤ã¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®é€Ÿåº¦ã‚’ä¸Šã’ãŸã„å ´åˆã«æœ€é©ã§ã™ã€‚

**è‡ªå‹•æ‰¿èªã®ä¾‹ï¼š**

```yaml
workflows:
  deploy:
    description: "Deploy through environments"
    pipeline:
      stages:
        - name: dev
          environment: development
          auto_approve: true              # Automatically approved
          on_approved: "ğŸ¤– DEV auto-deployed"
        - name: integration
          environment: integration
          auto_approve: true              # Automatically approved
          on_approved: "ğŸ¤– INTEGRATION auto-deployed"
        - name: staging
          environment: staging
          policy: qa-team                 # Requires manual approval
          on_approved: "âœ… STAGING approved"
        - name: production
          environment: production
          policy: production-approvers    # Requires manual approval
          create_tag: true
          is_final: true
```
**ä»•çµ„ã¿ï¼š**

1. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å•é¡ŒãŒä½œæˆã•ã‚Œã‚‹ã¨ã€ã™ã¹ã¦ã®åˆæœŸã® `auto_approve: true` ã‚¹ãƒ†ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«å®Œäº†ã—ã¾ã™
2. ã‚¹ãƒ†ãƒ¼ã‚¸ãŒæ‰‹å‹•ã§æ‰¿èªã•ã‚Œã‚‹ã¨ã€ãã®å¾Œã«ç¶šãé€£ç¶šã—ãŸ `auto_approve: true` ã‚¹ãƒ†ãƒ¼ã‚¸ã‚‚è‡ªå‹•çš„ã«å®Œäº†ã—ã¾ã™
3. è‡ªå‹•æ‰¿èªã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¸ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¡¨ã§ğŸ¤–ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
4. æ‰¿èªè€…ã¯ã‚¹ãƒ†ãƒ¼ã‚¸å±¥æ­´ã« `[auto]` ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã™

**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼š**

- **é–‹ç™ºç’°å¢ƒ**ï¼šæ‰¿èªã‚’å¾…ãŸãšã«å³æ™‚ãƒ‡ãƒ—ãƒ­ã‚¤
- **çµ±åˆãƒ†ã‚¹ãƒˆ**ï¼šãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’é€šã˜ã¦CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•çš„ã«é€²è¡Œ
- **ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ**ï¼šã‚«ãƒŠãƒªã‚¢ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’è‡ªå‹•æ‰¿èªã—ã€å®Œå…¨å±•é–‹ã«ã¯æ‰¿èªã‚’è¦æ±‚

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------------|------------|------|
| `track_prs` | `false` | ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã‚’å•é¡Œæœ¬æ–‡ã«å«ã‚ã‚‹ |
| `track_commits` | `false` | æœ€å¾Œã®ã‚¿ã‚°ä»¥é™ã®ã‚³ãƒŸãƒƒãƒˆã‚’å«ã‚ã‚‹ |
| `compare_from_tag` | - | æ¯”è¼ƒå…ƒã®ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `show_mermaid_diagram` | `true` | ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã®Mermaidãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤º |

**æ³¨æ„ï¼š** PRãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã«ã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ã® `pull-requests: read` æ¨©é™ãŒå¿…è¦ã§ã™ã€‚

### ãƒªãƒªãƒ¼ã‚¹å€™è£œæˆ¦ç•¥

ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç’°å¢ƒã§ã¯ã€mainã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRãŒå¿…ãšã—ã‚‚å³ãƒªãƒªãƒ¼ã‚¹å€™è£œã«ãªã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚æ‰¿èªã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€ã©ã®PRãŒãƒªãƒªãƒ¼ã‚¹ã«å±ã™ã‚‹ã‹ã‚’é¸æŠã™ã‚‹ãŸã‚ã®3ã¤ã®æˆ¦ç•¥ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

#### æˆ¦ç•¥ã‚¿ã‚¤ãƒ—

| æˆ¦ç•¥ | èª¬æ˜ | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
|------|-------|--------------|
| `tag` | 2ã¤ã®gitã‚¿ã‚°é–“ã®PRï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªãƒªãƒ¼ã‚¹ã€ãƒˆãƒ©ãƒ³ã‚¯ãƒ™ãƒ¼ã‚¹é–‹ç™º |
| `branch` | ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPR | GitFlowã€ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ |
| `label` | ç‰¹å®šã®ãƒªãƒªãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ãŒä»˜ã„ãŸPR | æŸ”è»Ÿãªé¸æŠã€ä¸€æ‹¬ãƒªãƒªãƒ¼ã‚¹ |
| `milestone` | GitHubãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸPR | ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«æ²¿ã£ãŸãƒªãƒªãƒ¼ã‚¹ |

#### è¨­å®š


```yaml
# .github/approvals.yml
workflows:
  deploy:
    description: "Production deployment pipeline"
    pipeline:
      track_prs: true
      track_commits: true

      # Configure release selection strategy
      release_strategy:
        type: milestone  # or: tag, branch, label

        # Milestone strategy settings
        milestone:
          pattern: "v{{version}}"        # e.g., "v1.2.0"
          close_after_release: true       # Close milestone on prod completion

        # Auto-create next release artifact on completion
        auto_create:
          enabled: true
          next_version: patch             # or: minor, major
          create_issue: true              # Create new approval issue

      stages:
        - name: dev
          policy: developers
        - name: prod
          policy: production-approvers
          is_final: true
```

#### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

GitFlowã‚¹ã‚¿ã‚¤ãƒ«ã®é–‹ç™ºã«ã¯ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```yaml
release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"  # Creates release/v1.2.0
    base_branch: main               # Compare against main
    delete_after_release: true      # Cleanup after prod deploy

  auto_create:
    enabled: true
    next_version: minor
```

**ä»•çµ„ã¿:**
1. ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¾ã™: `release/v1.2.0`
2. ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã¯ãƒªãƒªãƒ¼ã‚¹å€™è£œã§ã™
3. ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ‰¿èªã‚’ä¾é ¼ã—ã¾ã™
4. æ‰¿èªç”¨ã®Issueã«ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒå†…ã®ã™ã¹ã¦ã®PRãŒè¡¨ç¤ºã•ã‚Œã¾ã™
5. æœ¬ç•ªé©ç”¨å¾Œã€ãƒ–ãƒ©ãƒ³ãƒã¯å‰Šé™¤ã•ã‚Œã¾ã™ï¼ˆä»»æ„ï¼‰æ¬¡ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¾ã™

#### ãƒ©ãƒ™ãƒ«æˆ¦ç•¥

æŸ”è»ŸãªPRé¸æŠã®ãŸã‚ã«ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™:

```yaml
release_strategy:
  type: label
  label:
    pattern: "release:{{version}}"      # e.g., "release:v1.2.0"
    pending_label: "pending-release"    # Applied to merged PRs awaiting release
    remove_after_release: true          # Remove label after prod deploy

  auto_create:
    enabled: true
    next_version: patch
```

**å‹•ä½œã®ä»•çµ„ã¿:**
1. main ã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã« `pending-release` ãƒ©ãƒ™ãƒ«ãŒä»˜ã
2. ãƒªãƒªãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒé¸æŠã—ãŸPRã« `release:v1.2.0` ã‚’é©ç”¨ã™ã‚‹
3. v1.2.0 ã®æ‰¿èªã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹
4. æ‰¿èªç”¨ã®Issueã«ã¯ãã®ãƒ©ãƒ™ãƒ«ãŒä»˜ã„ãŸPRã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
5. æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å¾Œã€ãƒ©ãƒ™ãƒ«ã¯å‰Šé™¤ã•ã‚Œã€æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ãŒä½œæˆã•ã‚Œã‚‹

#### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³æˆ¦ç•¥

ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«æ²¿ã£ãŸãƒªãƒªãƒ¼ã‚¹ã«ã¯ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹:

```yaml
release_strategy:
  type: milestone
  milestone:
    pattern: "Release {{version}}"       # e.g., "Release 1.2.0"
    close_after_release: true            # Close milestone on completion

  auto_create:
    enabled: true
    next_version: minor
    create_issue: true                   # Auto-create next approval issue
```

**ä»•çµ„ã¿:**
1. ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ä½œæˆ: "ãƒªãƒªãƒ¼ã‚¹ 1.2.0"
2. é–‹ç™ºä¸­ã«PRã‚’ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã«å‰²ã‚Šå½“ã¦ã‚‹
3. v1.2.0ã®æ‰¿èªã‚’ä¾é ¼ã™ã‚‹
4. æ‰¿èªç”¨ã®Issueã«ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³å†…ã®ã™ã¹ã¦ã®PRãŒè¡¨ç¤ºã•ã‚Œã‚‹
5. æœ¬ç•ªå¾Œã€ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’é–‰ã˜ã¦æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹

#### å®Œäº†æ™‚ã®è‡ªå‹•ä½œæˆ

æœ€çµ‚æ®µéšï¼ˆæœ¬ç•ªï¼‰ãŒæ‰¿èªã•ã‚Œã‚‹ã¨ã€æ¬¡ã®ãƒªãƒªãƒ¼ã‚¹ã®æº–å‚™ã‚’è‡ªå‹•çš„ã«è¡Œã†:

```yaml
auto_create:
  enabled: true
  next_version: patch      # Calculate next: patch, minor, or major
  create_issue: true       # Create new approval issue immediately
  comment: |               # Custom message (optional)
    ğŸš€ **Next release prepared:** {{version}}
```
ã“ã‚Œã«ã‚ˆã‚Šä½œæˆã•ã‚Œã¾ã™ï¼š
- **ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥:** mainã‹ã‚‰æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ
- **ãƒ©ãƒ™ãƒ«æˆ¦ç•¥:** æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«
- **ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³æˆ¦ç•¥:** æ–°ã—ã„ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

#### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³

å„æˆ¦ç•¥ã«ã¯ã€æœ€çµ‚æ®µéšï¼ˆprodï¼‰ãŒæ‰¿èªã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚**ã™ã¹ã¦ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`false`ã§ã™** - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯ã‚ªãƒ—ãƒˆã‚¤ãƒ³æ–¹å¼ã§ã™ï¼š

| æˆ¦ç•¥ | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|----------|----------------|-------------|
| ãƒ–ãƒ©ãƒ³ãƒ | `delete_after_release` | ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ |
| ãƒ©ãƒ™ãƒ« | `remove_after_release` | PRã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤ |
| ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ | `close_after_release` | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ã‚¯ãƒ­ãƒ¼ã‚º |


```yaml
release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"
    delete_after_release: false   # Keep branch for reference (default)

  type: milestone
  milestone:
    pattern: "v{{version}}"
    close_after_release: true     # Close milestone when done
```

#### ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤

é€šå¸¸ã®ãƒªãƒªãƒ¼ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ç·Šæ€¥ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®å ´åˆã¯ã€åˆ¥ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

```yaml
# .github/approvals.yml
workflows:
  # Standard releases - full pipeline with milestone tracking
  deploy:
    description: "Standard release pipeline (dev â†’ qa â†’ stage â†’ prod)"
    pipeline:
      release_strategy:
        type: milestone
        milestone:
          pattern: "v{{version}}"
          close_after_release: true
        auto_create:
          enabled: true
          next_version: minor
      stages:
        - name: dev
          policy: developers
        - name: qa
          policy: qa-team
        - name: stage
          policy: tech-leads
        - name: prod
          policy: production-approvers
          is_final: true

  # Hotfixes - skip stages, direct to prod
  hotfix:
    description: "Emergency hotfix - direct to production"
    pipeline:
      release_strategy:
        type: tag              # Simple tag-based, no cleanup needed
        # No auto_create - hotfixes are one-off
      stages:
        - name: prod
          policy: production-approvers
          create_tag: true
          is_final: true
    on_approved:
      close_issue: true
      comment: "ğŸš¨ Hotfix {{version}} deployed to production"
```

**ãƒˆãƒªã‚¬ãƒ¼ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ vs é€šå¸¸ãƒªãƒªãƒ¼ã‚¹:**

```bash
# Regular release - goes through all stages
gh workflow run request-approval.yml -f workflow_name=deploy -f version=v1.3.0

# Hotfix - goes straight to prod
gh workflow run request-approval.yml -f workflow_name=hotfix -f version=v1.2.1
```

**ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³:**

| ã‚·ãƒŠãƒªã‚ª | æˆ¦ç•¥ | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | è‡ªå‹•ä½œæˆ |
|----------|----------|---------|-------------|
| ç·Šæ€¥ä¿®æ­£ | `tag` | ãªã— | ç„¡åŠ¹ |
| ãƒ‘ãƒƒãƒãƒªãƒªãƒ¼ã‚¹ | `milestone` | `close_after_release: false` | ç„¡åŠ¹ |
| è¤‡æ•°ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ | `branch` | `delete_after_release: false` | ç„¡åŠ¹ |

#### ãƒªãƒªãƒ¼ã‚¹æˆ¦ç•¥ã®åˆ©ç‚¹

| æˆ¦ç•¥ | é•·æ‰€ | çŸ­æ‰€ |
|----------|------|------|
| **Tag** | ã‚·ãƒ³ãƒ—ãƒ«ã§è¿½åŠ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸è¦ | ãƒãƒ¼ã‚¸æ¸ˆã¿PRã™ã¹ã¦ãŒå«ã¾ã‚Œã‚‹ |
| **Branch** | ãƒªãƒªãƒ¼ã‚¹ç¯„å›²ãŒæ˜ç¢ºã§éš”é›¢å¯èƒ½ | ãƒ–ãƒ©ãƒ³ãƒç®¡ç†ã®è² è·ã‚ã‚Š |
| **Label** | æŸ”è»Ÿãªé¸æŠãŒå¯èƒ½ã§å¤‰æ›´å®¹æ˜“ | æ‰‹å‹•ã§ã®ãƒ©ãƒ™ãƒªãƒ³ã‚°ãŒå¿…è¦ |
| **Milestone** | ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã®å¯è¦–åŒ–ã€è¨ˆç”»é€£æº | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã®è¦å¾‹ãŒå¿…è¦ |

**æ¨å¥¨äº‹é …:**

- ç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ **tag** ã‚’ä½¿ç”¨
- ãƒªãƒªãƒ¼ã‚¹ã®éš”é›¢ãŒå¿…è¦ãªè¦åˆ¶ç’°å¢ƒã«ã¯ **branch** ã‚’ä½¿ç”¨
- æŸ”è»Ÿãªç¯„å›²ã§ã®ãƒãƒƒãƒãƒªãƒªãƒ¼ã‚¹ã«ã¯ **label** ã‚’ä½¿ç”¨
- æ˜ç¢ºãªãƒªãƒªãƒ¼ã‚¹è¨ˆç”»ãŒã‚ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—é§†å‹•ã®é–‹ç™ºã«ã¯ **milestone** ã‚’ä½¿ç”¨

### Jiraé€£æº

ã‚³ãƒŸãƒƒãƒˆã‚„ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰è‡ªå‹•ã§Jiraèª²é¡Œã‚’æŠ½å‡ºã—ã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™:

#### ãƒªãƒ³ã‚¯ã®ã¿ãƒ¢ãƒ¼ãƒ‰ï¼ˆèªè¨¼ä¸è¦ï¼‰

`jira_base_url` ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§èª²é¡Œã‚­ãƒ¼ã‚’æŠ½å‡ºã—ã€ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªãƒªãƒ³ã‚¯ã¨ã—ã¦è¡¨ç¤ºã—ã¾ã™:

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    jira_base_url: https://yourcompany.atlassian.net  # That's it!
```

ã“ã‚Œã¯ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰èª²é¡Œã‚­ãƒ¼ï¼ˆä¾‹ï¼š`PROJ-123`ï¼‰ã‚’æŠ½å‡ºã—ã€æ‰¿èªèª²é¡Œã«ãƒªãƒ³ã‚¯ã¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ï¼š

```markdown
### Jira Issues
- [PROJ-123](https://yourcompany.atlassian.net/browse/PROJ-123)
- [PROJ-456](https://yourcompany.atlassian.net/browse/PROJ-456)
```

#### ãƒ•ãƒ«ãƒ¢ãƒ¼ãƒ‰ï¼ˆAPIã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šï¼‰

èªè¨¼æƒ…å ±ã‚’è¿½åŠ ã—ã¦ã€èª²é¡Œã®è©³ç´°ã‚’å–å¾—ã—ã€ä¿®æ­£ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã™ï¼š

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Jira configuration
    jira_base_url: https://yourcompany.atlassian.net
    jira_user_email: ${{ secrets.JIRA_EMAIL }}
    jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
    jira_update_fix_version: 'true'
```

ã“ã‚Œã¯è©³ç´°ãªå•é¡Œæƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š

```markdown
### Jira Issues in this Release

| Key | Summary | Type | Status |
|-----|---------|------|--------|
| [PROJ-123](https://...) | Fix login bug | Bug | Done |
| [PROJ-456](https://...) | Add dark mode | Feature | In Progress |
```

**ãƒ¢ãƒ¼ãƒ‰ã®æ¯”è¼ƒï¼š**

| ãƒ¢ãƒ¼ãƒ‰ | èªè¨¼å¿…è¦ | æ©Ÿèƒ½ |
|--------|-----------|-------|
| ãƒªãƒ³ã‚¯ã®ã¿ | ã„ã„ãˆ | ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªãƒªãƒ³ã‚¯ã¨ã—ã¦ã‚­ãƒ¼ã‚’ç™ºè¡Œ |
| ãƒ•ãƒ« | ã¯ã„ | ãƒªãƒ³ã‚¯ï¼‹æ¦‚è¦ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ã‚¿ã‚¤ãƒ—ã®çµµæ–‡å­—ã€Fix Versionã®æ›´æ–° |

**Jiraã®å‡ºåŠ›ï¼š**

```yaml
- name: Use Jira Outputs
  run: |
    echo "Issues: ${{ steps.approval.outputs.jira_issues }}"
    # Output: PROJ-123,PROJ-456

    echo "Details: ${{ steps.approval.outputs.jira_issues_json }}"
    # Output: [{"key":"PROJ-123","summary":"Fix login bug",...}]
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

GitHubã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®å¯è¦–æ€§ã®ãŸã‚ã«GitHubãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­â€•YAMLã®`environment:`ã‚­ãƒ¼ã¨ã¯ç‹¬ç«‹ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  id: approval
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Deployment tracking
    create_deployment: 'true'
    deployment_environment: production
    deployment_environment_url: https://myapp.example.com

- name: Update Deployment Status
  if: steps.approval.outputs.status == 'approved'
  run: |
    # Use the deployment_id to update status after actual deployment
    echo "Deployment ID: ${{ steps.approval.outputs.deployment_id }}"
```

**ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´æ‰€ï¼š**

- ãƒªãƒã‚¸ãƒˆãƒªã®**Deployments**ã‚¿ãƒ–
- ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã®ç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
- GitHub for Jiraé€£æºï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
- CI/CDãƒ„ãƒ¼ãƒ«å‘ã‘ã®GitHub API

**æ³¨æ„ï¼š** ã“ã‚Œã¯GitHubã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãªEnvironment Protection Rulesã¨ã¯åˆ¥ã®GitHub Deployments APIã‚’é€šã˜ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä¸¡æ–¹ã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã‚‚ã€ç‹¬ç«‹ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

### å¤–éƒ¨è¨­å®šãƒªãƒã‚¸ãƒˆãƒª

æ‰¿èªè¨­å®šã‚’å…±æœ‰ãƒªãƒã‚¸ãƒˆãƒªã«ä¿å­˜ã—ã€ãƒãƒªã‚·ãƒ¼ç®¡ç†ã‚’é›†ä¸­åŒ–ã—ã¾ã™ï¼š

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    token: ${{ secrets.GITHUB_TOKEN }}
    config_repo: myorg/.github  # Shared config repo
```

**è¨­å®šè§£æ±ºé †åºï¼š**

1. å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªå†…ã® `{repo-name}_approvals.yml`ï¼ˆä¾‹ï¼š`myapp_approvals.yml`ï¼‰
2. å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªå†…ã® `approvals.yml`ï¼ˆå…±æœ‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
3. ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã® `.github/approvals.yml`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

**çµ„ç¹”æ§‹é€ ã®ä¾‹ï¼š**

```text
myorg/.github/
â”œâ”€â”€ myapp_approvals.yml      # App-specific config
â”œâ”€â”€ backend_approvals.yml    # Backend repos config
â””â”€â”€ approvals.yml            # Default for all repos
```

### æ‰¿èªã®ãƒ–ãƒ­ãƒƒã‚¯

é€²è¡Œå‰ã«æ‰¿èªã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å ´åˆ:

```yaml
name: Deploy with Blocking Approval

on:
  workflow_dispatch:
    inputs:
      version:
        required: true
        type: string

jobs:
  request-approval:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.request.outputs.issue_number }}
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

  wait-for-approval:
    needs: request-approval
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: check
        with:
          action: check
          issue_number: ${{ needs.request-approval.outputs.issue_number }}
          wait: 'true'           # Poll until approved/denied
          timeout: '4h'          # Max wait time
          token: ${{ secrets.GITHUB_TOKEN }}

  deploy:
    needs: [request-approval, wait-for-approval]
    if: needs.wait-for-approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy
        run: |
          echo "Deploying ${{ needs.wait-for-approval.outputs.tag }}"
```

**æ³¨æ„:** ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ä¿ã¤ãŸã‚ã€GitHub Actionsã®å®Ÿè¡Œæ™‚é–“ã‚’æ¶ˆè²»ã—ã¾ã™ã€‚ã‚³ã‚¹ãƒˆã‚’é‡è¦–ã™ã‚‹å ´åˆã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆåˆ¥ã®`process-comment`ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

### ã‚¤ã‚·ãƒ¥ãƒ¼ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã®ã‚¿ã‚°å‰Šé™¤

æ‰¿èªã‚¤ã‚·ãƒ¥ãƒ¼ãŒæ‰‹å‹•ã§ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸã¨ãã«ã‚¿ã‚°ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```yaml
workflows:
  dev-deploy:
    on_closed:
      delete_tag: true   # Delete tag when issue is closed
      comment: "Cancelled. Tag {{tag}} deleted."

  production-deploy:
    on_closed:
      delete_tag: false  # NEVER delete production tags
```

**ã‚¯ãƒ­ãƒ¼ã‚ºã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†:**

```yaml
# .github/workflows/handle-close.yml
name: Handle Issue Close

on:
  issues:
    types: [closed]

jobs:
  handle:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: close
        with:
          action: close-issue
          issue_number: ${{ github.event.issue.number }}
          issue_action: ${{ github.event.action }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Report
        run: |
          echo "Status: ${{ steps.close.outputs.status }}"
          echo "Deleted tag: ${{ steps.close.outputs.tag_deleted }}"
```

---

## Complete Examples

### Full-Featured Request Workflow

```yaml
name: Request Production Deployment

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options: [staging, production]

permissions:
  contents: write
  issues: write
  deployments: write

jobs:
  request:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.approval.outputs.issue_number }}
      issue_url: ${{ steps.approval.outputs.issue_url }}
      deployment_id: ${{ steps.approval.outputs.deployment_id }}
      jira_issues: ${{ steps.approval.outputs.jira_issues }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Needed for commit comparison

      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: ${{ inputs.environment }}-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          # Jira integration
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
          # Deployment tracking
          create_deployment: 'true'
          deployment_environment: ${{ inputs.environment }}
          deployment_environment_url: https://${{ inputs.environment }}.myapp.com

      - name: Summary
        run: |
          echo "## Approval Request Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Issue:** #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Jira Issues:** ${{ steps.approval.outputs.jira_issues }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commits:** ${{ steps.approval.outputs.commits_count }}" >> $GITHUB_STEP_SUMMARY
```

### ãƒãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆã«ã‚ˆã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã®å‡¦ç†

```yaml
name: Handle Approval Comments

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write

jobs:
  process:
    if: |
      github.event.issue.pull_request == null &&
      contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Generate GitHub App token for team membership checks
      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}

      - uses: jamengual/enterprise-approval-engine@v1
        id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
          # Jira integration to update Fix Version on approval
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}

      - name: Trigger Deployment
        if: steps.process.outputs.status == 'approved'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deploy.yml',
              ref: 'main',
              inputs: { version: '${{ steps.process.outputs.tag }}' }
            });
```

### ãƒãƒ«ãƒç’°å¢ƒãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³

```yaml
# .github/approvals.yml
version: 1

policies:
  dev-team:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1

  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1

  prod-team:
    approvers: [team:sre, tech-lead]
    min_approvals: 2

workflows:
  dev-deploy:
    require:
      - policy: dev-team
    on_approved:
      tagging:
        enabled: true
        auto_increment: patch
        env_prefix: "dev-"
      close_issue: true

  staging-deploy:
    require:
      - policy: qa-team
    on_approved:
      tagging:
        enabled: true
        auto_increment: minor
        env_prefix: "staging-"
      close_issue: true

  production-deploy:
    require:
      - policy: prod-team
    on_approved:
      create_tag: true
      close_issue: true
    on_closed:
      delete_tag: false  # Never delete production tags
```

### å¾Œç¶šã‚¸ãƒ§ãƒ–ã§ã®å‡ºåŠ›ã®ä½¿ç”¨

```yaml
name: Deploy with Approval

on:
  workflow_dispatch:
    inputs:
      version:
        required: true

jobs:
  approval:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
      approvers: ${{ steps.check.outputs.approvers }}
      jira_issues: ${{ steps.request.outputs.jira_issues }}
    steps:
      - uses: actions/checkout@v4

      - uses: jamengual/enterprise-approval-engine@v1
        id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          jira_base_url: https://mycompany.atlassian.net

      - uses: jamengual/enterprise-approval-engine@v1
        id: check
        with:
          action: check
          issue_number: ${{ steps.request.outputs.issue_number }}
          wait: 'true'
          timeout: '2h'
          token: ${{ secrets.GITHUB_TOKEN }}

  deploy:
    needs: approval
    if: needs.approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Deploy
        run: |
          echo "Deploying ${{ needs.approval.outputs.tag }}"
          echo "Approved by: ${{ needs.approval.outputs.approvers }}"
          echo "Jira Issues: ${{ needs.approval.outputs.jira_issues }}"

  notify:
    needs: [approval, deploy]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Notify Slack
        run: |
          if [ "${{ needs.approval.outputs.status }}" == "approved" ]; then
            echo "Deployment of ${{ needs.approval.outputs.tag }} completed!"
          else
            echo "Deployment was ${{ needs.approval.outputs.status }}"
          fi
```

---

## Schema Validation

Validate your configuration using the JSON schema:

```yaml
# .github/approvals.yml
# yaml-language-server: $schema=https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/schema.json

version: 1

policies:
  # ... your config
```

ã¾ãŸã¯ CI ã§æ¤œè¨¼ã—ã¾ã™:

```yaml
- name: Validate Config
  run: |
    npm install -g ajv-cli
    ajv validate -s schema.json -d .github/approvals.yml
```

---

## GitHub Enterprise Server

ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯GitHub Enterprise Serverã‚’å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚`GITHUB_SERVER_URL`ãŠã‚ˆã³`GITHUB_API_URL`ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦GHESç’°å¢ƒã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã—ã¾ã™ã€‚

è¿½åŠ ã®è¨­å®šã¯ä¸è¦ã§ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯è‡ªå‹•çš„ã«æ­£ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼š**

ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹æŒ‡æ•°çš„ãƒãƒƒã‚¯ã‚ªãƒ•ã‚’ç”¨ã„ãŸè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚è¨­å®šå†…å®¹ï¼š

- åˆæœŸé…å»¶ï¼š1ç§’
- æœ€å¤§é…å»¶ï¼š60ç§’
- æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼š5å›
- ã‚¸ãƒƒã‚¿ãƒ¼ï¼šé›·é³´åŠ¹æœé˜²æ­¢ã®ãŸã‚0ã€œ500msã®ãƒ©ãƒ³ãƒ€ãƒ åŠ ç®—

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-12-22

---