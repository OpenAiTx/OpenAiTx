# ä¼ä¸šå®¡æ‰¹å¼•æ“

[![en](https://img.shields.io/badge/lang-en-blue.svg)](README.md)
[![es](https://img.shields.io/badge/lang-es-yellow.svg)](ES/README.md)

ä¼ä¸šçº§ GitHub Actionï¼Œæ”¯æŒåŸºäºç­–ç•¥çš„å®¡æ‰¹å·¥ä½œæµï¼Œå…·å¤‡æ¯ç»„é˜ˆå€¼ï¼ˆN ä¸­ Xï¼‰ã€ç»„é—´æˆ–é€»è¾‘ï¼Œä»¥åŠè‡ªåŠ¨è¯­ä¹‰ç‰ˆæœ¬æ ‡ç­¾åˆ›å»ºåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **çµæ´»çš„å®¡æ‰¹é€»è¾‘**ï¼šæ”¯æŒç»„å†…çš„ä¸ï¼ˆå…¨éƒ¨å¿…é¡»å®¡æ‰¹ï¼‰å’Œé˜ˆå€¼ï¼ˆN ä¸­ Xï¼‰é€»è¾‘
- **ç»„é—´æˆ–é€»è¾‘**ï¼šå¤šå®¡æ‰¹è·¯å¾„â€”â€”ä»»æ„ä¸€ç»„æ»¡è¶³è¦æ±‚å³å¯æ‰¹å‡†è¯·æ±‚
- **æ··åˆå®¡æ‰¹äºº**ï¼šåŒä¸€ç»„å†…å¯ç»„åˆä¸ªäººç”¨æˆ·å’Œ GitHub å›¢é˜Ÿ
- **æ¸è¿›å¼éƒ¨ç½²æµæ°´çº¿**ï¼šå•ä¸€è®®é¢˜è·¨å¤šä¸ªç¯å¢ƒè·Ÿè¸ªï¼ˆå¼€å‘ â†’ æµ‹è¯• â†’ é¢„å‘å¸ƒ â†’ ç”Ÿäº§ï¼‰
- **æµæ°´çº¿å¯è§†åŒ–**ï¼šè‰²å½©ç¼–ç çš„ Mermaid æµç¨‹å›¾å±•ç¤ºéƒ¨ç½²è¿›åº¦
- **å­è®®é¢˜å®¡æ‰¹**ï¼šä¸ºæ¯ä¸ªé˜¶æ®µåˆ›å»ºä¸“ç”¨å®¡æ‰¹å­è®®é¢˜â€”â€”å…³é—­å³ä¸ºæ‰¹å‡†
- **å¢å¼ºçš„è¯„è®ºç”¨æˆ·ä½“éªŒ**ï¼šå®¡æ‰¹è¯„è®ºæ”¯æŒè¡¨æƒ…ååº”ï¼Œå¿«é€Ÿæ“ä½œåŒºå«å‘½ä»¤å‚è€ƒ
- **è®®é¢˜å…³é—­ä¿æŠ¤**ï¼šé˜²æ­¢æœªæˆæƒç”¨æˆ·å…³é—­å®¡æ‰¹è®®é¢˜ï¼ˆè‡ªåŠ¨é‡æ–°æ‰“å¼€ï¼‰
- **æ··åˆå®¡æ‰¹æ¨¡å¼**ï¼šæŒ‰å·¥ä½œæµæˆ–é˜¶æ®µæ··åˆåŸºäºè¯„è®ºå’Œå­è®®é¢˜çš„å®¡æ‰¹
- **PR å’Œæäº¤è·Ÿè¸ª**ï¼šè‡ªåŠ¨åœ¨éƒ¨ç½²è®®é¢˜åˆ—å‡º PR å’Œæäº¤ä»¥ä¾¿å‘å¸ƒç®¡ç†
- **è¯­ä¹‰ç‰ˆæœ¬æ ‡ç­¾åˆ›å»º**ï¼šå®¡æ‰¹é€šè¿‡åè‡ªåŠ¨åˆ›å»º git æ ‡ç­¾
- **åŸºäºç­–ç•¥çš„é…ç½®**ï¼šä»¥ YAML å®šä¹‰å¯å¤ç”¨çš„å®¡æ‰¹ç­–ç•¥
- **åŸºäºè®®é¢˜çš„å·¥ä½œæµ**ï¼šé€šè¿‡ GitHub è®®é¢˜å®ç°é€æ˜å®¡è®¡è½¨è¿¹
- **Jira é›†æˆ**ï¼šä»æäº¤ä¸­æå–è®®é¢˜é”®ï¼Œæ˜¾ç¤ºåœ¨å®¡æ‰¹è®®é¢˜ï¼Œæ›´æ–°ä¿®å¤ç‰ˆæœ¬
- **éƒ¨ç½²è·Ÿè¸ª**ï¼šåˆ›å»º GitHub éƒ¨ç½²ä»¥ä¾¿éƒ¨ç½²ä»ªè¡¨ç›˜å¯è§†åŒ–
- **å¤–éƒ¨é…ç½®**ï¼šå°†å®¡æ‰¹ç­–ç•¥é›†ä¸­å­˜æ”¾äºå…±äº«ä»“åº“
- **é€Ÿç‡é™åˆ¶å¤„ç†**ï¼šé’ˆå¯¹ GitHub API é€Ÿç‡é™åˆ¶è‡ªåŠ¨æŒ‡æ•°é€€é¿é‡è¯•
- **GitHub ä¼ä¸šæœåŠ¡å™¨æ”¯æŒ**ï¼šå®Œå…¨æ”¯æŒ GHES ç¯å¢ƒ
- **æ— å¤–éƒ¨ä¾èµ–**ï¼šçº¯ GitHub Actionsï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡

ğŸ“‹ **æ¼”ç¤ºç¤ºä¾‹ï¼š** [å®¡æ‰¹ç¤ºä¾‹è®®é¢˜](https://github.com/jamengual/enterprise-approval-engine/issues/7)

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#quick-start)
- [Action å‚è€ƒ](#action-reference)
  - [æ“ä½œ](#actions)
  - [è¾“å…¥](#inputs)
  - [è¾“å‡º](#outputs)
- [é…ç½®å‚è€ƒ](#configuration-reference)
  - [ç­–ç•¥](#policies)
  - [å·¥ä½œæµ](#workflows)
  - [æ ‡ç­¾é…ç½®](#tagging-configuration)
  - [è‡ªå®šä¹‰æ¨¡æ¿](#custom-issue-templates)
  - [é»˜è®¤å€¼](#defaults)
  - [è¯­ä¹‰åŒ–ç‰ˆæœ¬](#semver)
- [å®Œæ•´é…ç½®å‚è€ƒ](#complete-configuration-reference)
- [åŠŸèƒ½è¯¦æƒ…](#feature-details)
  - [å®¡æ‰¹å…³é”®å­—](#approval-keywords)
  - [å›¢é˜Ÿæ”¯æŒ](#team-support)
  - [æ¸è¿›å¼éƒ¨ç½²æµæ°´çº¿](#progressive-deployment-pipelines)
  - [å€™é€‰ç‰ˆæœ¬ç­–ç•¥](#release-candidate-strategies)
  - [Jira é›†æˆ](#jira-integration)
  - [éƒ¨ç½²è·Ÿè¸ª](#deployment-tracking)
  - [å¤–éƒ¨é…ç½®ä»“åº“](#external-config-repository)
  - [é˜»å¡å®¡æ‰¹](#blocking-approvals)
  - [å…³é—­ Issue æ—¶åˆ é™¤æ ‡ç­¾](#tag-deletion-on-issue-close)
- [å®Œæ•´ç¤ºä¾‹](#complete-examples)
- [æ¨¡å¼éªŒè¯](#schema-validation)
- [GitHub ä¼ä¸šæœåŠ¡å™¨](#github-enterprise-server)

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºé…ç½®

åœ¨ä½ çš„ä»“åº“ä¸­åˆ›å»º `.github/approvals.yml` æ–‡ä»¶ï¼š

```yaml
version: 1

policies:
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2

  platform-team:
    approvers: [team:platform-engineers]
    require_all: true

workflows:
  production-deploy:
    require:
      # OR logic: either path satisfies approval
      - policy: dev-team        # 2 of 3 developers
      - policy: platform-team   # ALL platform engineers
    on_approved:
      create_tag: true
      close_issue: true
```

### 2. è¯·æ±‚å®¡æ‰¹å·¥ä½œæµ

åˆ›å»º `.github/workflows/request-approval.yml`ï¼š

```yaml
name: Request Deployment Approval

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy (e.g., v1.2.3)'
        required: true
        type: string

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Output Results
        run: |
          echo "Issue: ${{ steps.approval.outputs.issue_url }}"
          echo "Status: ${{ steps.approval.outputs.status }}"
```

### 3. å¤„ç†å®¡æ‰¹æ„è§

åˆ›å»º `.github/workflows/handle-approval.yml`ï¼š

```yaml
name: Handle Approval Comments

on:
  issue_comment:
    types: [created]

jobs:
  process:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Trigger Deployment
        if: steps.process.outputs.status == 'approved'
        run: |
          echo "Approved by: ${{ steps.process.outputs.approvers }}"
          echo "Tag created: ${{ steps.process.outputs.tag }}"
```

---

## æ“ä½œå‚è€ƒ

### æ“ä½œ

è¯¥æ“ä½œé€šè¿‡ `action` è¾“å…¥æ”¯æŒå››ç§æ“ä½œæ¨¡å¼ï¼š

| æ“ä½œ | æè¿° | ä½•æ—¶ä½¿ç”¨ |
|--------|-------------|-------------|
| `request` | åˆ›å»ºä¸€ä¸ªæ–°çš„å®¡æ‰¹è¯·æ±‚ issue | åœ¨å¯åŠ¨éƒ¨ç½²/å‘å¸ƒå·¥ä½œæµæ—¶ |
| `process-comment` | å¤„ç†å®¡æ‰¹/æ‹’ç»è¯„è®º | åœ¨ `issue_comment` äº‹ä»¶æ—¶ |
| `check` | æ£€æŸ¥å½“å‰å®¡æ‰¹çŠ¶æ€ | ç”¨äºè½®è¯¢å®¡æ‰¹å®Œæˆæƒ…å†µ |
| `close-issue` | å¤„ç† issue å…³é—­äº‹ä»¶ | åœ¨ `issues: [closed]` äº‹ä»¶æ—¶ |

### è¾“å…¥

#### æ ¸å¿ƒè¾“å…¥

| è¾“å…¥ | æè¿° | å¿…å¡« | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `action` | è¦æ‰§è¡Œçš„æ“ä½œï¼š`request`ï¼Œ`check`ï¼Œ`process-comment`ï¼Œ`close-issue` | æ˜¯ | - |
| `workflow` | é…ç½®ä¸­çš„å·¥ä½œæµåç§°ï¼ˆç”¨äº `request` æ“ä½œï¼‰ | `request` æ—¶å¿…å¡« | - |
| `version` | ç”¨äºæ ‡ç­¾åˆ›å»ºçš„è¯­ä¹‰ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼Œ`1.2.3` æˆ– `v1.2.3`ï¼‰ | å¦ | - |
| `issue_number` | issue ç¼–å·ï¼ˆç”¨äº `check`ã€`process-comment`ã€`close-issue`ï¼‰ | `check`/`process`/`close` æ—¶å¿…å¡« | - |
| `token` | ç”¨äº API æ“ä½œçš„ GitHub ä»¤ç‰Œ | æ˜¯ | - |

#### é…ç½®è¾“å…¥

| è¾“å…¥ | æè¿° | å¿…å¡« | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `config_path` | approvals.yml é…ç½®æ–‡ä»¶è·¯å¾„ | å¦ | `.github/approvals.yml` |
| `config_repo` | ç”¨äºå…±äº«é…ç½®çš„å¤–éƒ¨ä»“åº“ï¼ˆä¾‹å¦‚ï¼Œ`org/.github`ï¼‰ | å¦ | - |

#### è½®è¯¢è¾“å…¥ï¼ˆç”¨äº `check` æ“ä½œï¼‰

| è¾“å…¥ | æè¿° | å¿…å¡« | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `wait` | ç­‰å¾…å®¡æ‰¹å®Œæˆï¼ˆè½®è¯¢ï¼‰è€Œéç«‹å³è¿”å› | å¦ | `false` |
| `timeout` | ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œ`24h`ï¼Œ`1h30m`ï¼Œ`30m`ï¼‰ | å¦ | `72h` |

#### å›¢é˜Ÿæ”¯æŒè¾“å…¥

| è¾“å…¥ | æè¿° | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `app_id` | ç”¨äºå›¢é˜Ÿæˆå‘˜æ£€æŸ¥çš„ GitHub åº”ç”¨ ID | å¦ | - |
| `app_private_key` | ç”¨äºå›¢é˜Ÿæˆå‘˜æ£€æŸ¥çš„ GitHub åº”ç”¨ç§é’¥ | å¦ | - |

#### Jira é›†æˆè¾“å…¥

| è¾“å…¥ | æè¿° | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `jira_base_url` | Jira Cloud åŸºç¡€ URLï¼ˆä¾‹å¦‚ï¼Œ`https://yourcompany.atlassian.net`ï¼‰ | å¦ | - |
| `jira_user_email` | ç”¨äº API è®¤è¯çš„ Jira ç”¨æˆ·é‚®ç®± | å¦ | - |
| `jira_api_token` | ç”¨äºè®¤è¯çš„ Jira API ä»¤ç‰Œ | å¦ | - |
| `jira_update_fix_version` | å®¡æ‰¹æ—¶æ›´æ–° Jira é—®é¢˜çš„ä¿®å¤ç‰ˆæœ¬ | å¦ | `true` |
| `include_jira_issues` | åœ¨å®¡æ‰¹è¯·æ±‚æ­£æ–‡ä¸­åŒ…å« Jira é—®é¢˜ | å¦ | `true` |

#### éƒ¨ç½²è·Ÿè¸ªè¾“å…¥

| è¾“å…¥ | æè¿° | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `create_deployment` | åˆ›å»º GitHub éƒ¨ç½²ä»¥è¿›è¡Œè·Ÿè¸ª | å¦ | `true` |
| `deployment_environment` | ç›®æ ‡ç¯å¢ƒï¼ˆä¾‹å¦‚ï¼Œ`production`ï¼Œ`staging`ï¼‰ | å¦ | `production` |
| `deployment_environment_url` | éƒ¨ç½²ç¯å¢ƒçš„ URL | å¦ | - |

#### å…¶ä»–è¾“å…¥

| è¾“å…¥ | æè¿° | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|-------|-------------|----------|---------|
| `issue_action` | ç”¨äº `close-issue` çš„é—®é¢˜äº‹ä»¶åŠ¨ä½œï¼ˆ`closed`ï¼Œ`reopened`ï¼‰ | å¦ | - |
| `previous_tag` | ç”¨äºæ¯”è¾ƒæäº¤çš„å…ˆå‰æ ‡ç­¾ï¼ˆæœªæŒ‡å®šæ—¶è‡ªåŠ¨æ£€æµ‹ï¼‰ | å¦ | - |

### è¾“å‡º

#### æ ¸å¿ƒè¾“å‡º

| è¾“å‡º | æè¿° | é€‚ç”¨èŒƒå›´ |
|--------|-------------|---------------|
| `status` | å®¡æ‰¹çŠ¶æ€ï¼š`pending`ï¼ˆå¾…å¤„ç†ï¼‰ã€`approved`ï¼ˆå·²æ‰¹å‡†ï¼‰ã€`denied`ï¼ˆå·²æ‹’ç»ï¼‰ã€`timeout`ï¼ˆè¶…æ—¶ï¼‰ã€`tag_deleted`ï¼ˆæ ‡ç­¾å·²åˆ é™¤ï¼‰ã€`skipped`ï¼ˆå·²è·³è¿‡ï¼‰ | æ‰€æœ‰æ“ä½œ |
| `issue_number` | åˆ›å»ºæˆ–æ£€æŸ¥çš„é—®é¢˜ç¼–å· | æ‰€æœ‰æ“ä½œ |
| `issue_url` | å®¡æ‰¹é—®é¢˜çš„ URL | æ‰€æœ‰æ“ä½œ |

#### å®¡æ‰¹è¾“å‡º

| è¾“å‡º | æè¿° | é€‚ç”¨èŒƒå›´ |
|--------|-------------|---------------|
| `approvers` | å·²æ‰¹å‡†ç”¨æˆ·çš„é€—å·åˆ†éš”åˆ—è¡¨ | `process-comment`ã€`check` |
| `denier` | æ‹’ç»è¯·æ±‚çš„ç”¨æˆ· | `process-comment`ã€`check` |
| `satisfied_group` | æ»¡è¶³å®¡æ‰¹æ¡ä»¶çš„ç»„å | `process-comment`ã€`check` |
| `tag` | åˆ›å»ºçš„æ ‡ç­¾åç§° | `process-comment`ï¼ˆå®¡æ‰¹é€šè¿‡æ—¶ï¼‰ |
| `tag_deleted` | è¢«åˆ é™¤çš„æ ‡ç­¾ | `close-issue` |

#### Jira è¾“å‡º

| è¾“å‡º | æè¿° | é€‚ç”¨èŒƒå›´ |
|--------|-------------|---------------|
| `jira_issues` | æ­¤ç‰ˆæœ¬ä¸­çš„ Jira é—®é¢˜é”®é€—å·åˆ†éš”åˆ—è¡¨ | `request` |
| `jira_issues_json` | Jira é—®é¢˜è¯¦æƒ…çš„ JSON æ•°ç»„ï¼ˆé”®ã€æ‘˜è¦ã€ç±»å‹ã€çŠ¶æ€ï¼‰ | `request` |

#### éƒ¨ç½²è¾“å‡º

| è¾“å‡º | æè¿° | é€‚ç”¨èŒƒå›´ |
|--------|-------------|---------------|
| `deployment_id` | ç”¨äºçŠ¶æ€æ›´æ–°çš„ GitHub éƒ¨ç½² ID | `request` |
| `deployment_url` | GitHub ä¸­éƒ¨ç½²çš„ URL | `request` |

#### å‘å¸ƒè¯´æ˜è¾“å‡º

| è¾“å‡º | æè¿° | é€‚ç”¨èŒƒå›´ |
|--------|-------------|---------------|
| `release_notes` | æ ¹æ®æäº¤å’Œ Jira é—®é¢˜è‡ªåŠ¨ç”Ÿæˆçš„å‘å¸ƒè¯´æ˜ | `request` |
| `commits_count` | æ­¤ç‰ˆæœ¬ä¸­çš„æäº¤æ•°é‡ | `request` |

---

## é…ç½®å‚è€ƒ

### ç­–ç•¥

ç­–ç•¥å®šä¹‰äº†å¯é‡ç”¨çš„å®¡æ‰¹äººç»„ã€‚å…±æœ‰ä¸¤ç§æ ¼å¼ï¼š

#### ç®€å•æ ¼å¼

```yaml
policies:
  # Threshold-based: X of N must approve
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2

  # All must approve (AND logic)
  security:
    approvers: [team:security, security-lead]
    require_all: true

  # Mixed teams and individuals
  production:
    approvers:
      - team:sre
      - tech-lead
      - product-owner
    min_approvals: 2
```

#### é«˜çº§æ ¼å¼ï¼ˆæ¯æºé˜ˆå€¼ï¼‰

å¯¹äºå¤æ‚çš„éœ€æ±‚ï¼Œå¦‚â€œ2ä¸ªå¹³å°ä¸”1ä¸ªå®‰å…¨â€ï¼š

```yaml
policies:
  # Complex AND gate
  production-gate:
    from:
      - team: platform-engineers
        min_approvals: 2        # 2 of the platform team
      - team: security
        min_approvals: 1        # 1 of the security team
      - user: alice             # alice must also approve
    logic: and                  # ALL sources must be satisfied

  # Flexible OR gate
  flexible-review:
    from:
      - team: security
        require_all: true       # All security team
      - team: platform
        min_approvals: 2        # OR 2 platform members
    logic: or                   # ANY source is enough

  # Executive approval: any one exec
  exec-approval:
    from:
      - user: ceo
      - user: cto
      - user: vp-engineering
    logic: or

  # User list with threshold
  leads:
    from:
      - users: [tech-lead, product-lead, design-lead]
        min_approvals: 2
```

**æºç±»å‹ï¼š**

- `team: slug` - GitHub å›¢é˜Ÿï¼ˆéœ€è¦åº”ç”¨ä»¤ç‰Œï¼‰
- `user: username` - å•ä¸ªç”¨æˆ·ï¼ˆéšå¼ require_allï¼‰
- `users: [a, b, c]` - ç”¨æˆ·åˆ—è¡¨

**ç­–ç•¥çº§é€»è¾‘ï¼š**

- `logic: and` - å¿…é¡»æ»¡è¶³æ‰€æœ‰æºï¼ˆé»˜è®¤ï¼‰
- `logic: or` - æ»¡è¶³ä»»ä¸€æºå³å¯

#### å†…è”é€»è¾‘ï¼ˆæ··åˆ AND/ORï¼‰

å¯¹äºå¤æ‚è¡¨è¾¾å¼ï¼Œåœ¨æ¯ä¸ªæºä¸Šä½¿ç”¨ `logic:` æŒ‡å®šå…¶ä¸ä¸‹ä¸€ä¸ªçš„è¿æ¥æ–¹å¼ï¼š

```yaml
policies:
  # (2 security AND 2 platform) OR alice
  complex-gate:
    from:
      - team: security
        min_approvals: 2
        logic: and              # AND with next source
      - team: platform
        min_approvals: 2
        logic: or               # OR with next source
      - user: alice            # alice alone can satisfy

  # (security AND platform) OR (alice AND bob) OR manager
  multi-path:
    from:
      - team: security
        min_approvals: 1
        logic: and
      - team: platform
        min_approvals: 1
        logic: or               # End first AND group
      - user: alice
        logic: and
      - user: bob
        logic: or               # End second AND group
      - user: manager          # Third path
```

**è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š** AND çš„ç»‘å®šä¼˜å…ˆçº§é«˜äº ORï¼ˆæ ‡å‡†å¸ƒå°”é€»è¾‘ï¼‰ã€‚

è¡¨è¾¾å¼ `A and B or C and D` è¢«è§£æä¸º `(A AND B) OR (C AND D)`ã€‚

### å·¥ä½œæµ

å·¥ä½œæµå®šä¹‰å®¡æ‰¹è¦æ±‚å’Œæ“ä½œï¼š

```yaml
workflows:
  my-workflow:
    description: "Optional description"

    # Trigger conditions (for filtering)
    trigger:
      environment: production

    # Approval requirements (OR logic between items)
    require:
      - policy: dev-team
      - policy: security
      # Or inline approvers:
      - approvers: [alice, bob]
        require_all: true

    # Issue configuration
    issue:
      title: "Approval: {{version}}"
      body: |                          # Inline custom template (optional)
        ## My Custom Approval Issue
        Version: {{.Version}}
        Requested by: @{{.Requestor}}
        {{.GroupsTable}}
      body_file: "templates/my-template.md"  # Or load from file
      labels: [production, deploy]
      assignees_from_policy: true

    # Actions on approval
    on_approved:
      create_tag: true
      tag_prefix: "v"  # Creates v1.2.3
      close_issue: true
      comment: "Approved! Tag {{version}} created."

    # Actions on denial
    on_denied:
      close_issue: true
      comment: "Denied by {{denier}}."

    # Actions when issue is manually closed
    on_closed:
      delete_tag: true   # Delete the tag if issue is closed
      comment: "Deployment cancelled. Tag {{tag}} deleted."
```

### æ ‡ç­¾é…ç½®

æ§åˆ¶æ¯ä¸ªå·¥ä½œæµä¸­æ ‡ç­¾çš„åˆ›å»ºæ–¹å¼ï¼š

```yaml
workflows:
  dev-deploy:
    require:
      - policy: dev-team
    on_approved:
      tagging:
        enabled: true
        start_version: "0.1.0"      # No 'v' prefix, start at 0.1.0
        auto_increment: patch        # Auto-bump: 0.1.0 -> 0.1.1 -> 0.1.2
        env_prefix: "dev-"           # Creates: dev-0.1.0, dev-0.1.1

  staging-deploy:
    require:
      - policy: qa-team
    on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # 'v' prefix (inferred from start_version)
        auto_increment: minor        # v1.0.0 -> v1.1.0 -> v1.2.0
        env_prefix: "staging-"       # Creates: staging-v1.0.0

  production-deploy:
    require:
      - policy: prod-team
    on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # Manual version required (no auto_increment)
```

**æ ‡ç­¾é€‰é¡¹ï¼š**

| é€‰é¡¹ | æè¿° |
|--------|-------------|
| `enabled` | å¯ç”¨æ ‡ç­¾åˆ›å»º |
| `start_version` | èµ·å§‹ç‰ˆæœ¬å’Œæ ¼å¼ï¼ˆä¾‹å¦‚ï¼Œâ€œv1.0.0â€æˆ–â€œ1.0.0â€ï¼‰ |
| `prefix` | ç‰ˆæœ¬å‰ç¼€ï¼ˆå¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä»`start_version`æ¨æ–­ï¼‰ |
| `auto_increment` | è‡ªåŠ¨é€’å¢ï¼š`major`ã€`minor`ã€`patch`ï¼Œæˆ–çœç•¥ä»¥æ‰‹åŠ¨æ“ä½œ |
| `env_prefix` | ç¯å¢ƒå‰ç¼€ï¼ˆä¾‹å¦‚ï¼Œâ€œdev-â€åˆ›å»ºâ€œdev-v1.0.0â€ï¼‰ |

### è‡ªå®šä¹‰é—®é¢˜æ¨¡æ¿

æ‚¨å¯ä»¥ä½¿ç”¨ Go æ¨¡æ¿å®Œå…¨è‡ªå®šä¹‰é—®é¢˜æ­£æ–‡ã€‚ä½¿ç”¨ `body` è¿›è¡Œå†…è”æ¨¡æ¿ï¼Œæˆ–ä½¿ç”¨ `body_file` ä»æ–‡ä»¶åŠ è½½ã€‚

**å¯ç”¨æ¨¡æ¿å˜é‡ï¼š**

| å˜é‡ | æè¿° |
|----------|-------------|
| `{{.Title}}` | é—®é¢˜æ ‡é¢˜ |
| `{{.Description}}` | å·¥ä½œæµæè¿° |
| `{{.Version}}` | Semver ç‰ˆæœ¬ |
| `{{.Requestor}}` | å‘èµ·è¯·æ±‚çš„ GitHub ç”¨æˆ·å |
| `{{.Environment}}` | ç¯å¢ƒåç§° |
| `{{.RunURL}}` | å·¥ä½œæµè¿è¡Œé“¾æ¥ |
| `{{.RepoURL}}` | ä»“åº“ URL |
| `{{.CommitSHA}}` | å®Œæ•´æäº¤ SHA |
| `{{.CommitURL}}` | æäº¤é“¾æ¥ |
| `{{.Branch}}` | åˆ†æ”¯åç§° |
| `{{.GroupsTable}}` | é¢„æ¸²æŸ“çš„å®¡æ‰¹çŠ¶æ€è¡¨ |
| `{{.Timestamp}}` | è¯·æ±‚æ—¶é—´æˆ³ |
| `{{.PreviousVersion}}` | ä¸Šä¸€ä¸ªç‰ˆæœ¬/æ ‡ç­¾ |
| `{{.CommitsCount}}` | æ­¤æ¬¡å‘å¸ƒçš„æäº¤æ•°é‡ |
| `{{.HasJiraIssues}}` | å¸ƒå°”å€¼ - æ˜¯å¦å­˜åœ¨ Jira é—®é¢˜ |
| `{{.JiraIssues}}` | Jira é—®é¢˜æ•°æ®æ•°ç»„ |
| `{{.JiraIssuesTable}}` | é¢„æ¸²æŸ“çš„ Jira é—®é¢˜è¡¨ |
| `{{.PipelineTable}}` | é¢„æ¸²æŸ“çš„éƒ¨ç½²æµæ°´çº¿è¡¨ |
| `{{.PipelineMermaid}}` | é¢„æ¸²æŸ“çš„ Mermaid æµç¨‹å›¾ |
| `{{.Vars.key}}` | è‡ªå®šä¹‰å˜é‡ |

**æ¨¡æ¿å‡½æ•°ï¼š**

| å‡½æ•° | ç¤ºä¾‹ | æè¿° |
|----------|---------|-------------|
| `slice` | `{{slice .CommitSHA 0 7}}` | å­å­—ç¬¦ä¸²ï¼ˆçŸ­SHAï¼‰ |
| `title` | `{{.Environment \| title}}` | æ ‡é¢˜å¤§å°å†™ |
| `upper` | `{{.Version \| upper}}` | å¤§å†™ |
| `lower` | `{{.Version \| lower}}` | å°å†™ |
| `join` | `{{join .Groups ","}}` | è¿æ¥æ•°ç»„ |
| `contains` | `{{if contains .Branch "feature"}}` | æ£€æŸ¥å­å­—ç¬¦ä¸² |
| `replace` | `{{replace .Version "v" ""}}` | æ›¿æ¢å­—ç¬¦ä¸² |
| `default` | `{{default "N/A" .Environment}}` | é»˜è®¤å€¼ |

**ç¤ºä¾‹è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶** (`.github/templates/deploy.md`):

```markdown
## {{.Title}}

### Release Information

- **Version:** `{{.Version}}`
- **Requested by:** @{{.Requestor}}
{{- if .CommitSHA}}
- **Commit:** [{{slice .CommitSHA 0 7}}](https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/{{.CommitURL}})
{{- end}}
{{- if .CommitsCount}}
- **Changes:** {{.CommitsCount}} commits since {{.PreviousVersion}}
{{- end}}

{{if .HasJiraIssues}}
### Jira Issues

{{.JiraIssuesTable}}
{{end}}

### Approval Status

{{.GroupsTable}}

---

**Approve:** Comment `approve` | **Deny:** Comment `deny`
```

### é»˜è®¤å€¼

é€‚ç”¨äºæ‰€æœ‰å·¥ä½œæµçš„å…¨å±€é»˜è®¤å€¼ï¼š

```yaml
defaults:
  timeout: 72h                    # Default approval timeout
  allow_self_approval: false      # Whether requestors can approve their own requests
  issue_labels:                   # Labels added to all approval issues
    - approval-required
```

### è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

é…ç½®ç‰ˆæœ¬å¤„ç†ï¼š

```yaml
semver:
  prefix: "v"              # Tag prefix (v1.2.3)
  strategy: input          # Use version from input
  validate: true           # Validate semver format
  allow_prerelease: true   # Allow prerelease versions (e.g., v1.0.0-beta.1)
  auto:                    # Label-based auto-increment (when strategy: auto)
    major_labels: [breaking, major]
    minor_labels: [feature, minor]
    patch_labels: [fix, patch, bug]
```

---

## å®Œæ•´é…ç½®å‚è€ƒ

æœ¬èŠ‚è®°å½•äº† `approvals.yml` ä¸­**æ‰€æœ‰é…ç½®é€‰é¡¹**ã€‚

### é¡¶å±‚ç»“æ„

```yaml
version: 1                    # Required: config version (always 1)
defaults: { ... }             # Optional: global defaults
policies: { ... }             # Required: reusable approval policies
workflows: { ... }            # Required: approval workflows
semver: { ... }               # Optional: version handling settings
```

### `defaults` é€‰é¡¹

| Key | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `timeout` | duration | `72h` | é˜»å¡ `check` æ“ä½œä¸” `wait: true` çš„è¶…æ—¶æ—¶é—´ã€‚ä½¿ç”¨å°æ—¶ï¼ˆä¾‹å¦‚ï¼Œ`168h` è¡¨ç¤º 1 å‘¨ï¼‰ã€‚äº‹ä»¶é©±åŠ¨å·¥ä½œæµä¸éœ€è¦ã€‚ |
| `allow_self_approval` | bool | `false` | è¯·æ±‚è€…æ˜¯å¦å¯ä»¥æ‰¹å‡†è‡ªå·±çš„è¯·æ±‚ |
| `issue_labels` | string[] | `[]` | æ·»åŠ åˆ°æ‰€æœ‰å®¡æ‰¹é—®é¢˜çš„æ ‡ç­¾ |

### `policies.<name>` é€‰é¡¹ï¼ˆç®€å•æ ¼å¼ï¼‰

| Key | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `approvers` | string[] | - | ç”¨æˆ·ååˆ—è¡¨æˆ– `team:slug` å¼•ç”¨ |
| `min_approvals` | int | 0 | æ‰€éœ€çš„å®¡æ‰¹æ•°é‡ï¼ˆ0 = ä½¿ç”¨ `require_all`ï¼‰ |
| `require_all` | bool | `false` | è‹¥ä¸º trueï¼Œåˆ™æ‰€æœ‰å®¡æ‰¹è€…å¿…é¡»æ‰¹å‡† |

### `policies.<name>` é€‰é¡¹ï¼ˆé«˜çº§æ ¼å¼ï¼‰

| Key | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `from` | source[] | - | å¸¦æœ‰å•ç‹¬é˜ˆå€¼çš„å®¡æ‰¹è€…æ¥æºåˆ—è¡¨ |
| `logic` | string | `"and"` | å¦‚ä½•ç»„åˆæ¥æºï¼š`"and"` æˆ– `"or"` |

**å®¡æ‰¹è€…æ¥æºé€‰é¡¹ï¼ˆ`from[]`ï¼‰ï¼š**

| Key | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `team` | string | - | å›¢é˜Ÿç®€ç§°ï¼ˆä¾‹å¦‚ï¼Œ`"platform"` æˆ– `"org/platform"`ï¼‰ |
| `user` | string | - | å•ä¸ªç”¨æˆ·å |
| `users` | string[] | - | ç”¨æˆ·ååˆ—è¡¨ |
| `min_approvals` | int | 1 | è¯¥æ¥æºæ‰€éœ€çš„å®¡æ‰¹æ•° |
| `require_all` | bool | `false` | è¯¥æ¥æºçš„æ‰€æœ‰äººå¿…é¡»æ‰¹å‡† |
| `logic` | string | - | åˆ°ä¸‹ä¸€ä¸ªæ¥æºçš„é€»è¾‘ï¼š`"and"` æˆ– `"or"` |

### `workflows.<name>` é€‰é¡¹

| Key | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `description` | string | - | äººç±»å¯è¯»çš„æè¿° |
| `trigger` | map | - | è§¦å‘æ¡ä»¶ï¼ˆç”¨äºè¿‡æ»¤ï¼‰ |
| `require` | requirement[] | - | **å¿…éœ€ï¼š** å®¡æ‰¹è¦æ±‚ï¼ˆé¡¹ä¹‹é—´ä¸º OR é€»è¾‘ï¼‰ |
| `issue` | object | - | é—®é¢˜åˆ›å»ºè®¾ç½® |
| `on_approved` | object | - | å®¡æ‰¹é€šè¿‡æ—¶çš„æ“ä½œ |
| `on_denied` | object | - | å®¡æ‰¹æ‹’ç»æ—¶çš„æ“ä½œ |
| `on_closed` | object | - | æ‰‹åŠ¨å…³é—­é—®é¢˜æ—¶çš„æ“ä½œ |
| `pipeline` | object | - | æ¸è¿›å¼éƒ¨ç½²æµæ°´çº¿é…ç½® |

### `workflows.<name>.require[]` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `policy` | string | - | å¼•ç”¨å·²å®šä¹‰çš„ç­–ç•¥ |
| `approvers` | string[] | - | å†…è”å®¡æ‰¹äººï¼ˆç­–ç•¥çš„æ›¿ä»£æ–¹æ¡ˆï¼‰ |
| `min_approvals` | int | - | è¦†ç›–ç­–ç•¥çš„æœ€å°å®¡æ‰¹æ•° |
| `require_all` | bool | - | è¦†ç›–ç­–ç•¥çš„å…¨éƒ¨é€šè¿‡è¦æ±‚ |

### `workflows.<name>.issue` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `title` | string | `"Approval Required: {workflow}"` | é—®é¢˜æ ‡é¢˜ï¼ˆæ”¯æŒ `{{version}}`ã€`{{environment}}`ã€`{{workflow}}`ï¼‰ |
| `body` | string | - | è‡ªå®šä¹‰é—®é¢˜æ­£æ–‡æ¨¡æ¿ï¼ˆGo æ¨¡æ¿è¯­æ³•ï¼‰ |
| `body_file` | string | - | æ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äº `.github/`ï¼‰ |
| `labels` | string[] | `[]` | æ­¤å·¥ä½œæµçš„é¢å¤–æ ‡ç­¾ |
| `assignees_from_policy` | bool | `false` | è‡ªåŠ¨åˆ†é…ç­–ç•¥ä¸­çš„ä¸ªäººç”¨æˆ·ï¼ˆæœ€å¤š 10 ä¸ªï¼‰ |

### `workflows.<name>.on_approved` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `create_tag` | bool | `false` | åˆ›å»º git æ ‡ç­¾ï¼ˆä½¿ç”¨è¾“å…¥ç‰ˆæœ¬ï¼‰ |
| `close_issue` | bool | `false` | å®¡æ‰¹åå…³é—­é—®é¢˜ |
| `comment` | string | - | å‘å¸ƒè¯„è®ºï¼ˆæ”¯æŒ `{{version}}`ã€`{{satisfied_group}}`ï¼‰ |
| `tagging` | object | - | é«˜çº§æ ‡ç­¾é…ç½® |

### `workflows.<name>.on_approved.tagging` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `enabled` | bool | `false` | å¯ç”¨æ ‡ç­¾åˆ›å»º |
| `start_version` | string | `"0.0.0"` | åˆå§‹ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ`"v1.0.0"` æˆ– `"1.0.0"`ï¼‰ |
| `prefix` | string | ï¼ˆæ¨æ–­ï¼‰ | ç‰ˆæœ¬å‰ç¼€ï¼ˆæ ¹æ® `start_version` æ¨æ–­ï¼‰ |
| `auto_increment` | string | - | è‡ªåŠ¨é€’å¢ï¼š`"major"`ã€`"minor"`ã€`"patch"`ï¼Œæˆ–çœç•¥ä»¥æ‰‹åŠ¨æ–¹å¼ |
| `env_prefix` | string | - | ç¯å¢ƒå‰ç¼€ï¼ˆä¾‹å¦‚ï¼Œ`"dev-"` åˆ›å»º `"dev-v1.0.0"`ï¼‰ |

### `workflows.<name>.on_denied` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `close_issue` | bool | `false` | æ‹’ç»åå…³é—­ issue |
| `comment` | string | - | è¦å‘å¸ƒçš„è¯„è®ºï¼ˆæ”¯æŒ `{{denier}}`ï¼‰ |

### `workflows.<name>.on_closed` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `delete_tag` | bool | `false` | å…³é—­ issue æ—¶åˆ é™¤å…³è”æ ‡ç­¾ |
| `comment` | string | - | è¦å‘å¸ƒçš„è¯„è®ºï¼ˆæ”¯æŒ `{{tag}}`ã€`{{version}}`ï¼‰ |

### `workflows.<name>.pipeline` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `stages` | stage[] | - | **å¿…éœ€ï¼š** æœ‰åºçš„éƒ¨ç½²é˜¶æ®µåˆ—è¡¨ |
| `track_prs` | bool | `false` | åœ¨ issue å†…å®¹ä¸­åŒ…å«åˆå¹¶çš„ PR |
| `track_commits` | bool | `false` | åœ¨ issue å†…å®¹ä¸­åŒ…å«æäº¤ |
| `compare_from_tag` | string | - | ç”¨äºæ¯”è¾ƒçš„æ ‡ç­¾æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œ`"v*"`ï¼‰ |
| `show_mermaid_diagram` | bool | `true` | æ˜¾ç¤ºç®¡é“é˜¶æ®µçš„ Mermaid æµç¨‹å›¾ |
| `release_strategy` | object | - | å‘å¸ƒå€™é€‰é€‰æ‹©ç­–ç•¥ |

### `workflows.<name>.pipeline.stages[]` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `name` | string | - | **å¿…éœ€ï¼š** é˜¶æ®µåç§°ï¼ˆä¾‹å¦‚ï¼Œ`"dev"`ã€`"prod"`ï¼‰ |
| `environment` | string | - | GitHub ç¯å¢ƒåç§° |
| `policy` | string | - | æœ¬é˜¶æ®µçš„å®¡æ‰¹ç­–ç•¥ |
| `approvers` | string[] | - | å†…è”å®¡æ‰¹äººï¼ˆä½œä¸ºç­–ç•¥çš„æ›¿ä»£ï¼‰ |
| `on_approved` | string | - | é˜¶æ®µè¢«æ‰¹å‡†æ—¶å‘å¸ƒçš„è¯„è®º |
| `create_tag` | bool | `false` | åœ¨æ­¤é˜¶æ®µåˆ›å»º git æ ‡ç­¾ |
| `is_final` | bool | `false` | æ­¤é˜¶æ®µåå…³é—­é—®é¢˜ |
| `auto_approve` | bool | `false` | è‡ªåŠ¨æ‰¹å‡†ï¼Œæ— éœ€äººå·¥å¹²é¢„ |

### `workflows.<name>.pipeline.release_strategy` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `type` | string | `"tag"` | ç­–ç•¥: `"tag"`ï¼Œ`"branch"`ï¼Œ`"label"`ï¼Œ`"milestone"` |
| `branch` | object | - | åˆ†æ”¯ç­–ç•¥è®¾ç½® |
| `label` | object | - | æ ‡ç­¾ç­–ç•¥è®¾ç½® |
| `milestone` | object | - | é‡Œç¨‹ç¢‘ç­–ç•¥è®¾ç½® |
| `auto_create` | object | - | è‡ªåŠ¨åˆ›å»ºä¸‹ä¸€ä¸ªå‘å¸ƒäº§ç‰© |

### `release_strategy.branch` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `pattern` | string | `"release/{{version}}"` | åˆ†æ”¯å‘½åæ¨¡å¼ |
| `base_branch` | string | `"main"` | æ¯”è¾ƒåŸºå‡†åˆ†æ”¯ |
| `delete_after_release` | bool | `false` | ç”Ÿäº§éƒ¨ç½²ååˆ é™¤åˆ†æ”¯ |

### `release_strategy.label` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `pattern` | string | `"release:{{version}}"` | æ ‡ç­¾å‘½åæ¨¡å¼ |
| `pending_label` | string | - | ç­‰å¾…å‘å¸ƒåˆ†é…çš„ PR æ ‡ç­¾ |
| `remove_after_release` | bool | `false` | ç”Ÿäº§éƒ¨ç½²åç§»é™¤æ ‡ç­¾ |

### `release_strategy.milestone` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `pattern` | string | `"v{{version}}"` | é‡Œç¨‹ç¢‘å‘½åæ¨¡å¼ |
| `close_after_release` | bool | `false` | ç”Ÿäº§éƒ¨ç½²åå…³é—­é‡Œç¨‹ç¢‘ |

### `release_strategy.auto_create` é€‰é¡¹

| é”® | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|-----|------|---------|-------------|
| `enabled` | bool | `false` | å¯ç”¨åœ¨æœ€ç»ˆé˜¶æ®µå®Œæˆæ—¶è‡ªåŠ¨åˆ›å»º |
| `next_version` | string | `"patch"` | ç‰ˆæœ¬é€’å¢: `"patch"`ï¼Œ`"minor"`ï¼Œ`"major"` |
| `create_issue` | bool | `false` | ä¸ºä¸‹æ¬¡å‘å¸ƒåˆ›å»ºæ–°çš„å®¡æ‰¹é—®é¢˜ |
| `comment` | string | - | å…³äºä¸‹æ¬¡å‘å¸ƒçš„è¯„è®º |

### `semver` é€‰é¡¹

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `prefix` | string | `"v"` | æ ‡ç­¾å‰ç¼€ |
| `strategy` | string | `"input"` | ç‰ˆæœ¬ç­–ç•¥: `"input"`ï¼Œ`"auto"` |
| `validate` | bool | `false` | éªŒè¯ semver æ ¼å¼ |
| `allow_prerelease` | bool | `false` | å…è®¸é¢„å‘å¸ƒç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ`v1.0.0-beta.1`ï¼‰ |
| `auto` | object | - | åŸºäºæ ‡ç­¾çš„è‡ªåŠ¨é€’å¢è®¾ç½® |

### `semver.auto` é€‰é¡¹

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `major_labels` | string[] | `[]` | è§¦å‘ä¸»ç‰ˆæœ¬é€’å¢çš„ PR æ ‡ç­¾ |
| `minor_labels` | string[] | `[]` | è§¦å‘æ¬¡ç‰ˆæœ¬é€’å¢çš„ PR æ ‡ç­¾ |
| `patch_labels` | string[] | `[]` | è§¦å‘è¡¥ä¸ç‰ˆæœ¬é€’å¢çš„ PR æ ‡ç­¾ |

---

## åŠŸèƒ½è¯¦æƒ…

### å®¡æ‰¹å…³é”®è¯

ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨é—®é¢˜ä¸­è¯„è®ºæ¥æ‰¹å‡†æˆ–æ‹’ç»è¯·æ±‚ï¼š

**æ‰¹å‡†å…³é”®è¯ï¼š** `approve`ï¼Œ`approved`ï¼Œ`lgtm`ï¼Œ`yes`ï¼Œ`/approve`

**æ‹’ç»å…³é”®è¯ï¼š** `deny`ï¼Œ`denied`ï¼Œ`reject`ï¼Œ`rejected`ï¼Œ`no`ï¼Œ`/deny`

### å›¢é˜Ÿæ”¯æŒ

è¦ä½¿ç”¨åŸºäº GitHub å›¢é˜Ÿçš„å®¡æ‰¹è€…ï¼Œæ‚¨éœ€è¦æå‡æƒé™ã€‚æ ‡å‡†çš„ `GITHUB_TOKEN` æ— æ³•åˆ—å‡ºå›¢é˜Ÿæˆå‘˜ã€‚è¯·ä½¿ç”¨ GitHub åº”ç”¨ä»¤ç‰Œï¼š

```yaml
jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Generate GitHub App token
      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}

      # Use the app token for team membership checks
      - uses: jamengual/enterprise-approval-engine@v1
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
```

**æ‰€éœ€çš„ GitHub åº”ç”¨æƒé™ï¼š**

- `Organization > Members: Read` - ç”¨äºåˆ—å‡ºå›¢é˜Ÿæˆå‘˜

### æ¸è¿›å¼éƒ¨ç½²æµæ°´çº¿

é€šè¿‡å•ä¸ªå®¡æ‰¹é—®é¢˜è·Ÿè¸ªå¤šä¸ªç¯å¢ƒçš„éƒ¨ç½²ã€‚æ¯ä¸ªé˜¶æ®µè·å¾—æ‰¹å‡†åï¼Œé—®é¢˜ä¼šæ›´æ–°ä»¥æ˜¾ç¤ºè¿›åº¦ï¼Œå¹¶è‡ªåŠ¨æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚

#### æµæ°´çº¿é…ç½®

```yaml
# .github/approvals.yml or external config
version: 1

policies:
  developers:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1

  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1

  tech-leads:
    approvers: [lead1, lead2]
    min_approvals: 1

  production-approvers:
    approvers: [sre1, sre2, security-lead]
    require_all: true

workflows:
  deploy:
    description: "Deploy through all environments (dev â†’ qa â†’ stage â†’ prod)"
    require:
      - policy: developers  # Initial approval to start pipeline
    pipeline:
      track_prs: true       # Include PRs in the issue body
      track_commits: true   # Include commits in the issue body
      stages:
        - name: dev
          environment: development
          policy: developers
          on_approved: "âœ… **DEV** deployment approved! Proceeding to QA..."
        - name: qa
          environment: qa
          policy: qa-team
          on_approved: "âœ… **QA** deployment approved! Proceeding to STAGING..."
        - name: stage
          environment: staging
          policy: tech-leads
          on_approved: "âœ… **STAGING** deployment approved! Ready for PRODUCTION..."
        - name: prod
          environment: production
          policy: production-approvers
          on_approved: "ğŸš€ **PRODUCTION** deployment complete!"
          create_tag: true   # Create tag when PROD is approved
          is_final: true     # Close issue after this stage
    on_approved:
      close_issue: true
      comment: |
        ğŸ‰ **Deployment Complete!**

        Version `{{version}}` has been deployed to all environments.
```

#### æµæ°´çº¿å·¥ä½œæµç¨‹ç¤ºä¾‹

```yaml
# .github/workflows/request-pipeline.yml
name: Request Pipeline Deployment

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string

permissions:
  contents: write
  issues: write
  pull-requests: read  # Required for PR tracking

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Needed for commit/PR comparison

      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Output Results
        run: |
          echo "## Pipeline Deployment Started" >> $GITHUB_STEP_SUMMARY
          echo "- **Issue:** #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
```

#### å·¥ä½œåŸç†

1. **é—®é¢˜åˆ›å»º**ï¼šè§¦å‘æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºæ‰€æœ‰é˜¶æ®µçš„å•ä¸ªé—®é¢˜ï¼ŒåŒ…å«å¯è§†åŒ–çš„ Mermaid å›¾è¡¨å’Œè¿›åº¦è¡¨ï¼š

```markdown
## ğŸš€ éƒ¨ç½²æµæ°´çº¿ï¼šv1.2.0

### æµæ°´çº¿æµç¨‹

â€‹```mermaid
flowchart LR
    DEV(â³ å¼€å‘)
    QA(â¬œ æµ‹è¯•)
    STAGE(â¬œ é¢„å‘å¸ƒ)
    PROD(â¬œ ç”Ÿäº§)
    DEV --> QA --> STAGE --> PROD

    classDef completed fill:#28a745,stroke:#1e7e34,color:#fff
    classDef current fill:#ffc107,stroke:#d39e00,color:#000
    classDef pending fill:#6c757d,stroke:#545b62,color:#fff
    class DEV current
    class QA,STAGE,PROD pending
â€‹```

### Deployment Progress

| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | â³ Awaiting | - | - |
| QA | â¬œ Pending | - | - |
| STAGE | â¬œ Pending | - | - |
| PROD | â¬œ Pending | - | - |

**Current Stage:** DEV
```

Mermaid å›¾è¡¨æä¾›äº†å¸¦æœ‰é¢œè‰²ç¼–ç èŠ‚ç‚¹çš„ä¸€ç›®äº†ç„¶è§†å›¾ï¼š
- ğŸŸ¢ **ç»¿è‰²** - å·²å®Œæˆé˜¶æ®µ
- ğŸŸ¡ **é»„è‰²** - ç­‰å¾…æ‰¹å‡†çš„å½“å‰é˜¶æ®µ
- âšª **ç°è‰²** - å¾…å¤„ç†é˜¶æ®µ
- ğŸ”µ **é’è‰²** - è‡ªåŠ¨æ‰¹å‡†é˜¶æ®µ

è¦ç¦ç”¨ Mermaid å›¾è¡¨ï¼Œè¯·åœ¨æµæ°´çº¿é…ç½®ä¸­è®¾ç½® `show_mermaid_diagram: false`ã€‚

2. **é˜¶æ®µè¿›å±•**ï¼šè¯„è®º `approve` ä»¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚å›¾è¡¨å’Œè¡¨æ ¼ä¼šè‡ªåŠ¨æ›´æ–°ï¼š

```markdown
| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | âœ… Deployed | @developer1 | Dec 9 10:30 |
| QA | âœ… Deployed | @qa-lead | Dec 9 14:15 |
| STAGE | â³ Awaiting | - | - |
| PROD | â¬œ Pending | - | - |

**Current Stage:** STAGE
```
3. **PR å’Œæäº¤è·Ÿè¸ª**ï¼šå‘å¸ƒç®¡ç†å‘˜å¯ä»¥å‡†ç¡®çœ‹åˆ°æ­£åœ¨éƒ¨ç½²çš„å†…å®¹ï¼š


```markdown
### Pull Requests in this Release

| PR | Title | Author |
|----|-------|--------|
| [#42](https://...) | Add user authentication | @alice |
| [#45](https://...) | Fix payment processing bug | @bob |

### Commits

- [`abc1234`](https://...) feat: add OAuth2 support
- [`def5678`](https://...) fix: handle null payments
```
4. **å®Œæˆ**ï¼šå½“æœ€ç»ˆé˜¶æ®µè¢«æ‰¹å‡†æ—¶ï¼š
   - åˆ›å»ºæ ‡ç­¾ï¼ˆå¦‚æœ `create_tag: true`ï¼‰
   - å‘å¸ƒå®Œæˆè¯„è®º
   - è‡ªåŠ¨å…³é—­é—®é¢˜

#### æµæ°´çº¿é˜¶æ®µé€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ |
|--------|-------------|
| `name` | é˜¶æ®µåç§°ï¼ˆåœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºï¼‰ |
| `environment` | GitHub ç¯å¢ƒåç§° |
| `policy` | æœ¬é˜¶æ®µçš„å®¡æ‰¹ç­–ç•¥ |
| `approvers` | å†…è”å®¡æ‰¹äººï¼ˆç­–ç•¥çš„æ›¿ä»£æ–¹æ¡ˆï¼‰ |
| `on_approved` | é˜¶æ®µæ‰¹å‡†æ—¶å‘å¸ƒçš„æ¶ˆæ¯ |
| `create_tag` | åœ¨æ­¤é˜¶æ®µåˆ›å»º git æ ‡ç­¾ |
| `is_final` | åœ¨æ­¤é˜¶æ®µåå…³é—­é—®é¢˜ |
| `auto_approve` | è‡ªåŠ¨æ‰¹å‡†æ­¤é˜¶æ®µï¼Œæ— éœ€äººå·¥å¹²é¢„ |
| `approval_mode` | è¦†ç›–æœ¬é˜¶æ®µçš„å·¥ä½œæµå®¡æ‰¹æ¨¡å¼ |

#### å®¡æ‰¹æ¨¡å¼

é€‰æ‹©å®¡æ‰¹äººå¦‚ä½•ä¸å®¡æ‰¹è¯·æ±‚äº¤äº’ï¼š

| æ¨¡å¼ | è¯´æ˜ |
|------|-------------|
| `comments` | ï¼ˆé»˜è®¤ï¼‰å®¡æ‰¹äººåœ¨é—®é¢˜ä¸­è¯„è®º `/approve` æˆ– `approve` |
| `sub_issues` | ä¸ºæ¯ä¸ªé˜¶æ®µåˆ›å»ºå­é—®é¢˜ - å…³é—­å­é—®é¢˜å³è¡¨ç¤ºæ‰¹å‡† |
| `hybrid` | å„é˜¶æ®µæ··åˆä½¿ç”¨æ¨¡å¼ - åœ¨æ¯ä¸ªé˜¶æ®µä½¿ç”¨ `approval_mode` |

**å­é—®é¢˜å®¡æ‰¹ç¤ºä¾‹ï¼š**


```yaml
workflows:
  deploy:
    approval_mode: sub_issues
    sub_issue_settings:
      title_template: "â³ Approve: {{stage}} for {{version}}"  # Changes to âœ… when approved
      labels: [approval-stage]
      protection:
        only_assignee_can_close: true   # Prevents unauthorized approvals
        prevent_parent_close: true       # Parent can't close until all approved
    pipeline:
      stages:
        - name: dev
          policy: developers
        - name: prod
          policy: production-approvers
```

å¯¹äºå­é—®é¢˜ï¼Œçˆ¶é—®é¢˜æ˜¾ç¤ºä¸€ä¸ªå®¡æ‰¹å­é—®é¢˜çš„è¡¨æ ¼ï¼š

```markdown
### ğŸ“‹ Approval Sub-Issues

| Stage | Sub-Issue | Status | Assignees |
|-------|-----------|--------|----------|
| DEV | #124 | â³ Awaiting | @alice, @bob |
| PROD | #125 | â³ Awaiting | @sre1, @sre2 |
```

**æ··åˆæ¨¡å¼ï¼ˆæ¯é˜¶æ®µè¦†ç›–ï¼‰ï¼š**

```yaml
workflows:
  deploy:
    approval_mode: comments  # Default for this workflow
    pipeline:
      stages:
        - name: dev
          policy: developers
          # Uses comments (workflow default)
        - name: prod
          policy: production-approvers
          approval_mode: sub_issues  # Override for production only
```

#### å¢å¼ºçš„è¯„è®ºç”¨æˆ·ä½“éªŒ

è¯¥æ“ä½œåŒ…æ‹¬å¢å¼ºçš„åŸºäºè¯„è®ºçš„å®¡æ‰¹ç”¨æˆ·ä½“éªŒï¼š

- **è¡¨æƒ…ç¬¦å·ååº”**ï¼šå®¡æ‰¹è¯„è®ºä¸Šçš„è‡ªåŠ¨ååº”
  - ğŸ‘ é€šè¿‡
  - ğŸ‘ æ‹’ç»
  - ğŸ‘€ å·²æŸ¥çœ‹ï¼ˆå¤„ç†ä¸­ï¼‰

- **å¿«é€Ÿæ“ä½œéƒ¨åˆ†**ï¼šé—®é¢˜æ­£æ–‡åŒ…å«å‘½ä»¤å‚è€ƒè¡¨ï¼š

```markdown
### âš¡ Quick Actions

| Action | Command | Description |
|--------|---------|-------------|
| âœ… Approve | `/approve` | Approve the **DEV** stage |
| âŒ Deny | `/deny [reason]` | Deny with optional reason |
| ğŸ“Š Status | `/status` | Show current approval status |
```

**é€šè¿‡ `comment_settings` é…ç½®ï¼š**

```yaml
workflows:
  deploy:
    comment_settings:
      react_to_comments: true     # Add emoji reactions (default: true)
      show_quick_actions: true    # Show Quick Actions section (default: true)
```

#### å¯¹ä½çº§ç¯å¢ƒè‡ªåŠ¨æ‰¹å‡†

åœ¨åº”è‡ªåŠ¨æ‰¹å‡†ä¸”æ— éœ€äººå·¥å¹²é¢„çš„æµæ°´çº¿é˜¶æ®µä½¿ç”¨ `auto_approve: true`ã€‚è¿™éå¸¸é€‚ç”¨äºè¯¸å¦‚ `dev` æˆ– `integration` ç­‰ä½çº§ç¯å¢ƒï¼Œæ—¢èƒ½åŠ å¿«æµæ°´çº¿é€Ÿåº¦ï¼Œåˆèƒ½ä¿æŒå¯¹ç”Ÿäº§ç¯å¢ƒçš„å®¡æ‰¹é—¨æ§ã€‚

**åŒ…å«è‡ªåŠ¨æ‰¹å‡†çš„ç¤ºä¾‹ï¼š**

```yaml
workflows:
  deploy:
    description: "Deploy through environments"
    pipeline:
      stages:
        - name: dev
          environment: development
          auto_approve: true              # Automatically approved
          on_approved: "ğŸ¤– DEV auto-deployed"
        - name: integration
          environment: integration
          auto_approve: true              # Automatically approved
          on_approved: "ğŸ¤– INTEGRATION auto-deployed"
        - name: staging
          environment: staging
          policy: qa-team                 # Requires manual approval
          on_approved: "âœ… STAGING approved"
        - name: production
          environment: production
          policy: production-approvers    # Requires manual approval
          create_tag: true
          is_final: true
```

**å·¥ä½œåŸç†ï¼š**

1. å½“åˆ›å»ºç®¡é“é—®é¢˜æ—¶ï¼Œæ‰€æœ‰åˆå§‹çš„ `auto_approve: true` é˜¶æ®µä¼šè‡ªåŠ¨å®Œæˆ
2. å½“æŸä¸ªé˜¶æ®µè¢«æ‰‹åŠ¨æ‰¹å‡†åï¼Œç´§æ¥å…¶åçš„æ‰€æœ‰è¿ç»­ `auto_approve: true` é˜¶æ®µä¹Ÿä¼šè‡ªåŠ¨å®Œæˆ
3. è‡ªåŠ¨æ‰¹å‡†çš„é˜¶æ®µåœ¨ç®¡é“è¡¨ä¸­æ˜¾ç¤º ğŸ¤– æŒ‡ç¤ºæ ‡å¿—
4. æ‰¹å‡†è€…åœ¨é˜¶æ®µå†å²ä¸­è®°å½•ä¸º `[auto]`

**ä½¿ç”¨åœºæ™¯ï¼š**

- **å¼€å‘ç¯å¢ƒ**ï¼šç«‹å³éƒ¨ç½²ï¼Œæ— éœ€ç­‰å¾…æ‰¹å‡†
- **é›†æˆæµ‹è¯•**ï¼šè®© CI/CD ç®¡é“è‡ªåŠ¨æ¨è¿›é€šè¿‡æµ‹è¯•ç¯å¢ƒ
- **é‡‘ä¸é›€éƒ¨ç½²**ï¼šè‡ªåŠ¨æ‰¹å‡†é‡‘ä¸é›€é˜¶æ®µï¼Œå®Œæ•´å‘å¸ƒéœ€æ‰¹å‡†

#### ç®¡é“é…ç½®é€‰é¡¹

| é€‰é¡¹ | é»˜è®¤å€¼ | æè¿° |
|--------|---------|-------------|
| `track_prs` | `false` | åœ¨é—®é¢˜æ­£æ–‡ä¸­åŒ…å«å·²åˆå¹¶çš„ PR |
| `track_commits` | `false` | åŒ…å«è‡ªä¸Šä¸€ä¸ªæ ‡ç­¾ä»¥æ¥çš„æäº¤ |
| `compare_from_tag` | - | è‡ªå®šä¹‰æ¯”è¾ƒçš„æ ‡ç­¾æ¨¡å¼ |
| `show_mermaid_diagram` | `true` | æ˜¾ç¤ºç®¡é“é˜¶æ®µçš„ Mermaid å¯è§†åŒ–æµç¨‹å›¾ |

**æ³¨æ„ï¼š** PR è·Ÿè¸ªéœ€è¦å·¥ä½œæµä¸­æ‹¥æœ‰ `pull-requests: read` æƒé™ã€‚

### å‘å¸ƒå€™é€‰ç­–ç•¥

åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œåˆå¹¶åˆ°ä¸»åˆ†æ”¯çš„ PR å¹¶ä¸æ€»æ˜¯ç«‹å³æˆä¸ºå‘å¸ƒå€™é€‰ã€‚å®¡æ‰¹å¼•æ“æ”¯æŒä¸‰ç§ç­–ç•¥æ¥é€‰æ‹©å“ªäº› PR å±äºå‘å¸ƒï¼š

#### ç­–ç•¥ç±»å‹

| ç­–ç•¥ | æè¿° | ä½¿ç”¨åœºæ™¯ |
|----------|-------------|----------|
| `tag` | ä¸¤ä¸ª git æ ‡ç­¾ä¹‹é—´çš„ PRï¼ˆé»˜è®¤ï¼‰ | ç®€å•å‘å¸ƒï¼ŒåŸºäºä¸»å¹²çš„å¼€å‘ |
| `branch` | åˆå¹¶åˆ°å‘å¸ƒåˆ†æ”¯çš„ PR | GitFlowï¼Œå‘å¸ƒåˆ†æ”¯ |
| `label` | å¸¦æœ‰ç‰¹å®šå‘å¸ƒæ ‡ç­¾çš„ PR | çµæ´»é€‰æ‹©ï¼Œæ‰¹é‡å‘å¸ƒ |
| `milestone` | æŒ‡å®šåˆ° GitHub é‡Œç¨‹ç¢‘çš„ PR | ä¸è·¯çº¿å›¾å¯¹é½çš„å‘å¸ƒ |

#### é…ç½®

```yaml
# .github/approvals.yml
workflows:
  deploy:
    description: "Production deployment pipeline"
    pipeline:
      track_prs: true
      track_commits: true

      # Configure release selection strategy
      release_strategy:
        type: milestone  # or: tag, branch, label

        # Milestone strategy settings
        milestone:
          pattern: "v{{version}}"        # e.g., "v1.2.0"
          close_after_release: true       # Close milestone on prod completion

        # Auto-create next release artifact on completion
        auto_create:
          enabled: true
          next_version: patch             # or: minor, major
          create_issue: true              # Create new approval issue

      stages:
        - name: dev
          policy: developers
        - name: prod
          policy: production-approvers
          is_final: true
```

#### åˆ†æ”¯ç­–ç•¥

ä½¿ç”¨å‘å¸ƒåˆ†æ”¯è¿›è¡Œ GitFlow é£æ ¼çš„å¼€å‘ï¼š

```yaml
release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"  # Creates release/v1.2.0
    base_branch: main               # Compare against main
    delete_after_release: true      # Cleanup after prod deploy

  auto_create:
    enabled: true
    next_version: minor
```

**å·¥ä½œåŸç†ï¼š**
1. åˆ›å»ºå‘å¸ƒåˆ†æ”¯ï¼š`release/v1.2.0`
2. åˆå¹¶åˆ°è¯¥åˆ†æ”¯çš„ PR æ˜¯å‘å¸ƒå€™é€‰ç‰ˆæœ¬
3. è¯·æ±‚è¯¥ç‰ˆæœ¬çš„å®¡æ‰¹
4. å®¡æ‰¹é—®é¢˜æ˜¾ç¤ºå‘å¸ƒåˆ†æ”¯ä¸­çš„æ‰€æœ‰ PR
5. ç”Ÿäº§ç¯å¢ƒå‘å¸ƒåï¼Œåˆ†æ”¯è¢«åˆ é™¤ï¼ˆå¯é€‰ï¼‰å¹¶åˆ›å»ºä¸‹ä¸€ä¸ªåˆ†æ”¯

#### æ ‡ç­¾ç­–ç•¥

ä½¿ç”¨æ ‡ç­¾è¿›è¡Œçµæ´»çš„ PR é€‰æ‹©ï¼š

```yaml
release_strategy:
  type: label
  label:
    pattern: "release:{{version}}"      # e.g., "release:v1.2.0"
    pending_label: "pending-release"    # Applied to merged PRs awaiting release
    remove_after_release: true          # Remove label after prod deploy

  auto_create:
    enabled: true
    next_version: patch
```

**å·¥ä½œåŸç†ï¼š**
1. åˆå¹¶åˆ°ä¸»åˆ†æ”¯çš„PRä¼šè¢«æ‰“ä¸Š`pending-release`æ ‡ç­¾
2. å‘å¸ƒç»ç†å¯¹é€‰å®šçš„PRåº”ç”¨`release:v1.2.0`æ ‡ç­¾
3. è¯·æ±‚v1.2.0çš„å®¡æ‰¹
4. å®¡æ‰¹é—®é¢˜ä»…æ˜¾ç¤ºå¸¦æœ‰è¯¥æ ‡ç­¾çš„PR
5. ç”Ÿäº§å‘å¸ƒåï¼Œæ ‡ç­¾è¢«ç§»é™¤å¹¶åˆ›å»ºä¸‹ä¸€ä¸ªå‘å¸ƒæ ‡ç­¾

#### é‡Œç¨‹ç¢‘ç­–ç•¥

ä½¿ç”¨é‡Œç¨‹ç¢‘è¿›è¡Œä¸è·¯çº¿å›¾å¯¹é½çš„å‘å¸ƒï¼š

```yaml
release_strategy:
  type: milestone
  milestone:
    pattern: "Release {{version}}"       # e.g., "Release 1.2.0"
    close_after_release: true            # Close milestone on completion

  auto_create:
    enabled: true
    next_version: minor
    create_issue: true                   # Auto-create next approval issue
```

**å·¥ä½œåŸç†ï¼š**
1. åˆ›å»ºé‡Œç¨‹ç¢‘ï¼šâ€œç‰ˆæœ¬ 1.2.0â€
2. åœ¨å¼€å‘è¿‡ç¨‹ä¸­å°† PR åˆ†é…åˆ°è¯¥é‡Œç¨‹ç¢‘
3. è¯·æ±‚ v1.2.0 çš„æ‰¹å‡†
4. æ‰¹å‡†é—®é¢˜æ˜¾ç¤ºé‡Œç¨‹ç¢‘ä¸­çš„æ‰€æœ‰ PR
5. ç”Ÿäº§å®Œæˆåå…³é—­é‡Œç¨‹ç¢‘å¹¶åˆ›å»ºä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘

#### å®Œæˆæ—¶è‡ªåŠ¨åˆ›å»º

å½“æœ€ç»ˆé˜¶æ®µï¼ˆç”Ÿäº§ï¼‰è·å¾—æ‰¹å‡†æ—¶ï¼Œè‡ªåŠ¨ä¸ºä¸‹ä¸€ä¸ªç‰ˆæœ¬åšå‡†å¤‡ï¼š

```yaml
auto_create:
  enabled: true
  next_version: patch      # Calculate next: patch, minor, or major
  create_issue: true       # Create new approval issue immediately
  comment: |               # Custom message (optional)
    ğŸš€ **Next release prepared:** {{version}}
```

è¿™å°†åˆ›å»ºï¼š
- **åˆ†æ”¯ç­–ç•¥ï¼š** ä»ä¸»åˆ†æ”¯åˆ›å»ºæ–°çš„å‘å¸ƒåˆ†æ”¯
- **æ ‡ç­¾ç­–ç•¥ï¼š** æ–°çš„å‘å¸ƒæ ‡ç­¾
- **é‡Œç¨‹ç¢‘ç­–ç•¥ï¼š** æ–°çš„é‡Œç¨‹ç¢‘

#### æ¸…ç†é€‰é¡¹

æ¯ç§ç­–ç•¥éƒ½æœ‰åœ¨æœ€ç»ˆé˜¶æ®µï¼ˆç”Ÿäº§ï¼‰æ‰¹å‡†æ—¶è¿è¡Œçš„å¯é€‰æ¸…ç†æ“ä½œã€‚**æ‰€æœ‰æ¸…ç†é€‰é¡¹é»˜è®¤ä¸º `false`** - æ¸…ç†ä¸ºè‡ªæ„¿å¯ç”¨ï¼š

| ç­–ç•¥ | æ¸…ç†é€‰é¡¹ | æè¿° |
|----------|----------------|-------------|
| åˆ†æ”¯ | `delete_after_release` | åˆ é™¤å‘å¸ƒåˆ†æ”¯ |
| æ ‡ç­¾ | `remove_after_release` | ä» PR ä¸­ç§»é™¤å‘å¸ƒæ ‡ç­¾ |
| é‡Œç¨‹ç¢‘ | `close_after_release` | å…³é—­é‡Œç¨‹ç¢‘ |

```yaml
release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"
    delete_after_release: false   # Keep branch for reference (default)

  type: milestone
  milestone:
    pattern: "v{{version}}"
    close_after_release: true     # Close milestone when done
```

#### çƒ­ä¿®å¤éƒ¨ç½²

å¯¹äºéœ€è¦ç»•è¿‡æ­£å¸¸å‘å¸ƒæµç¨‹çš„ç´§æ€¥çƒ­ä¿®å¤ï¼Œåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å·¥ä½œæµç¨‹ï¼š

```yaml
# .github/approvals.yml
workflows:
  # Standard releases - full pipeline with milestone tracking
  deploy:
    description: "Standard release pipeline (dev â†’ qa â†’ stage â†’ prod)"
    pipeline:
      release_strategy:
        type: milestone
        milestone:
          pattern: "v{{version}}"
          close_after_release: true
        auto_create:
          enabled: true
          next_version: minor
      stages:
        - name: dev
          policy: developers
        - name: qa
          policy: qa-team
        - name: stage
          policy: tech-leads
        - name: prod
          policy: production-approvers
          is_final: true

  # Hotfixes - skip stages, direct to prod
  hotfix:
    description: "Emergency hotfix - direct to production"
    pipeline:
      release_strategy:
        type: tag              # Simple tag-based, no cleanup needed
        # No auto_create - hotfixes are one-off
      stages:
        - name: prod
          policy: production-approvers
          create_tag: true
          is_final: true
    on_approved:
      close_issue: true
      comment: "ğŸš¨ Hotfix {{version}} deployed to production"
```

**è§¦å‘çƒ­ä¿®å¤ä¸å¸¸è§„å‘å¸ƒï¼š**

```bash
# Regular release - goes through all stages
gh workflow run request-approval.yml -f workflow_name=deploy -f version=v1.3.0

# Hotfix - goes straight to prod
gh workflow run request-approval.yml -f workflow_name=hotfix -f version=v1.2.1
```

**çƒ­ä¿®å¤æ¨¡å¼ï¼š**

| åœºæ™¯ | ç­–ç•¥ | æ¸…ç† | è‡ªåŠ¨åˆ›å»º |
|----------|----------|---------|-------------|
| ç´§æ€¥ä¿®å¤ | `tag` | æ—  | ç¦ç”¨ |
| è¡¥ä¸å‘å¸ƒ | `milestone` | `close_after_release: false` | ç¦ç”¨ |
| å¤šä¸ªçƒ­ä¿®å¤ | `branch` | `delete_after_release: false` | ç¦ç”¨ |

#### å‘å¸ƒç­–ç•¥ä¼˜åŠ¿

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|----------|------|------|
| **æ ‡ç­¾** | ç®€å•ï¼Œæ— éœ€é¢å¤–å·¥ä½œæµç¨‹ | åŒ…å«æ‰€æœ‰åˆå¹¶çš„PR |
| **åˆ†æ”¯** | å‘å¸ƒèŒƒå›´æ¸…æ™°ï¼Œéš”ç¦»æ€§å¥½ | åˆ†æ”¯ç®¡ç†å¼€é”€å¤§ |
| **æ ‡ç­¾ï¼ˆLabelï¼‰** | çµæ´»é€‰æ‹©ï¼Œæ˜“äºæ›´æ”¹ | éœ€è¦æ‰‹åŠ¨æ ‡è®° |
| **é‡Œç¨‹ç¢‘** | è·¯çº¿å›¾å¯è§ï¼Œè§„åˆ’é›†æˆ | éœ€è¦ä¸¥æ ¼ç®¡ç†é‡Œç¨‹ç¢‘ |

**å»ºè®®ï¼š**

- å¯¹äºæŒç»­éƒ¨ç½²çš„ç®€å•é¡¹ç›®ï¼Œä½¿ç”¨ **æ ‡ç­¾**  
- å¯¹äºéœ€è¦å‘å¸ƒéš”ç¦»çš„å—æ§ç¯å¢ƒï¼Œä½¿ç”¨ **åˆ†æ”¯**  
- å¯¹äºèŒƒå›´çµæ´»çš„æ‰¹é‡å‘å¸ƒï¼Œä½¿ç”¨ **æ ‡ç­¾ï¼ˆLabelï¼‰**  
- å¯¹äºæœ‰æ˜ç¡®å‘å¸ƒè§„åˆ’çš„è·¯çº¿å›¾é©±åŠ¨å¼€å‘ï¼Œä½¿ç”¨ **é‡Œç¨‹ç¢‘**  

### Jira é›†æˆ

è‡ªåŠ¨ä»æäº¤å’Œåˆ†æ”¯åç§°ä¸­æå– Jira ä»»åŠ¡ã€‚è¯¥æ“ä½œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

#### ä»…é“¾æ¥æ¨¡å¼ï¼ˆæ— éœ€è®¤è¯ï¼‰

åªéœ€æä¾› `jira_base_url`ï¼Œå³å¯æå–ä»»åŠ¡å…³é”®å­—å¹¶æ˜¾ç¤ºä¸ºå¯ç‚¹å‡»é“¾æ¥ï¼š

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    jira_base_url: https://yourcompany.atlassian.net  # That's it!
```

è¿™ä¼šä»æäº¤ä¿¡æ¯å’Œåˆ†æ”¯åç§°ä¸­æå–é—®é¢˜å…³é”®å­—ï¼ˆä¾‹å¦‚ï¼Œ`PROJ-123`ï¼‰ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºé“¾æ¥æ˜¾ç¤ºåœ¨å®¡æ‰¹é—®é¢˜ä¸­ï¼š

```markdown
### Jira Issues
- [PROJ-123](https://yourcompany.atlassian.net/browse/PROJ-123)
- [PROJ-456](https://yourcompany.atlassian.net/browse/PROJ-456)
```

#### å…¨æ¨¡å¼ï¼ˆå«APIè®¿é—®ï¼‰

æ·»åŠ å‡­æ®ä»¥è·å–é—®é¢˜è¯¦æƒ…å¹¶æ›´æ–°ä¿®å¤ç‰ˆæœ¬ï¼š

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Jira configuration
    jira_base_url: https://yourcompany.atlassian.net
    jira_user_email: ${{ secrets.JIRA_EMAIL }}
    jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
    jira_update_fix_version: 'true'
```
è¿™æ˜¾ç¤ºäº†ä¸°å¯Œçš„é—®é¢˜ä¿¡æ¯ï¼š


```markdown
### Jira Issues in this Release

| Key | Summary | Type | Status |
|-----|---------|------|--------|
| [PROJ-123](https://...) | Fix login bug | Bug | Done |
| [PROJ-456](https://...) | Add dark mode | Feature | In Progress |
```

**æ¨¡å¼æ¯”è¾ƒï¼š**

| æ¨¡å¼ | éœ€è¦è®¤è¯ | åŠŸèƒ½ |
|------|----------|------|
| ä»…é“¾æ¥ | å¦ | å°†å¯†é’¥ä½œä¸ºå¯ç‚¹å‡»é“¾æ¥å‘å¸ƒ |
| å®Œæ•´ | æ˜¯ | é“¾æ¥ + æ‘˜è¦ã€çŠ¶æ€ã€ç±»å‹è¡¨æƒ…ã€ä¿®å¤ç‰ˆæœ¬æ›´æ–° |

**Jira è¾“å‡ºï¼š**

```yaml
- name: Use Jira Outputs
  run: |
    echo "Issues: ${{ steps.approval.outputs.jira_issues }}"
    # Output: PROJ-123,PROJ-456

    echo "Details: ${{ steps.approval.outputs.jira_issues_json }}"
    # Output: [{"key":"PROJ-123","summary":"Fix login bug",...}]
```

### éƒ¨ç½²è·Ÿè¸ª

åœ¨ GitHub éƒ¨ç½²ä»ªè¡¨æ¿ä¸­åˆ›å»º GitHub éƒ¨ç½²ä»¥å®ç°å¯è§æ€§ã€‚æ­¤åŠŸèƒ½ç‹¬ç«‹äºå·¥ä½œæµ YAML ä¸­çš„ `environment:` é”®ã€‚

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  id: approval
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Deployment tracking
    create_deployment: 'true'
    deployment_environment: production
    deployment_environment_url: https://myapp.example.com

- name: Update Deployment Status
  if: steps.approval.outputs.status == 'approved'
  run: |
    # Use the deployment_id to update status after actual deployment
    echo "Deployment ID: ${{ steps.approval.outputs.deployment_id }}"
```

**éƒ¨ç½²å‡ºç°çš„ä½ç½®ï¼š**

- ä»“åº“çš„ **Deployments** é€‰é¡¹å¡
- ä»“åº“é¡µé¢ä¸Šçš„ç¯å¢ƒçŠ¶æ€å¾½ç« 
- é…ç½®åå¯ç”¨çš„ GitHub for Jira é›†æˆ
- ç”¨äº CI/CD å·¥å…·çš„ GitHub API

**æ³¨æ„ï¼š** è¿™é€šè¿‡ GitHub Deployments API åˆ›å»ºéƒ¨ç½²ï¼Œè¯¥ API ä¸ GitHub åŸç”Ÿçš„ç¯å¢ƒä¿æŠ¤è§„åˆ™æ˜¯åˆ†å¼€çš„ã€‚æ‚¨å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚

### å¤–éƒ¨é…ç½®ä»“åº“

å°†å®¡æ‰¹é…ç½®å­˜å‚¨åœ¨å…±äº«ä»“åº“ä¸­ä»¥å®ç°é›†ä¸­ç­–ç•¥ç®¡ç†ï¼š

```yaml
- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    token: ${{ secrets.GITHUB_TOKEN }}
    config_repo: myorg/.github  # Shared config repo
```

**é…ç½®è§£æé¡ºåºï¼š**

1. å¤–éƒ¨ä»“åº“ä¸­çš„ `{repo-name}_approvals.yml`ï¼ˆä¾‹å¦‚ï¼Œ`myapp_approvals.yml`ï¼‰
2. å¤–éƒ¨ä»“åº“ä¸­çš„ `approvals.yml`ï¼ˆå…±äº«é»˜è®¤ï¼‰
3. å½“å‰ä»“åº“ä¸­çš„ `.github/approvals.yml`ï¼ˆæœ¬åœ°åå¤‡ï¼‰

**ç¤ºä¾‹ç»„ç»‡ç»“æ„ï¼š**

```text
myorg/.github/
â”œâ”€â”€ myapp_approvals.yml      # App-specific config
â”œâ”€â”€ backend_approvals.yml    # Backend repos config
â””â”€â”€ approvals.yml            # Default for all repos
```

### é˜»å¡å®¡æ‰¹

å¯¹äºéœ€è¦ç­‰å¾…å®¡æ‰¹åæ‰èƒ½ç»§ç»­çš„å·¥ä½œæµç¨‹ï¼š

```yaml
name: Deploy with Blocking Approval

on:
  workflow_dispatch:
    inputs:
      version:
        required: true
        type: string

jobs:
  request-approval:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.request.outputs.issue_number }}
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}

  wait-for-approval:
    needs: request-approval
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: check
        with:
          action: check
          issue_number: ${{ needs.request-approval.outputs.issue_number }}
          wait: 'true'           # Poll until approved/denied
          timeout: '4h'          # Max wait time
          token: ${{ secrets.GITHUB_TOKEN }}

  deploy:
    needs: [request-approval, wait-for-approval]
    if: needs.wait-for-approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy
        run: |
          echo "Deploying ${{ needs.wait-for-approval.outputs.tag }}"
```

**æ³¨æ„ï¼š** é˜»å¡å·¥ä½œæµä¼šä¿æŒè¿è¡Œå™¨å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä»è€Œæ¶ˆè€— GitHub Actions åˆ†é’Ÿã€‚å¯¹äºæˆæœ¬æ•æ„Ÿçš„åœºæ™¯ï¼Œè¯·ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹æ³•ï¼ˆåˆ†ç¦»çš„ `process-comment` å·¥ä½œæµï¼‰ã€‚

### å…³é—­é—®é¢˜æ—¶åˆ é™¤æ ‡ç­¾

å¯é€‰åœ°åœ¨å®¡æ‰¹é—®é¢˜è¢«æ‰‹åŠ¨å…³é—­æ—¶åˆ é™¤æ ‡ç­¾ï¼š

```yaml
workflows:
  dev-deploy:
    on_closed:
      delete_tag: true   # Delete tag when issue is closed
      comment: "Cancelled. Tag {{tag}} deleted."

  production-deploy:
    on_closed:
      delete_tag: false  # NEVER delete production tags
```

**å¤„ç†å…³é—­äº‹ä»¶ï¼š**

```yaml
# .github/workflows/handle-close.yml
name: Handle Issue Close

on:
  issues:
    types: [closed]

jobs:
  handle:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: jamengual/enterprise-approval-engine@v1
        id: close
        with:
          action: close-issue
          issue_number: ${{ github.event.issue.number }}
          issue_action: ${{ github.event.action }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Report
        run: |
          echo "Status: ${{ steps.close.outputs.status }}"
          echo "Deleted tag: ${{ steps.close.outputs.tag_deleted }}"
```

---

## Complete Examples

### Full-Featured Request Workflow

```yaml
name: Request Production Deployment

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options: [staging, production]

permissions:
  contents: write
  issues: write
  deployments: write

jobs:
  request:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.approval.outputs.issue_number }}
      issue_url: ${{ steps.approval.outputs.issue_url }}
      deployment_id: ${{ steps.approval.outputs.deployment_id }}
      jira_issues: ${{ steps.approval.outputs.jira_issues }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Needed for commit comparison

      - uses: jamengual/enterprise-approval-engine@v1
        id: approval
        with:
          action: request
          workflow: ${{ inputs.environment }}-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          # Jira integration
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
          # Deployment tracking
          create_deployment: 'true'
          deployment_environment: ${{ inputs.environment }}
          deployment_environment_url: https://${{ inputs.environment }}.myapp.com

      - name: Summary
        run: |
          echo "## Approval Request Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Issue:** #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Jira Issues:** ${{ steps.approval.outputs.jira_issues }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commits:** ${{ steps.approval.outputs.commits_count }}" >> $GITHUB_STEP_SUMMARY
```

### ä¸å›¢é˜Ÿæ”¯æŒå…±åŒå¤„ç†è¯„è®º

```yaml
name: Handle Approval Comments

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write

jobs:
  process:
    if: |
      github.event.issue.pull_request == null &&
      contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Generate GitHub App token for team membership checks
      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}

      - uses: jamengual/enterprise-approval-engine@v1
        id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
          # Jira integration to update Fix Version on approval
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}

      - name: Trigger Deployment
        if: steps.process.outputs.status == 'approved'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deploy.yml',
              ref: 'main',
              inputs: { version: '${{ steps.process.outputs.tag }}' }
            });
```

### å¤šç¯å¢ƒæ¨å¹¿

```yaml
# .github/approvals.yml
version: 1

policies:
  dev-team:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1

  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1

  prod-team:
    approvers: [team:sre, tech-lead]
    min_approvals: 2

workflows:
  dev-deploy:
    require:
      - policy: dev-team
    on_approved:
      tagging:
        enabled: true
        auto_increment: patch
        env_prefix: "dev-"
      close_issue: true

  staging-deploy:
    require:
      - policy: qa-team
    on_approved:
      tagging:
        enabled: true
        auto_increment: minor
        env_prefix: "staging-"
      close_issue: true

  production-deploy:
    require:
      - policy: prod-team
    on_approved:
      create_tag: true
      close_issue: true
    on_closed:
      delete_tag: false  # Never delete production tags
```

### åœ¨åç»­ä½œä¸šä¸­ä½¿ç”¨è¾“å‡º

```yaml
name: Deploy with Approval

on:
  workflow_dispatch:
    inputs:
      version:
        required: true

jobs:
  approval:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
      approvers: ${{ steps.check.outputs.approvers }}
      jira_issues: ${{ steps.request.outputs.jira_issues }}
    steps:
      - uses: actions/checkout@v4

      - uses: jamengual/enterprise-approval-engine@v1
        id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          jira_base_url: https://mycompany.atlassian.net

      - uses: jamengual/enterprise-approval-engine@v1
        id: check
        with:
          action: check
          issue_number: ${{ steps.request.outputs.issue_number }}
          wait: 'true'
          timeout: '2h'
          token: ${{ secrets.GITHUB_TOKEN }}

  deploy:
    needs: approval
    if: needs.approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Deploy
        run: |
          echo "Deploying ${{ needs.approval.outputs.tag }}"
          echo "Approved by: ${{ needs.approval.outputs.approvers }}"
          echo "Jira Issues: ${{ needs.approval.outputs.jira_issues }}"

  notify:
    needs: [approval, deploy]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Notify Slack
        run: |
          if [ "${{ needs.approval.outputs.status }}" == "approved" ]; then
            echo "Deployment of ${{ needs.approval.outputs.tag }} completed!"
          else
            echo "Deployment was ${{ needs.approval.outputs.status }}"
          fi
```

---

## Schema Validation

Validate your configuration using the JSON schema:

```yaml
# .github/approvals.yml
# yaml-language-server: $schema=https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/schema.json

version: 1

policies:
  # ... your config
```

æˆ–è€…åœ¨æŒç»­é›†æˆä¸­éªŒè¯ï¼š

```yaml
- name: Validate Config
  run: |
    npm install -g ajv-cli
    ajv validate -s schema.json -d .github/approvals.yml
```

---

## GitHub ä¼ä¸šæœåŠ¡å™¨

è¯¥æ“ä½œå®Œå…¨æ”¯æŒ GitHub ä¼ä¸šæœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ `GITHUB_SERVER_URL` å’Œ `GITHUB_API_URL` ç¯å¢ƒå˜é‡è‡ªåŠ¨æ£€æµ‹ GHES ç¯å¢ƒã€‚

æ— éœ€é¢å¤–é…ç½® - æ“ä½œå°†è‡ªåŠ¨ä½¿ç”¨æ­£ç¡®çš„ API ç«¯ç‚¹ã€‚

**é€Ÿç‡é™åˆ¶ï¼š**

è¯¥æ“ä½œåŒ…æ‹¬é’ˆå¯¹é€Ÿç‡é™åˆ¶é”™è¯¯çš„è‡ªåŠ¨é‡è¯•å’ŒæŒ‡æ•°é€€é¿ã€‚é…ç½®å¦‚ä¸‹ï¼š

- åˆå§‹å»¶è¿Ÿï¼š1ç§’
- æœ€å¤§å»¶è¿Ÿï¼š60ç§’
- æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š5æ¬¡
- æŠ–åŠ¨ï¼šéšæœºæ·»åŠ  0-500 æ¯«ç§’ä»¥é˜²æ­¢ç¾Šç¾¤æ•ˆåº”

---

## è®¸å¯

MIT è®¸å¯


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-12-22

---