# کامپوننت وب تصویر سیال

تصاویری که به طور هوشمندانه به هر اندازه دلخواه (در محدوده‌های معقول) مقیاس‌بندی می‌شوند.

![تصاویر سیال](https://raw.githubusercontent.com/VoiceNGO/fluid-img/refs/heads/main/resources/images/responsive-images.jpg)

**خیلی کوچک!:** ۷ کیلوبایت پس از فشرده‌سازی و gzipped

## نحوه استفاده

```html
<script src="fluid-img.js"></script>
<fluid-img src="image.jpg"></fluid-img>
```

همین. تصاویر را هر طور که خواستید مقیاس دهید و آن‌ها خودشان با شرایط وفق پیدا می‌کنند.

## دموی نمونه

[دمو اینجاست](https://voicengo.github.io/fluid-img/public/fluid-demo.html)

یک محیط آزمایشی نیز برای [آزمایش با تصاویر خودتان](https://voicengo.github.io/fluid-img/public) در دسترس است.
## نصب

### کتابخانه کلاینت

```sh
npm install fluid-img
```

سپس `fluid-img` را در پروژه خود وارد کنید، که وب‌کامپوننت را فراهم کرده و ثبت می‌کند:

```ts
import 'fluid-img';
```

یا اسکریپت را از jsdelivr یا unpkg وارد کنید:

```html
<script src="https://cdn.jsdelivr.net/npm/fluid-img@latest/dist/fluid-img.js" />

<!-- یا -->

<script src="https://unpkg.com/fluid-img@latest/dist/fluid-img.js" />
```
### هشدارها

کامپوننت تصویر سیال (fluid image) بهترین عملکرد را برای تغییر مقیاس افقی یا عمودی تصاویر در بازه‌ای تقریباً از ۰.۵x تا ۱.۵x اندازه اصلی آنها دارد. اگرچه می‌تواند مقیاس‌های بزرگ‌تر یا کوچک‌تر را نیز مدیریت کند، اما کیفیت بصری ممکن است به سرعت کاهش یابد. استفاده از این روش برای تصاویری که حفظ دقیق پیکسل اهمیت حیاتی دارد، مانند پرتره‌ها، نمودارها یا نقشه‌های فنی دقیق توصیه نمی‌شود، زیرا Seam Carving منجر به ایجاد اعوجاج می‌شود. اکیداً توصیه می‌شود تصاویر خود را در اندازه‌های مختلف تست کنید تا اطمینان حاصل شود که با انتظارات بصری شما مطابقت دارند.

#### CORS

به دلیل محدودیت‌های امنیتی مرورگر، بارگذاری تصاویر از مبدأ متفاوت (دامنه، پروتکل یا پورت متفاوت) نسبت به صفحه وب، منجر به خطای Cross-Origin Resource Sharing (CORS) خواهد شد. این کامپوننت نیاز دارد که به داده خام پیکسلی تصویر دسترسی داشته باشد که این دسترسی توسط CORS محدود شده است.

برای استفاده از تصاویر از مبدأی متفاوت، سروری که تصاویر را میزبانی می‌کند باید طوری پیکربندی شود که هدرهای مناسب CORS را ارسال کند (مثلاً `Access-Control-Allow-Origin: *` یا `Access-Control-Allow-Origin: your-domain.com`). بدون این هدرها، کامپوننت قادر به پردازش تصویر نخواهد بود.

(جهت اطلاع، برای مقاصد تست، هر تصویری روی سایت imgur دارای هدرهای CORS مورد نیاز می‌باشد)

#### حالت جایگزین (Fallback)

اگر کامپوننت نتواند تصویر را بارگذاری یا پردازش کند، یا خطای داخلی رخ دهد، به صورت خودکار به درج یک تگ استاندارد `<img>` در داخل کامپوننت `<fluid-img>` با عرض و ارتفاع ۱۰۰٪ بازمی‌گردد تا اطمینان حاصل شود که تصویر همچنان نمایش داده می‌شود.

## گزینه‌ها

نحوه استفاده:  
`<fluid-img src="image.jpg" generator="random" max-carve-up-scale="5"></fluid-img>`

به طور پیش‌فرض، مولد `random` استفاده می‌شود زیرا سریع‌ترین است.

| گزینه                          | مقادیر                          | پیش‌فرض      | توضیحات                                                                                                              |
| ------------------------------ | ------------------------------- | ------------ | -------------------------------------------------------------------------------------------------------------------- |
| `src`                          | URL                             |              | آدرس تصویر مورد پردازش.                                                                                             |
| `generator`                    | `random`، `predictive`          | `predictive` | نوع مولد seam carving. `random` سریع‌تر اما با کیفیت پایین‌تر است.                                                 |
| `scaling-axis`                 | `horizontal`، `vertical`، `auto`| `horizontal` | محور تغییر مقیاس. `auto` بر اساس تغییر نسبت ابعاد، به صورت افقی یا عمودی مقیاس می‌شود.                             |
| `mask`                         | URL                             |              | آدرس تصویر ماسک. نواحی سیاه ماسک انرژی کمتری دارند و احتمال حفظ شدن آن‌ها بیشتر است.                               |
| `carving-priority`             | عدد (۰ تا ۱، مثلاً `0.5`)       | `1`          | درصد تغییر مقیاس که توسط seam carving نسبت به مقیاس‌بندی سنتی انجام می‌شود.                                         |
| `max-carve-up-seam-percentage` | عدد (۰ تا ۱، مثلاً `0.5`)       | `0.6`        | حداکثر درصد seamهایی که هنگام بزرگ‌نمایی اضافه می‌شوند. ایجاد seam جدید را برای حفظ کیفیت تصویر محدود می‌کند.      |
| `max-carve-up-scale`           | عدد (مثلاً `3`)                 | `3`          | حداکثر ضریب بزرگ‌نمایی با استفاده از seam carving. بیشتر از این مقدار، مقیاس‌بندی سنتی استفاده می‌شود.             |
| `max-carve-down-scale`         | عدد (۰ تا ۱، مثلاً `0.7`)       | `0.7`        | حداکثر درصد تصویر که هنگام کوچک‌نمایی توسط seam carving حذف می‌شود.                                                 |
### گزینه‌های مخصوص ژنراتور

گزینه‌های مخصوص ژنراتور به کامپوننت `<fluid-img>` اضافه می‌شوند اما فقط زمانی معتبر هستند که ویژگی
`generator`
مرتبط نیز تنظیم شده باشد.

#### گزینه‌های ژنراتور تصادفی و پیش‌بینی‌کننده

| گزینه                | مقادیر                 | پیش‌فرض | توضیحات                                              |
| ---------------------| ---------------------- | ------- | ---------------------------------------------------- |
| `batch-percentage`   | عدد (۰ تا ۱، مثلاً ۰.۱) | ۰.۱     | درصد درزهایی که در هر دسته ایجاد می‌شوند            |
| `min-batch-size`     | عدد (مثلاً `10`)       | ۱۰      | حداقل تعداد درزهایی که در هر دسته ایجاد می‌شوند     |

## نحوه عملکرد

Seam carving یک تکنیک تغییر اندازه تصویر آگاه به محتوا است که به طور هوشمندانه پیکسل‌ها را حذف یا اضافه می‌کند و به این ترتیب امکان تغییر اندازه تصویر بدون تغییر شکل محتوای مهم را فراهم می‌کند. برای اطلاعات بیشتر، به [مقاله ویکی‌پدیا](https://en.wikipedia.org/wiki/Seam_carving) در این موضوع مراجعه کنید.

تاریخچه نشان می‌دهد که seam carving از لحاظ محاسباتی برای استفاده بلادرنگ در مرورگرهای وب بسیار سنگین بود. با این حال، این محدودیت را می‌توان با استفاده از الگوریتم‌های جایگزین که نیاز محاسباتی کمتری دارند و در بسیاری از سناریوها به خوبی کار می‌کنند، برطرف کرد.

دو پیاده‌سازی از ژنراتور seam carving وجود دارد:
### برش تصادفی

روش برش درز تصادفی، الگوریتم سنتی برش درز را کنار می‌گذارد، زیرا برای اجرا در زمان واقعی در مرورگر بیش از حد کند است.

در عوض، مجموعه‌ای از درزهای تصادفی ایجاد می‌کند که ۱۰۰٪ پوشش تصویر را با اتصال هر پیکسل در یک ردیف به یک پیکسل مجاور در ردیف بعدی فراهم می‌کنند. سپس، هر درز را طی می‌کند، انرژی آن را محاسبه کرده و یک دسته از درزهای با کمترین انرژی را حذف می‌کند. این فرایند تا رسیدن به تعداد مورد نیاز درزها تکرار می‌شود. این روش برای بسیاری از تصاویر نتایج شگفت‌انگیزی ارائه می‌دهد.

### برش پیش‌بینانه

مشابه برش تصادفی، این روش یک نقشه انرژی تولید کرده و درزها را به صورت دسته‌ای ایجاد می‌کند. همچنین برای هر دسته، یک نقشه انرژی حداقل تولید می‌کند. ایده اصلی این است که هم درزهای "خوب" و هم "بد" ایجاد شوند. درزهای خوب انرژی پایینی دارند و نگه داشته می‌شوند. درزهای بد شامل پیکسل‌های با انرژی بالا هستند تا بتوان آن‌ها را بعداً فیلتر کرد.

شروع از ردیف اول، جفت‌های پیکسل را به جفت‌های متناظر در ردیف بعدی متصل می‌کند. درز با انرژی کمتر از محاسبه جاری به درز با انرژی کمتر از نقشه انرژی حداقل متصل می‌شود.

نتیجه، یک درز واقعاً بهینه، تعداد زیادی درز "بسیار خوب"، تعداد زیادی درز "بسیار بد" و بسیاری درز متوسط است. ما یک دسته از درزهای "خوب" را انتخاب کرده، بقیه را حذف می‌کنیم و این فرایند را تکرار می‌کنیم.

##

## کارهای باقی‌مانده

### اولویت بالا

- [x] کامپوننت وب
- [x] رندرکننده‌ای که داده‌ها را از ژنراتورها گرفته و به هر اندازه‌ای مقیاس می‌کند
- [x] ژنراتور تصادفی
- [x] برش عمودی
- [x] ژنراتور پیش‌بینانه
- [ ] وب‌ورکر برای همه ژنراتورها
### اولویت پایین

- [x] ماسک‌گذاری
- [ ] تشخیص چهره

### رویای دور

- [ ] حکاکی دوبعدی

## مجوز

این نرم‌افزار تحت مجوز Fluid-Img Revenue-Limited ارائه شده است.

**استفاده رایگان** برای افراد و سازمان‌هایی با درآمد ناخالص سالیانه کمتر از ۱۰٬۰۰۰٬۰۰۰ دلار آمریکا.

**نیاز به مجوز تجاری** برای سازمان‌هایی با درآمد سالیانه بیش از ۱۰ میلیون دلار. برای دریافت شرایط مجوز تجاری با [licensing@voice.ngo] تماس بگیرید.

برای مشاهده شرایط کامل به فایل [LICENSE](./LICENSE) مراجعه کنید.

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-11

---