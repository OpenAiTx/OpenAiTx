# Fluid Image Web Component

任意のサイズ（合理的な範囲内）にインテリジェントにスケーリングできる画像。

![Fluid Images](https://raw.githubusercontent.com/VoiceNGO/fluid-img/refs/heads/main/resources/images/responsive-images.jpg)

**超軽量！:** 圧縮後で7kb（minified & gzipped）

## 使い方

```html
<script src="fluid-img.js"></script>
<fluid-img src="image.jpg"></fluid-img>
```

これだけです。画像を好きなように拡大・縮小できます。画像が自動的に対応します。

## デモ

[デモはこちら](https://voicengo.github.io/fluid-img/public/fluid-demo.html)

[ご自身の画像で試せるプレイグラウンド](https://voicengo.github.io/fluid-img/public)も用意されています。
## インストール

### クライアントライブラリ

```sh
npm install fluid-img
```

その後、プロジェクトに `fluid-img` をインポートします。これにより、Webコンポーネントが提供・登録されます。

```ts
import 'fluid-img';
```

または、jsdelivr または unpkg からスクリプトを読み込むこともできます。

```html
<script src="https://cdn.jsdelivr.net/npm/fluid-img@latest/dist/fluid-img.js" />

<!-- または -->

<script src="https://unpkg.com/fluid-img@latest/dist/fluid-img.js" />
```
### 注意事項

フルイド画像コンポーネントは、元のサイズの約0.5倍から1.5倍の範囲内で画像を水平または垂直に拡大縮小する場合に最適に動作します。これより大きいまたは小さいスケールにも対応できますが、視覚的な品質が急速に低下する可能性があります。シームカービングは歪みを引き起こすため、ポートレート、グラフ、詳細な技術図面など、ピクセルの正確さが重要な画像には推奨されません。画像が視覚的な期待に合致しているかを確認するため、さまざまなサイズでテストすることを強く推奨します。

#### CORS

ブラウザのセキュリティ制限により、ウェブページとは異なるオリジン（ドメイン、プロトコル、またはポート）から読み込まれた画像は、クロスオリジンリソースシェアリング（CORS）エラーを引き起こします。このコンポーネントは画像の生ピクセルデータへのアクセスを必要としますが、CORSによって制限されます。

異なるオリジンから画像を使用する場合、画像をホストしているサーバーが適切なCORSヘッダー（例：`Access-Control-Allow-Origin: *` または `Access-Control-Allow-Origin: your-domain.com`）を送信するように設定されている必要があります。これらのヘッダーがない場合、コンポーネントは画像を処理できません。

（参考までに、テスト目的ではimgur上の画像は必要なCORSヘッダーが付与されています）

#### フォールバック

コンポーネントが画像の読み込みや処理に失敗した場合、または内部エラーが発生した場合でも、`<fluid-img>`コンポーネント内に標準の`<img>`タグを幅100%、高さ100%で挿入することで、画像が確実に表示されるように優雅にデグレードします。

## オプション

使用例: `<fluid-img src="image.jpg" generator="random" max-carve-up-scale="5"></fluid-img>`

デフォルトでは、最速で動作する `random` ジェネレーターが使用されます。

| オプション                        | 値                                  | デフォルト     | 説明                                                                                                        |
| --------------------------------- | ----------------------------------- | ------------- | ----------------------------------------------------------------------------------------------------------- |
| `src`                            | URL                                 |               | 処理する画像のURL。                                                                                         |
| `generator`                      | `random`, `predictive`              | `predictive`  | 使用するシームカービングジェネレーター。`random`は高速だが品質が低い。                                      |
| `scaling-axis`                   | `horizontal`, `vertical`, `auto`    | `horizontal`  | 拡大縮小する軸。`auto`はアスペクト比の変化に基づき水平または垂直にスケーリング。                             |
| `mask`                           | URL                                 |               | マスク画像のURL。マスクの黒い部分はエネルギーが低く、より保持されやすい。                                   |
| `carving-priority`               | 数値 (0-1, 例: `0.5`)               | `1`           | シームカービングと従来の画像スケーリングで行う拡大縮小の割合。                                              |
| `max-carve-up-seam-percentage`   | 数値 (0-1, 例: `0.5`)               | `0.6`         | 拡大時に挿入できるシームの最大割合。新しいシームの作成を制限し、画像品質を保持。                             |
| `max-carve-up-scale`             | 数値 (例: `3`)                      | `3`           | シームカービングによる最大拡大係数。これを超える場合は従来のスケーリングを使用。                              |
| `max-carve-down-scale`           | 数値 (0-1, 例: `0.7`)               | `0.7`         | ダウンスケーリング時にシームカービングで除去できる画像の最大割合。                                           |
### ジェネレーター固有のオプション

ジェネレーター固有のオプションは `<fluid-img>` コンポーネントに追加されますが、対応する
`generator` 属性が設定されている場合のみ有効です。

#### ランダム＆予測ジェネレーターオプション

| オプション            | 値                      | デフォルト | 説明                                                |
| ------------------ | --------------------- | ------- | ------------------------------------------------- |
| `batch-percentage` | 数値 (0-1, 例: 0.1)   | 0.1     | バッチごとに生成するシームの割合                       |
| `min-batch-size`   | 数値 (例: `10`)       | 10      | バッチごとに生成するシームの最小数                      |

## 仕組み

シームカービングは、画像内の重要なコンテンツを歪めることなくリサイズできるように、ピクセルを知的に追加または削除するコンテンツ認識型の画像リサイズ技術です。詳細については、[Wikipediaの記事](https://en.wikipedia.org/wiki/Seam_carving)をご覧ください。

従来、シームカービングはWebブラウザでリアルタイムに使用するには計算コストが高すぎました。しかし、この制限は、より負荷が少なく多くの場面でうまく機能する代替アルゴリズムを使用することで克服できます。

シームカービングジェネレーターには2つの実装があります。
### ランダムカービング

ランダムシームカービング手法は、リアルタイムのブラウザ実行には遅すぎる従来のシームカービングアルゴリズムを放棄します。

代わりに、各行の各ピクセルを次の行の隣接ピクセルに接続することで、画像全体を100%カバーするランダムなシームのセットを生成します。その後、各シームを順に処理し、エネルギーを計算し、エネルギーが最も低いシームをまとめて破棄します。このプロセスを、目的のシーム数に到達するまで繰り返します。この方法は、多くの画像に対して驚くほど良い結果をもたらします。

### 予測的カービング

ランダムカービングと同様に、この手法もエネルギーマップを生成し、シームをバッチで作成します。また、各バッチごとに最小エネルギーマップも生成します。コアとなるアイデアは、「良い」シームと「悪い」シームの両方を作成することです。良いシームはエネルギーが低く、保持されます。悪いシームは高エネルギーのピクセルを組み込むことで、後から除外できるようにします。

最初の行から開始し、ピクセルのペアを次の行の対応するペアに接続します。進行中の計算でエネルギーが低いシームは、最小エネルギーマップの低エネルギーシームに接続されます。

その結果、真に最適なシームが1本、「非常に良い」シームが複数、「非常に悪い」シームが複数、そして多くの平凡なシームが生成されます。「良い」シームのバッチを選択し、それ以外は破棄して、このプロセスを繰り返します。

##

## TODO

### 優先度高

- [x] Webコンポーネント
- [x] ジェネレーターからデータを受け取り、任意のサイズにスケーリングするレンダラー
- [x] ランダムジェネレーター
- [x] 垂直カービング
- [x] 予測ジェネレーター
- [ ] すべてのジェネレーター用Webワーカー
### 低優先度

- [x] マスキング
- [ ] 顔認識

### 実現困難

- [ ] 2D彫刻

## ライセンス

このソフトウェアはFluid-Img収益制限ライセンスの下でライセンスされています。

**無料利用**：年間総収益が1,000万米ドル未満の個人および組織が対象です。

**商用ライセンスが必要**：年間総収益が1,000万米ドル以上の組織が対象です。商用ライセンス条件については[licensing@voice.ngo]までご連絡ください。

完全な条件については[LICENSE](./LICENSE)ファイルをご覧ください。

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-11

---