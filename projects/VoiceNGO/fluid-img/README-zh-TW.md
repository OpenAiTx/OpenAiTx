# 流動影像網頁元件

能夠智慧調整至任何所需尺寸（在合理範圍內）的圖片。

![流動影像](https://raw.githubusercontent.com/VoiceNGO/fluid-img/refs/heads/main/resources/images/responsive-images.jpg)

**超小！**：7kb 已壓縮與 gzip

## 用法

```html
<script src="fluid-img.js"></script>
<fluid-img src="image.jpg"></fluid-img>
```

就這樣。隨意縮放圖片，它們會自動適應。

## 範例

[範例在此](https://voicengo.github.io/fluid-img/public/fluid-demo.html)

也有一個可供[自行測試圖片的遊樂場](https://voicengo.github.io/fluid-img/public)可用。
## 安裝

### 用戶端程式庫

```sh
npm install fluid-img
```

然後在您的專案中導入 `fluid-img`，它會提供並註冊網頁元件：

```ts
import 'fluid-img';
```

或者從 jsdelivr 或 unpkg 引入腳本：

```html
<script src="https://cdn.jsdelivr.net/npm/fluid-img@latest/dist/fluid-img.js" />

<!-- 或 -->

<script src="https://unpkg.com/fluid-img@latest/dist/fluid-img.js" />
```
### 注意事項

流體影像元件最適用於在原始尺寸約 0.5 倍至 1.5 倍範圍內，對圖片進行水平或垂直縮放。雖然它可以處理更大或更小的縮放比例，但視覺品質可能會迅速下降。不建議用於像素精確度要求極高的圖片，例如人像、圖表或細節豐富的技術繪圖，因為接縫雕刻會造成變形。強烈建議您在不同尺寸下測試您的圖片，以確保其符合您的視覺預期。

#### CORS

由於瀏覽器安全性限制，從與網頁不同來源（網域、協定或埠口）載入的圖片會觸發跨來源資源共享（CORS）錯誤。此元件需要存取圖片的原始像素資料，而這會受到 CORS 的限制。

若要使用來自不同來源的圖片，託管圖片的伺服器必須設定適當的 CORS 標頭（例如：`Access-Control-Allow-Origin: *` 或 `Access-Control-Allow-Origin: your-domain.com`）。沒有這些標頭，元件將無法處理圖片。

（僅供參考，imgur 上的任何圖片都具備必要的 CORS 標頭，可用於測試）

#### 備援機制

若元件無法載入或處理圖片，或發生內部錯誤，將會自動降級為在 `<fluid-img>` 元件中插入一個標準的 `<img>` 標籤，並設為 100% 寬度與高度，確保圖片仍能顯示。

## 選項

用法：`<fluid-img src="image.jpg" generator="random" max-carve-up-scale="5"></fluid-img>`

預設情況下，使用 `random` 產生器，因為它最快。

| 選項                           | 可用值                            | 預設值        | 說明                                                                                                              |
| ------------------------------ | ---------------------------------- | ------------- | --------------------------------------------------------------------------------------------------------------- |
| `src`                          | URL                                |               | 要處理的圖片 URL。                                                                                              |
| `generator`                    | `random`、`predictive`             | `predictive`  | 要使用的接縫雕刻產生器。`random` 較快但品質較低。                                                                |
| `scaling-axis`                 | `horizontal`、`vertical`、`auto`   | `horizontal`  | 縮放方向。`auto` 會根據長寬比的變化選擇水平或垂直縮放。                                                          |
| `mask`                         | URL                                |               | 遮罩圖片的 URL。遮罩圖的黑色區域能量較低，更容易被保留。                                                          |
| `carving-priority`             | 數字（0-1，例如 `0.5`）            | `1`           | 用接縫雕刻與傳統圖片縮放進行縮放的比例百分比。                                                                   |
| `max-carve-up-seam-percentage` | 數字（0-1，例如 `0.5`）            | `0.6`         | 放大時最大可插入接縫的百分比。限制新增接縫數量以保護圖片品質。                                                    |
| `max-carve-up-scale`           | 數字（例如 `3`）                   | `3`           | 使用接縫雕刻最大放大倍數。超過此數值後將改用傳統縮放。                                                           |
| `max-carve-down-scale`         | 數字（0-1，例如 `0.7`）            | `0.7`         | 縮小時可用接縫雕刻移除的最大百分比。                                                                             |
### 產生器專屬選項

產生器專屬選項會加到 `<fluid-img>` 元件上，但只有在同時設定對應的 `generator` 屬性時才有效。

#### 隨機與預測產生器選項

| 選項                | 值                        | 預設值 | 說明                                         |
| ------------------- | ------------------------- | ------ | --------------------------------------------- |
| `batch-percentage`  | 數值 (0-1，例如 0.1)      | 0.1    | 每批次要產生的縫線百分比                      |
| `min-batch-size`    | 數值 (例如 `10`)          | 10     | 每批次要產生的最小縫線數量                    |

## 運作原理

縫線雕刻是一種內容感知的圖片調整技術，能夠智能地移除或新增像素，使圖片在調整大小時不會扭曲重要內容。欲了解更多資訊，請參見[維基百科文章](https://zh.wikipedia.org/wiki/%E7%BA%A4%E7%BA%BF%E9%9B%95%E5%88%BB)。

過去，縫線雕刻對計算資源的需求過高，不適合於網頁瀏覽器中即時使用。不過，這項限制可以藉由使用運算負擔較小、且在多數情境下效果良好的替代演算法來克服。

縫線雕刻產生器有兩種實作方式：
### 隨機雕刻

隨機縫線雕刻方法捨棄了傳統的縫線雕刻演算法，因為傳統方法在瀏覽器即時執行時過於緩慢。

相反地，它會產生一組隨機縫線，這些縫線透過將每一列的每個像素連接到下一列的鄰近像素，從而提供 100% 的圖像覆蓋率。接著它會遍歷每一條縫線，計算其能量，並丟棄一批能量最低的縫線。這個過程會重複進行，直到達到所需的縫線數量。這種方法對於許多圖像來說，能產生出乎意料的良好結果。

### 預測式雕刻

與隨機雕刻類似，此方法會產生能量圖並批次生成縫線。它同時也會為每一批次產生最小能量圖。核心理念是同時建立「好」縫線與「壞」縫線。好縫線具有較低的能量，會被保留。壞縫線則包含高能量像素，方便之後被過濾掉。

從第一列開始，它將像素對連接到下一列中對應的像素對。進行運算時，會將低能量縫線與最小能量圖中的低能量縫線連接起來。

結果會得到一條真正最佳的縫線、許多「非常好」的縫線、許多「非常壞」的縫線，以及很多普通的縫線。我們會選擇一批「好」縫線，丟棄其餘的，並重複此過程。

##

## TODO

### 高優先順序

- [x] Web 元件
- [x] 可從產生器取得資料並可縮放至任意尺寸的渲染器
- [x] 隨機產生器
- [x] 垂直雕刻
- [x] 預測式產生器
- [ ] 所有產生器皆支援 Web workers
### 低優先順序

- [x] 遮罩
- [ ] 臉部辨識

### 遙不可及的夢想

- [ ] 2D 雕刻

## 授權條款

本軟體依據 Fluid-Img 限制收益授權條款授權。

**免費使用**：僅限年總營收低於 10,000,000 美元的個人與組織。

**需商業授權**：年營收達 1,000 萬美元以上的組織需另行申請商業授權。請聯絡 [licensing@voice.ngo] 以洽詢商業授權條款。

完整條款請參閱 [LICENSE](./LICENSE) 檔案。

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-11

---