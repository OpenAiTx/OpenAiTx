# เว็บคอมโพเนนต์ Fluid Image

รูปภาพที่ปรับขนาดได้อย่างชาญฉลาดให้เหมาะสมกับทุกขนาดที่ต้องการ (ภายในขอบเขตที่เหมาะสม)

![Fluid Images](https://raw.githubusercontent.com/VoiceNGO/fluid-img/refs/heads/main/resources/images/responsive-images.jpg)

**ขนาดเล็กมาก!:** 7kb เมื่อบีบอัดและย่อขนาดแล้ว

## วิธีใช้งาน

```html
<script src="fluid-img.js"></script>
<fluid-img src="image.jpg"></fluid-img>
```

แค่นี้เอง ปรับขนาดรูปภาพได้ตามต้องการ แล้วรูปภาพจะปรับขนาดเองโดยอัตโนมัติ

## สาธิต

[ดูตัวอย่างที่นี่](https://voicengo.github.io/fluid-img/public/fluid-demo.html)

มีพื้นที่ทดลองสำหรับ [ทดสอบกับรูปภาพของคุณเอง](https://voicengo.github.io/fluid-img/public) ด้วย
## การติดตั้ง

### ไลบรารีฝั่งไคลเอนต์

```sh
npm install fluid-img
```

จากนั้น import `fluid-img` ในโปรเจกต์ของคุณ ซึ่งจะทำการให้บริการและลงทะเบียน web-component:

```ts
import 'fluid-img';
```

หรือเพิ่มสคริปต์จาก jsdelivr หรือ unpkg:

```html
<script src="https://cdn.jsdelivr.net/npm/fluid-img@latest/dist/fluid-img.js" />

<!-- หรือ -->

<script src="https://unpkg.com/fluid-img@latest/dist/fluid-img.js" />
```
### ข้อควรระวัง

คอมโพเนนต์ภาพ Fluid ทำงานได้ดีที่สุดกับการปรับขนาดภาพในแนวนอนหรือแนวตั้งภายในช่วงประมาณ 0.5x ถึง 1.5x ของขนาดเดิมของภาพ แม้ว่าจะสามารถรองรับการปรับขนาดที่ใหญ่หรือเล็กกว่านี้ได้ แต่คุณภาพของภาพอาจลดลงอย่างรวดเร็ว ไม่แนะนำให้ใช้กับภาพที่ต้องการความแม่นยำของพิกเซล เช่น ภาพบุคคล กราฟ หรือแบบวาดทางเทคนิคที่มีรายละเอียดมาก เนื่องจาก Seam Carving อาจทำให้เกิดความผิดเพี้ยน ขอแนะนำอย่างยิ่งให้ทดสอบภาพของคุณในขนาดต่าง ๆ เพื่อให้แน่ใจว่าตรงกับความต้องการทางสายตาของคุณ

#### CORS

เนื่องจากข้อจำกัดด้านความปลอดภัยของเบราว์เซอร์ ภาพที่โหลดมาจากต้นทาง (Origin) อื่น (โดเมน โปรโตคอล หรือพอร์ต) ที่แตกต่างจากหน้าเว็บจะทำให้เกิดข้อผิดพลาด Cross-Origin Resource Sharing (CORS) คอมโพเนนต์นี้ต้องการเข้าถึงข้อมูลพิกเซลดิบของภาพ ซึ่งถูกจำกัดโดย CORS

หากต้องการใช้ภาพจากต้นทางที่แตกต่างกัน เซิร์ฟเวอร์ที่โฮสต์ภาพนั้นต้องกำหนดค่าให้ส่ง CORS headers ที่เหมาะสม (เช่น `Access-Control-Allow-Origin: *` หรือ `Access-Control-Allow-Origin: your-domain.com`) หากไม่มี headers เหล่านี้ คอมโพเนนต์จะไม่สามารถประมวลผลภาพได้

(สำหรับการทดสอบ ภาพใด ๆ บน imgur มี CORS headers ที่จำเป็นครบถ้วน)

#### Fallback

หากคอมโพเนนต์ไม่สามารถโหลดหรือประมวลผลภาพได้ หรือเกิดข้อผิดพลาดภายใน ระบบจะถอยกลับอย่างนุ่มนวลโดยการแทรกแท็ก `<img>` มาตรฐานลงในคอมโพเนนต์ `<fluid-img>` โดยปรับความกว้างและความสูงเป็น 100% เพื่อให้มั่นใจว่ายังคงแสดงภาพได้

## ตัวเลือก

การใช้งาน: `<fluid-img src="image.jpg" generator="random" max-carve-up-scale="5"></fluid-img>`

โดยปกติ `generator` จะถูกตั้งค่าเป็น `random` ซึ่งทำงานได้เร็วที่สุด

| ตัวเลือก                        | ค่า                               | ค่าเริ่มต้น   | คำอธิบาย                                                                                                                     |
| ------------------------------ | -------------------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| `src`                          | URL                              |              | URL ของภาพที่จะนำมาประมวลผล                                                                                                 |
| `generator`                    | `random`, `predictive`           | `predictive` | ตัวเลือก generator สำหรับ seam carving `random` ทำงานเร็วกว่าแต่คุณภาพต่ำกว่า                                              |
| `scaling-axis`                 | `horizontal`, `vertical`, `auto` | `horizontal` | แกนที่ใช้ในการปรับขนาด `auto` จะเลือกแนวนอนหรือแนวตั้งตามการเปลี่ยนแปลงอัตราส่วนภาพ                                      |
| `mask`                         | URL                              |              | URL ของภาพ mask พื้นที่สีดำใน mask จะมี energy ต่ำกว่าและมีโอกาสถูกรักษาไว้มากกว่า                                         |
| `carving-priority`             | Number (0-1, เช่น `0.5`)         | `1`          | เปอร์เซ็นต์ของการปรับขนาดที่จะทำโดย seam carving เทียบกับการปรับขนาดภาพแบบปกติ                                            |
| `max-carve-up-seam-percentage` | Number (0-1, เช่น `0.5`)         | `0.6`        | เปอร์เซ็นต์สูงสุดของ seams ที่จะเพิ่มเมื่อขยายภาพ จำกัดการสร้าง seam ใหม่เพื่อรักษาคุณภาพภาพ                              |
| `max-carve-up-scale`           | Number (เช่น `3`)                | `3`          | ปัจจัยขยายสูงสุดโดยใช้ seam carving เกินค่านี้จะใช้การปรับขนาดภาพแบบปกติแทน                                              |
| `max-carve-down-scale`         | Number (0-1, เช่น `0.7`)         | `0.7`        | เปอร์เซ็นต์สูงสุดของภาพที่จะถูกลบออกโดย seam carving เมื่อย่อขนาดภาพ                                                       |
### ตัวเลือกเฉพาะของ Generator

ตัวเลือกเฉพาะของ Generator จะถูกเพิ่มเข้าไปในคอมโพเนนต์ `<fluid-img>` แต่จะใช้ได้ก็ต่อเมื่อมีการกำหนดแอตทริบิวต์
`generator` ที่เกี่ยวข้องด้วยเช่นกัน

#### ตัวเลือกของ Random & Predictive Generator

| ตัวเลือก               | ค่า                         | ค่าเริ่มต้น | คำอธิบาย                                           |
| ---------------------- | -------------------------- | ----------- | -------------------------------------------------- |
| `batch-percentage`     | ตัวเลข (0-1, เช่น 0.1)     | 0.1         | เปอร์เซ็นต์ของ seams ที่จะถูกสร้างในแต่ละ batch    |
| `min-batch-size`       | ตัวเลข (เช่น `10`)         | 10          | จำนวนขั้นต่ำของ seams ที่จะถูกสร้างในแต่ละ batch   |

## วิธีการทำงาน

Seam carving คือเทคนิคปรับขนาดรูปภาพแบบคำนึงถึงเนื้อหา ที่สามารถลบหรือเพิ่มพิกเซลได้อย่างชาญฉลาด ช่วยให้สามารถปรับขนาดภาพโดยไม่ทำให้เนื้อหาสำคัญบิดเบี้ยว สำหรับข้อมูลเพิ่มเติม ดูที่ [บทความวิกิพีเดีย](https://en.wikipedia.org/wiki/Seam_carving) ในหัวข้อนี้

ในอดีต seam carving มีความต้องการทรัพยากรคอมพิวเตอร์สูงเกินไปสำหรับการใช้งานแบบเรียลไทม์ในเว็บเบราว์เซอร์ อย่างไรก็ตาม ข้อจำกัดนี้สามารถแก้ไขได้ด้วยการใช้ขั้นตอนวิธีทางเลือกที่ใช้ทรัพยากรน้อยกว่าและเหมาะกับหลายๆ สถานการณ์

มีการนำไปใช้งานของ seam carving generator อยู่สองแบบ:
### การตัดแบบสุ่ม (Random Carving)

วิธีการตัดตะเข็บแบบสุ่มนี้ละทิ้งอัลกอริทึมการตัดตะเข็บแบบดั้งเดิม ซึ่งทำงานช้าเกินไปสำหรับการประมวลผลแบบเรียลไทม์บนเบราว์เซอร์

แทนที่จะใช้วิธีเดิม มันจะสร้างชุดของตะเข็บแบบสุ่มที่ครอบคลุมภาพ 100% โดยการเชื่อมต่อแต่ละพิกเซลในแถวกับพิกเซลข้างเคียงในแถวถัดไป จากนั้นจะทำการวนซ้ำผ่านแต่ละตะเข็บ คำนวณพลังงานของมัน และตัดชุดของตะเข็บที่มีพลังงานต่ำที่สุดทิ้งไป กระบวนการนี้จะทำซ้ำจนกว่าจะได้จำนวนตะเข็บตามที่ต้องการ วิธีนี้ให้ผลลัพธ์ที่ดีอย่างน่าประหลาดใจสำหรับภาพหลายๆ ภาพ

### การตัดแบบทำนาย (Predictive Carving)

คล้ายกับการตัดแบบสุ่ม วิธีนี้จะสร้างแผนที่พลังงานและสร้างตะเข็บเป็นชุดๆ เช่นกัน มันยังสร้างแผนที่พลังงานขั้นต่ำสำหรับแต่ละชุดด้วย แนวคิดหลักคือการสร้างทั้งตะเข็บ "ดี" และ "ไม่ดี" ตะเข็บที่ดีมีพลังงานต่ำและจะถูกเก็บไว้ ตะเข็บที่ไม่ดีจะประกอบด้วยพิกเซลที่มีพลังงานสูง ทำให้สามารถกรองออกได้ในภายหลัง

โดยเริ่มจากแถวแรก จะเชื่อมต่อคู่ของพิกเซลกับคู่ที่สอดคล้องกันในแถวถัดไป ตะเข็บที่มีพลังงานต่ำกว่าจากการคำนวณแบบรันนิ่งจะถูกเชื่อมต่อกับตะเข็บที่มีพลังงานต่ำกว่าจากแผนที่พลังงานขั้นต่ำ

ผลลัพธ์ที่ได้คือตะเข็บที่เหมาะสมที่สุดจริงๆ หนึ่งเส้น ตะเข็บที่ "ดีมาก" จำนวนมาก ตะเข็บที่ "แย่มาก" จำนวนมาก และตะเข็บปานกลางอีกจำนวนหนึ่ง เราจะเลือกชุดของตะเข็บ "ดี" แล้วตัดส่วนที่เหลือทิ้ง จากนั้นทำซ้ำกระบวนการนี้

##

## สิ่งที่ต้องทำ (TODO)

### ลำดับความสำคัญสูง

- [x] เว็บคอมโพเนนต์
- [x] ตัวเรนเดอร์ที่รับข้อมูลจากตัวสร้างและปรับขนาดได้ตามต้องการ
- [x] ตัวสร้างแบบสุ่ม
- [x] การตัดแบบแนวตั้ง
- [x] ตัวสร้างแบบทำนาย
- [ ] เว็บเวิร์กเกอร์สำหรับตัวสร้างทั้งหมด
### ความสำคัญต่ำ

- [x] การปิดบัง
- [ ] การจดจำใบหน้า

### ความฝันที่ยังไม่เป็นจริง

- [ ] การแกะสลักแบบ 2 มิติ

## การอนุญาตให้ใช้สิทธิ์

ซอฟต์แวร์นี้ได้รับอนุญาตภายใต้ Fluid-Img Revenue-Limited License

**ใช้ฟรี** สำหรับบุคคลและองค์กรที่มีรายได้รวมต่อปีต่ำกว่า $10,000,000 USD

**ต้องใช้ใบอนุญาตเชิงพาณิชย์** สำหรับองค์กรที่มีรายได้ต่อปี $10M ขึ้นไป กรุณาติดต่อ [licensing@voice.ngo] เพื่อขอรายละเอียดเงื่อนไขใบอนุญาตเชิงพาณิชย์

ดูไฟล์ [LICENSE](./LICENSE) สำหรับเงื่อนไขฉบับสมบูรณ์

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-11

---