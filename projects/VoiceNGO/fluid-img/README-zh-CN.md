# 流体图片 Web 组件

图片能够智能地缩放到任何所需尺寸（在合理范围内）。

![流体图片](https://raw.githubusercontent.com/VoiceNGO/fluid-img/refs/heads/main/resources/images/responsive-images.jpg)

**超小！**：7kb（压缩与 gzip 后）

## 用法

```html
<script src="fluid-img.js"></script>
<fluid-img src="image.jpg"></fluid-img>
```

就这样。随意缩放图片，它们会自动适应。

## 演示

[演示地址](https://voicengo.github.io/fluid-img/public/fluid-demo.html)

还提供了一个[实验你自己的图片的游乐场](https://voicengo.github.io/fluid-img/public)。
## 安装

### 客户端库

```sh
npm install fluid-img
```

然后在你的项目中导入 `fluid-img`，它将提供并注册该 web 组件：

```ts
import 'fluid-img';
```

或者从 jsdelivr 或 unpkg 引入脚本：

```html
<script src="https://cdn.jsdelivr.net/npm/fluid-img@latest/dist/fluid-img.js" />

<!-- 或者 -->

<script src="https://unpkg.com/fluid-img@latest/dist/fluid-img.js" />
```
### 注意事项

流体图片组件在图片水平方向或垂直方向缩放至原始尺寸约 0.5 倍至 1.5 倍的范围内效果最佳。虽然它可以处理更大或更小的缩放比例，但视觉质量可能会迅速下降。不建议用于对像素精度要求极高的图片，如肖像、图表或详细的技术绘图，因为缝合裁剪会引入失真。强烈建议在不同尺寸下测试您的图片，以确保它们符合您的视觉预期。

#### CORS

由于浏览器安全限制，从不同源（域名、协议或端口）加载的图片会触发跨源资源共享（CORS）错误。该组件需要访问图片的原始像素数据，而 CORS 会对此进行限制。

要使用来自不同源的图片，托管图片的服务器必须配置相应的 CORS 响应头（例如 `Access-Control-Allow-Origin: *` 或 `Access-Control-Allow-Origin: your-domain.com`）。没有这些响应头，组件将无法处理图片。

（供参考，用于测试的任何 imgur 图片都带有必要的 CORS 响应头）

#### 回退

如果组件无法加载或处理图片，或抛出内部错误，它将优雅地降级为在 `<fluid-img>` 组件内注入一个标准的 `<img>` 标签，宽度和高度均为 100%，确保图片仍然能够显示。

## 选项

用法：`<fluid-img src="image.jpg" generator="random" max-carve-up-scale="5"></fluid-img>`

默认情况下，使用 `random` 生成器，因为它速度最快。

| 选项                           | 可选值                           | 默认值       | 说明                                                                                                 |
| ------------------------------ | -------------------------------- | ------------ | ---------------------------------------------------------------------------------------------------- |
| `src`                          | URL                              |              | 要处理的图片的 URL。                                                                                 |
| `generator`                    | `random`, `predictive`           | `predictive` | 要使用的缝合裁剪生成器。`random` 更快但质量较低。                                                   |
| `scaling-axis`                 | `horizontal`, `vertical`, `auto` | `horizontal` | 缩放的轴向。`auto` 根据宽高比变化选择水平或垂直缩放。                                               |
| `mask`                         | URL                              |              | 遮罩图片的 URL。遮罩的黑色区域能量较低，更可能被保留。                                              |
| `carving-priority`             | 数值 (0-1, 如 `0.5`)             | `1`          | 缝合裁剪与传统图片缩放的缩放比例百分比。                                                            |
| `max-carve-up-seam-percentage` | 数值 (0-1, 如 `0.5`)             | `0.6`        | 放大时可插入的最大缝合比例。限制新缝合的创建以保持图片质量。                                        |
| `max-carve-up-scale`           | 数值 (如 `3`)                    | `3`          | 使用缝合裁剪时的最大放大倍数。超过此倍数将使用传统缩放。                                            |
| `max-carve-down-scale`         | 数值 (0-1, 如 `0.7`)             | `0.7`        | 缩小时可通过缝合裁剪移除的最大图片比例。                                                            |
### 特定生成器选项

特定生成器选项会添加到 `<fluid-img>` 组件中，但仅在同时设置了相应的 `generator` 属性时才有效。

#### 随机 & 预测生成器选项

| 选项                | 可选值                    | 默认值  | 描述                                 |
| ------------------- | ------------------------- | ------- | ------------------------------------ |
| `batch-percentage`  | 数字 (0-1，如 0.1)        | 0.1     | 每批次要生成的缝隙百分比              |
| `min-batch-size`    | 数字 (如 `10`)            | 10      | 每批次要生成的最小缝隙数量            |

## 工作原理

缝隙雕刻是一种内容感知的图像缩放技术，它能够智能地移除或添加像素，从而使图像在缩放时不会扭曲重要内容。更多信息请参阅该主题的 [维基百科文章](https://en.wikipedia.org/wiki/Seam_carving)。

历史上，缝隙雕刻对于网页浏览器中的实时应用来说计算量过大。然而，这一限制可以通过使用计算量更低、在许多场景下效果良好的替代算法来克服。

缝隙雕刻生成器有两种实现方式：
### 随机裁剪

随机缝合裁剪方法舍弃了传统的缝合裁剪算法，因为后者在浏览器中实时执行速度过慢。

相反，它通过将每一行中的每个像素与下一行中的相邻像素相连，生成一组能够实现 100% 图像覆盖的随机缝合线。然后，它遍历每一条缝合线，计算其能量，并批量丢弃能量最低的缝合线。该过程重复进行，直到达到所需的缝合线数量。对于许多图像，这种方法能产生令人惊讶的良好效果。

### 预测裁剪

与随机裁剪类似，该方法生成能量图并批量创建缝合线。它还为每一批次生成一张最小能量图。其核心思想是同时创建“优质”缝合线和“劣质”缝合线。优质缝合线能量较低，予以保留。劣质缝合线包含高能量像素，便于后续筛除。

从第一行开始，将像素对连接到下一行中对应的像素对。在运行计算中能量较低的缝合线与最小能量图中能量较低的缝合线相连。

最终结果是一条真正最优的缝合线、许多“非常优质”的缝合线、许多“非常劣质”的缝合线，以及大量中等质量的缝合线。我们选择一批“优质”缝合线，丢弃其余缝合线，并重复该过程。

##

## 待办事项

### 高优先级

- [x] Web 组件
- [x] 能从生成器获取数据并可缩放至任意尺寸的渲染器
- [x] 随机生成器
- [x] 垂直裁剪
- [x] 预测生成器
- [ ] 所有生成器的 Web Workers
### 低优先级

- [x] 马赛克
- [ ] 人脸识别

### 远景规划

- [ ] 2D雕刻

## 许可协议

本软件遵循 Fluid-Img 收入限制许可协议。

**个人及年总收入低于 10,000,000 美元的组织可免费使用。**

**年收入超过 1,000 万美元的组织需购买商业许可。** 请联系 [licensing@voice.ngo] 获取商业许可条款。

完整条款请参见 [LICENSE](./LICENSE) 文件。

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-11

---