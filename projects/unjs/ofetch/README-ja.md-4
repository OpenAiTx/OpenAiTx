{
  "id": 4,
  "origin": "```\n\n## ğŸ•µï¸ Adding HTTP(S) Agent\n\nIn Node.js (>= 18) environments, you can provide a custom dispatcher to intercept requests and support features such as Proxy and self-signed certificates. This feature is enabled by [undici](https://undici.nodejs.org/) built-in Node.js. [read more](https://undici.nodejs.org/#/docs/api/Dispatcher) about the Dispatcher API.\n\nSome available agents:\n\n- `ProxyAgent`: A Proxy Agent class that implements the Agent API. It allows the connection through a proxy in a simple way. ([docs](https://undici.nodejs.org/#/docs/api/ProxyAgent))\n- `MockAgent`: A mocked Agent class that implements the Agent API. It allows one to intercept HTTP requests made through undici and return mocked responses instead. ([docs](https://undici.nodejs.org/#/docs/api/MockAgent))\n- `Agent`: Agent allows dispatching requests against multiple different origins. ([docs](https://undici.nodejs.org/#/docs/api/Agent))\n\n**Example:** Set a proxy agent for one request:\n\n```ts\nimport { ProxyAgent } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nconst data = await ofetch(\"https://icanhazip.com\", { dispatcher: proxyAgent });\n```\n\n**Example:** Create a custom fetch instance that has proxy enabled:\n\n```ts\nimport { ProxyAgent, setGlobalDispatcher } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nconst fetchWithProxy = ofetch.create({ dispatcher: proxyAgent });\n\nconst data = await fetchWithProxy(\"https://icanhazip.com\");\n```\n\n**Example:** Set a proxy agent for all requests:\n\n```ts\nimport { ProxyAgent, setGlobalDispatcher } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nsetGlobalDispatcher(proxyAgent);\n\nconst data = await ofetch(\"https://icanhazip.com\");\n```\n\n**Example:** Allow self-signed certificates (USE AT YOUR OWN RISK!)\n\n```ts\nimport { ProxyAgent } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\n// Note: This makes fetch unsecure against MITM attacks. USE AT YOUR OWN RISK!\nconst unsecureProxyAgent = new ProxyAgent({ requestTls: { rejectUnauthorized: false } });\nconst unsecureFetch = ofetch.create({ dispatcher: unsecureProxyAgent });\n\nconst data = await unsecureFetch(\"https://www.squid-cache.org/\");\n```\n\nOn older Node.js version (<18), you might also use use `agent`:\n\n```ts\nimport { HttpsProxyAgent } from \"https-proxy-agent\";\n\nawait ofetch(\"/api\", {\n  agent: new HttpsProxyAgent(\"http://example.com\"),\n});\n```\n\n### `keepAlive` support (only works for Node < 18)\n\nBy setting the `FETCH_KEEP_ALIVE` environment variable to `true`, an HTTP/HTTPS agent will be registered that keeps sockets around even when there are no outstanding requests, so they can be used for future requests without having to re-establish a TCP connection.\n\n**Note:** This option can potentially introduce memory leaks. Please check [node-fetch/node-fetch#1325](https://github.com/node-fetch/node-fetch/pull/1325).\n\n## ğŸ“¦ Bundler Notes\n\n- All targets are exported with Module and CommonJS format and named exports\n- No export is transpiled for the sake of modern syntax\n  - You probably need to transpile `ofetch`, `destr`, and `ufo` packages with Babel for ES5 support\n- You need to polyfill `fetch` global for supporting legacy browsers like using [unfetch](https://github.com/developit/unfetch)\n\n## â“ FAQ\n\n**Why export is called `ofetch` instead of `fetch`?**\n\nUsing the same name of `fetch` can be confusing since API is different but still, it is a fetch so using the closest possible alternative. You can, however, import `{ fetch }` from `ofetch` which is auto-polyfill for Node.js and using native otherwise.\n\n**Why not have default export?**\n\nDefault exports are always risky to be mixed with CommonJS exports.\n\nThis also guarantees we can introduce more utils without breaking the package and also encourage using `ofetch` name.\n\n**Why not transpiled?**\n\nBy transpiling libraries, we push the web backward with legacy code which is unneeded for most of the users.\n\nIf you need to support legacy users, you can optionally transpile the library in your build pipeline.\n",
  "origin_sha": "aERgTRlscCw9FINz3st04QU8LoGdZrVhR2FMqnTr5aI=",
  "translate": "```\n\n## ğŸ•µï¸ HTTP(S) ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿½åŠ \n\nNode.jsï¼ˆ>= 18ï¼‰ç’°å¢ƒã§ã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ãƒ¼ã‚’æŒ‡å®šã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã€ãƒ—ãƒ­ã‚­ã‚·ã‚„è‡ªå·±ç½²åè¨¼æ˜æ›¸ãªã©ã®æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯Node.jsã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ [undici](https://undici.nodejs.org/) ã«ã‚ˆã‚Šæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚Dispatcher API ã«ã¤ã„ã¦ã¯[ã“ã¡ã‚‰](https://undici.nodejs.org/#/docs/api/Dispatcher)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\n\nåˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä¾‹:\n\n- `ProxyAgent`: Agent API ã‚’å®Ÿè£…ã—ãŸãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã§ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã®æ¥ç¶šã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚([ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://undici.nodejs.org/#/docs/api/ProxyAgent))\n- `MockAgent`: Agent API ã‚’å®Ÿè£…ã—ãŸãƒ¢ãƒƒã‚¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã§ã™ã€‚undici çµŒç”±ã® HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã€ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚([ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://undici.nodejs.org/#/docs/api/MockAgent))\n- `Agent`: è¤‡æ•°ã®ç•°ãªã‚‹ã‚ªãƒªã‚¸ãƒ³ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã§ãã¾ã™ã€‚([ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://undici.nodejs.org/#/docs/api/Agent))\n\n**ä¾‹:** 1ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹:\n\n```ts\nimport { ProxyAgent } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nconst data = await ofetch(\"https://icanhazip.com\", { dispatcher: proxyAgent });\n```\n\n**ä¾‹:** ãƒ—ãƒ­ã‚­ã‚·æœ‰åŠ¹ãªã‚«ã‚¹ã‚¿ãƒ  fetch ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹:\n\n```ts\nimport { ProxyAgent, setGlobalDispatcher } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nconst fetchWithProxy = ofetch.create({ dispatcher: proxyAgent });\n\nconst data = await fetchWithProxy(\"https://icanhazip.com\");\n```\n\n**ä¾‹:** ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹:\n\n```ts\nimport { ProxyAgent, setGlobalDispatcher } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\nconst proxyAgent = new ProxyAgent(\"http://localhost:3128\");\nsetGlobalDispatcher(proxyAgent);\n\nconst data = await ofetch(\"https://icanhazip.com\");\n```\n\n**ä¾‹:** è‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’è¨±å¯ã™ã‚‹ï¼ˆè‡ªå·±è²¬ä»»ã§ã”åˆ©ç”¨ãã ã•ã„ï¼ï¼‰\n\n```ts\nimport { ProxyAgent } from \"undici\";\nimport { ofetch } from \"ofetch\";\n\n// æ³¨æ„: ã“ã‚Œã«ã‚ˆã‚Š MITM æ”»æ’ƒã«å¯¾ã—ã¦ fetch ãŒå®‰å…¨ã§ãªããªã‚Šã¾ã™ã€‚è‡ªå·±è²¬ä»»ã§ã”åˆ©ç”¨ãã ã•ã„ï¼\nconst unsecureProxyAgent = new ProxyAgent({ requestTls: { rejectUnauthorized: false } });\nconst unsecureFetch = ofetch.create({ dispatcher: unsecureProxyAgent });\n\nconst data = await unsecureFetch(\"https://www.squid-cache.org/\");\n```\n\nå¤ã„ Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ<18ï¼‰ã§ã¯ã€`agent` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:\n\n```ts\nimport { HttpsProxyAgent } from \"https-proxy-agent\";\n\nawait ofetch(\"/api\", {\n  agent: new HttpsProxyAgent(\"http://example.com\"),\n});\n```\n\n### `keepAlive` ã‚µãƒãƒ¼ãƒˆï¼ˆNode < 18 ã®ã¿æœ‰åŠ¹ï¼‰\n\n`FETCH_KEEP_ALIVE` ç’°å¢ƒå¤‰æ•°ã‚’ `true` ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€æœªå‡¦ç†ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãªãã¦ã‚‚ã‚½ã‚±ãƒƒãƒˆã‚’ç¶­æŒã—ã€å°†æ¥ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ TCP æ¥ç¶šã‚’å†ç¢ºç«‹ã›ãšã«åˆ©ç”¨ã§ãã‚‹ HTTP/HTTPS ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚\n\n**æ³¨æ„:** ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚[node-fetch/node-fetch#1325](https://github.com/node-fetch/node-fetch/pull/1325) ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\n\n## ğŸ“¦ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒãƒ¼ãƒˆ\n\n- ã™ã¹ã¦ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ Module ãŠã‚ˆã³ CommonJS å½¢å¼ã€åå‰ä»˜ãã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™\n- ãƒ¢ãƒ€ãƒ³ãªæ§‹æ–‡ç¶­æŒã®ãŸã‚ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“\n  - ES5 ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ãªå ´åˆã¯ã€`ofetch`, `destr`, `ufo` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ Babel ã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\n- ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œã«ã¯ã€[unfetch](https://github.com/developit/unfetch) ãªã©ã‚’ä½¿ã„ `fetch` ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’ãƒãƒªãƒ•ã‚£ãƒ«ã—ã¦ãã ã•ã„\n\n## â“ FAQ\n\n**ãªãœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆåãŒ `fetch` ã§ã¯ãªã `ofetch` ãªã®ã§ã™ã‹ï¼Ÿ**\n\n`fetch` ã¨åŒã˜åå‰ã‚’ä½¿ã†ã¨ API ãŒç•°ãªã‚‹ãŸã‚æ··ä¹±ã‚’æ‹›ãå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€fetch ã§ã‚ã‚‹ã“ã¨ã«é•ã„ã¯ãªã„ã®ã§ã€ã§ãã‚‹ã ã‘è¿‘ã„ä»£æ›¿æ¡ˆã¨ã—ã¦ `ofetch` ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€`ofetch` ã‹ã‚‰ `{ fetch }` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã§ãã€Node.js ã§ã¯è‡ªå‹•çš„ã«ãƒãƒªãƒ•ã‚£ãƒ«ã•ã‚Œã€ãã‚Œä»¥å¤–ã§ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ãŒä½¿ã‚ã‚Œã¾ã™ã€‚\n\n**ãªãœãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒãªã„ã®ã§ã™ã‹ï¼Ÿ**\n\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯ CommonJS ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¨æ··åœ¨ã™ã‚‹ã¨å¸¸ã«ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚\n\nã“ã®æ–¹é‡ã«ã‚ˆã‚Šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å£Šã™ã“ã¨ãªãä»–ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’è¿½åŠ ã§ãã€`ofetch` ã¨ã„ã†åå‰ã®åˆ©ç”¨ã‚‚ä¿ƒé€²ã§ãã¾ã™ã€‚\n\n**ãªãœãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã„ãªã„ã®ã§ã™ã‹ï¼Ÿ**\n\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ã€ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ä¸è¦ãªãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã‚¦ã‚§ãƒ–ã®é€²åŒ–ã‚’å¦¨ã’ã¦ã—ã¾ã„ã¾ã™ã€‚\n\nãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ“ãƒ«ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä»»æ„ã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã—ã¦ãã ã•ã„ã€‚\n```",
  "status": "ok"
}