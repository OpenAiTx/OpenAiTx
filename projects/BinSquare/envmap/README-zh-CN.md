<p align="center">
  <img src="https://raw.githubusercontent.com/BinSquare/envmap/main/./logo.svg" alt="envmap logo" width="280">
</p>

<p align="center">
  <a href="https://github.com/binsquare/envmap/stargazers">
    <img src="https://img.shields.io/github/stars/binsquare/envmap?style=social" alt="GitHub stars">
  </a>
  <a href="https://github.com/binsquare/envmap/actions/workflows/release.yml">
    <img src="https://img.shields.io/github/actions/workflow/status/binsquare/envmap/release.yml?branch=main&event=push&label=release" alt="Release workflow status">
  </a>
  <a href="https://pkg.go.dev/github.com/binsquare/envmap">
    <img src="https://pkg.go.dev/badge/github.com/binsquare/envmap" alt="Go pkg Reference">
  </a>
  <a href="https://goreportcard.com/report/github.com/binsquare/envmap">
    <img src="https://goreportcard.com/badge/github.com/binsquare/envmap" alt="Go Report Card">
  </a>
  <a href="https://github.com/binsquare/envmap/blob/main/LICENSE">
    <img src="https://img.shields.io/github/license/binsquare/envmap" alt="License: Apache-2.0">
  </a>
</p>

# envmap

`envmap` 是一个本地环境管理工具，帮助你：

1.  使本地环境变量与远程秘密存储保持同步，按项目区分。
2.  使 `.env` 文件成为一个短暂的产物，保持秘密提供者作为唯一真实来源。即通过 "envmap --sync" 生成最新的 `.env` 文件。
3.  为每个存储的密钥附带元数据，告知密钥最后的更改/创建时间，便于定期轮换。
4.  可能提升安全性，因为你不必将秘密存储在明文的 `.env` 文件中。
5.  完全本地运行且开源，方便审计。

### 适用人群？

- 与多个 `.env` 变体（如 `.env.prod`, `.env.dev`, `.env.staging`）打交道的工程师。此工具帮助你合并并通过单条命令切换环境。下面是该工作流程的示例： 

```
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ ./envmap sync --env prod
Wrote .env (1 secrets)
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ cat .env
# generated by envmap sync 2025-12-01T07:49:20Z
testkey=apishofih123
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ ./envmap sync --env dev
Wrote .env (1 secrets)
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ cat .env
# generated by envmap sync 2025-12-01T07:50:07Z
testkey=test123
```
- 工程师处理大量环境变量，只想要一个帮助管理的工具，通过确保你拥有元数据来提高开发速度  
- 跨多个项目工作的工程师希望统一管理和跟踪全局环境变量  

## 安装  

### 选项1：Go工具链  


```sh
go install github.com/binsquare/envmap@latest
```

### 选项 2：预构建二进制文件（bash）

```sh
# install into /usr/local/bin (requires sudo)
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz" \
  | sudo tar -xz -C /usr/local/bin envmap

# or install into ~/.local/bin (no sudo; ensure it's on PATH)
mkdir -p ~/.local/bin
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz" \
  | tar -xz -C ~/.local/bin envmap

# (optional) verify checksum (adjust path if using ~/.local/bin)
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz.sha256" \
  | sha256sum --check -
```
如果您使用 `~/.local/bin` 选项，请确保您的 shell 已加载它（大多数现代 shell 已经如此；否则请将 `export PATH="$HOME/.local/bin:$PATH"` 添加到您的配置文件中）。

重启 shell（或重新加载配置文件），然后运行 `envmap --help` 以验证。

## 快速开始（本地提供者）


```sh
# 1. Generate encryption key (writes to ~/.envmap/key)
envmap keygen

# 2. Configure global provider (wizard; runs keygen if needed)
envmap init --global

# 3. Create project config (wizard)
envmap init

# 4. Add secrets
envmap set --env dev DATABASE_URL --prompt
envmap set --env dev STRIPE_KEY --prompt

# 5. Inspect/export/run
envmap get --env dev --all
eval $(envmap export --env dev)
envmap run --env dev -- npm start
```

推荐使用向导，但也支持手动配置。请使用绝对路径（Go 不会展开 `~` 或 `${HOME}`）。

<details>
<summary>手动配置参考</summary>

### 全局配置（`~/.envmap/config.yaml`）

```yaml
providers:
  local-dev:
    type: local-file
    path: /Users/<you>/.envmap/secrets.db
    encryption:
      key_file: /Users/<you>/.envmap/key
```

### 项目配置 (`.envmap.yaml`)

```yaml
project: demo
default_env: dev
envs:
  dev:
    provider: local-dev
    prefix: demo/dev/
```

</details>

## 使用方法

- `envmap run [--env <name>] -- <command>` – 获取密钥并注入为环境变量运行命令（磁盘永远不会保存它们）。
- `envmap export [--env <name>] [--format plain|json]` – 输出适用于 `eval`、direnv 或工具的格式。
- `envmap get --env <name> KEY [--raw]` – 读取单个密钥。
- `envmap get --env <name> --all [--raw] [--global]` – 列出所有密钥（默认掩码）；`--global` 遍历所有环境。
- `envmap set --env <name> KEY (--prompt | --file PATH)` – 写入/更新密钥，避免 shell 历史记录。
- `envmap import PATH --env <name> [--delete]` – 导入已有的 `.env` 文件。
- `envmap sync --env <name> [--out .env] [--merge] [--keep-local] [--force] [--backup=false]` – 从提供者密钥写入 .env 文件。默认以提供者为准；`merge` 保留额外本地键；`keep-local` 冲突时保留本地值；`backup` 先写 .bak 备份。
- `envmap sync --env <name> --check` – 报告提供者与 .env 之间的漂移，不写文件。
- `envmap keygen [-o PATH]` – 为本地提供者创建 256 位密钥。
- `envmap validate` – 确认 `.envmap.yaml` 和全局配置引用已定义的提供者。
- `envmap init` / `envmap init --global` – 交互式项目/全局配置。

### 与 direnv 一起使用

```sh
# .envrc
eval "$(envmap export --env dev)"
```

然后运行 `direnv allow`。每次进入该目录时，direnv 都会重新运行 `envmap export`，并在不触及磁盘的情况下为 shell 填充最新的秘密信息。

## 配置

### 全局配置 (`~/.envmap/config.yaml`)

```yaml
providers:
  aws-dev:
    type: aws-ssm
    region: us-west-2
    profile: dev # optional, uses default credential chain

  vault-prod:
    type: vault
    address: https://vault.internal:8200
    mount: secret # default: secret

  local:
    type: local-file
    path: ~/.envmap/secrets.db
    encryption:
      key_file: ~/.envmap/key # must be chmod 600
      # or: key_env: ENVMAP_KEY
```

### 项目配置（`.envmap.yaml`）

```yaml
project: myapp
default_env: dev

envs:
  dev:
    provider: aws-dev
    path_prefix: /myapp/dev/

  staging:
    provider: aws-dev
    path_prefix: /myapp/staging/

  local:
    provider: local
    prefix: myapp/
```

## 内置提供程序（进行中）

| 类型                 | 认证                       | 说明                                                     |
| -------------------- | -------------------------- | ------------------------------------------------------- |
| `aws-ssm`            | IAM（配置文件/环境/实例）  | 需要 `path_prefix`。使用 SecureString。                  |
| `aws-secretsmanager` | IAM                        | 完整的秘密名称。JSON 秘密展开为 `name/key`。            |
| `gcp-secretmanager`  | ADC 或服务账号             | 读取最新版本。写入时添加版本。                           |
| `vault`              | 令牌（环境/配置）          | KV v2。可配置挂载路径和命名空间。                        |
| `onepassword`        | 连接服务器                 | 需要 `connect_host`。通过标题匹配条目。                  |
| `doppler`            | 服务令牌                   | 只读；写入需要 Doppler CLI。                             |
| `local-file`         | AES-256-GCM                | 密钥来自文件（0600）或环境变量。用于本地开发。            |

## 安全模型

- 正常操作期间秘密从不接触磁盘。（除非你选择使用 localstore 存储所有环境变量）
- 我们仅提供 `set --prompt` 和 `set --file` 避免将秘密保存到 shell 历史。
- `env` 和 `get` 输出默认隐藏值

## 贡献

欢迎贡献和报告错误——如果发现错误请提交 issue 或 PR。

## 许可证

根据 Apache 许可证 2.0 版本授权。详情见 [LICENSE](./LICENSE)。


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2026-01-21

---