<p align="center">
  <img src="https://raw.githubusercontent.com/BinSquare/envmap/main/./logo.svg" alt="envmap ロゴ" width="280">
</p>

<p align="center">
  <a href="https://github.com/binsquare/envmap/stargazers">
    <img src="https://img.shields.io/github/stars/binsquare/envmap?style=social" alt="GitHub スター数">
  </a>
  <a href="https://github.com/binsquare/envmap/actions/workflows/release.yml">
    <img src="https://img.shields.io/github/actions/workflow/status/binsquare/envmap/release.yml?branch=main&event=push&label=release" alt="リリースワークフローの状態">
  </a>
  <a href="https://pkg.go.dev/github.com/binsquare/envmap">
    <img src="https://pkg.go.dev/badge/github.com/binsquare/envmap" alt="Go pkg リファレンス">
  </a>
  <a href="https://goreportcard.com/report/github.com/binsquare/envmap">
    <img src="https://goreportcard.com/badge/github.com/binsquare/envmap" alt="Go レポートカード">
  </a>
  <a href="https://github.com/binsquare/envmap/blob/main/LICENSE">
    <img src="https://img.shields.io/github/license/binsquare/envmap" alt="ライセンス: Apache-2.0">
  </a>
</p>

# envmap

`envmap` は、以下を支援するローカル環境変数マネージャーです:

1.  プロジェクトごとにローカル環境変数をリモートのシークレットストアと同期させる。
2.  `.env` ファイルを一時的なアーティファクトとし、シークレットプロバイダーを真の情報源として保持する。すなわち、"envmap --sync" で新しく更新された `.env` ファイルを生成する。
3.  各キーに関するメタデータを保持し、ルーチンローテーションのためにキーが最後に変更・作成された日時を通知。
4.  平文の `.env` ファイルにシークレットを保存し続ける必要がないため、セキュリティが向上する可能性がある。
5.  完全にローカルで動作し、監査のためにオープンソースで提供。

### 対象ユーザー

- `.env.prod`, `.env.dev`, `.env.staging` のような複数の `.env` バリアントを扱うエンジニア。このツールは単一コマンドで環境を統合・切り替えるのに役立ちます。以下はそのワークフローの例です: 

```
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ ./envmap sync --env prod
Wrote .env (1 secrets)
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ cat .env
# generated by envmap sync 2025-12-01T07:49:20Z
testkey=apishofih123
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ ./envmap sync --env dev
Wrote .env (1 secrets)
(base) binsquare@mac.lan:~/Documents/envMap (main*) $ cat .env
# generated by envmap sync 2025-12-01T07:50:07Z
testkey=test123
```
- 多数の環境変数を扱うエンジニアは、メタデータを確保することで開発速度を向上させる管理ツールを求めています  
- 複数プロジェクトを横断して作業するエンジニアは、環境変数をグローバルに統合・追跡したいと考えています  

## インストール

### オプション1: Goツールチェーン


```sh
go install github.com/binsquare/envmap@latest
```

### オプション2: 事前構築済みバイナリ（bash）

```sh
# install into /usr/local/bin (requires sudo)
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz" \
  | sudo tar -xz -C /usr/local/bin envmap

# or install into ~/.local/bin (no sudo; ensure it's on PATH)
mkdir -p ~/.local/bin
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz" \
  | tar -xz -C ~/.local/bin envmap

# (optional) verify checksum (adjust path if using ~/.local/bin)
curl -sSfL "https://github.com/binsquare/envmap/releases/latest/download/envmap_$(uname -s)_$(uname -m).tar.gz.sha256" \
  | sha256sum --check -
```

`~/.local/bin` オプションを使用する場合は、シェルがそれを読み込むようにしてください（ほとんどの最新のシェルはすでに読み込みます。そうでない場合は、`export PATH="$HOME/.local/bin:$PATH"` をプロファイルに追加してください）。

シェルを再起動するか（またはプロファイルをリロードして） `envmap --help` を実行し、確認してください。

## クイックスタート（ローカルプロバイダー）

```sh
# 1. Generate encryption key (writes to ~/.envmap/key)
envmap keygen

# 2. Configure global provider (wizard; runs keygen if needed)
envmap init --global

# 3. Create project config (wizard)
envmap init

# 4. Add secrets
envmap set --env dev DATABASE_URL --prompt
envmap set --env dev STRIPE_KEY --prompt

# 5. Inspect/export/run
envmap get --env dev --all
eval $(envmap export --env dev)
envmap run --env dev -- npm start
```

ウィザードを推奨しますが、手動設定もサポートされています。絶対パスを使用してください（Goは`~`や`${HOME}`を展開しません）。

<details>
<summary>手動設定のリファレンス</summary>

### グローバル設定（`~/.envmap/config.yaml`）

```yaml
providers:
  local-dev:
    type: local-file
    path: /Users/<you>/.envmap/secrets.db
    encryption:
      key_file: /Users/<you>/.envmap/key
```

### プロジェクト設定（`.envmap.yaml`）

```yaml
project: demo
default_env: dev
envs:
  dev:
    provider: local-dev
    prefix: demo/dev/
```

</details>

## 使用方法

- `envmap run [--env <name>] -- <command>` – シークレットを取得し、それらを環境変数として注入してコマンドを実行（ディスクには保存しません）。
- `envmap export [--env <name>] [--format plain|json]` – `eval`、direnv、またはツール向けの出力。
- `envmap get --env <name> KEY [--raw]` – 個別のシークレットを読み取る。
- `envmap get --env <name> --all [--raw] [--global]` – すべてのシークレットを一覧表示（デフォルトでマスクされます）；`--global` はすべての環境を繰り返します。
- `envmap set --env <name> KEY (--prompt | --file PATH)` – シェル履歴に残らずシークレットを書き込み/更新。
- `envmap import PATH --env <name> [--delete]` – 既存の `.env` ファイルを取り込む。
- `envmap sync --env <name> [--out .env] [--merge] [--keep-local] [--force] [--backup=false]` – プロバイダのシークレットから .env ファイルを書き出す。デフォルトはプロバイダ優先；`--merge` はローカル専用のキーを保持；`--keep-local` は衝突時にローカル値を保持；`--backup` は最初に .bak を書き出す。
- `envmap sync --env <name> --check` – 書き込みなしでプロバイダと .env の差分を報告。
- `envmap keygen [-o PATH]` – ローカルプロバイダ用の256ビットキーを作成。
- `envmap validate` – `.envmap.yaml` とグローバル設定が定義されたプロバイダを参照していることを確認。
- `envmap init` / `envmap init --global` – 対話形式のプロジェクト/グローバル設定。

### direnv と併用する場合

```sh
# .envrc
eval "$(envmap export --env dev)"
```

次に `direnv allow` を実行します。ディレクトリに入るたびに、direnv は `envmap export` を再実行し、ディスクに触れることなくシェルに新しいシークレットを設定します。

## 設定

### グローバル設定 (`~/.envmap/config.yaml`)

```yaml
providers:
  aws-dev:
    type: aws-ssm
    region: us-west-2
    profile: dev # optional, uses default credential chain

  vault-prod:
    type: vault
    address: https://vault.internal:8200
    mount: secret # default: secret

  local:
    type: local-file
    path: ~/.envmap/secrets.db
    encryption:
      key_file: ~/.envmap/key # must be chmod 600
      # or: key_env: ENVMAP_KEY
```

### プロジェクト設定（`.envmap.yaml`）

```yaml
project: myapp
default_env: dev

envs:
  dev:
    provider: aws-dev
    path_prefix: /myapp/dev/

  staging:
    provider: aws-dev
    path_prefix: /myapp/staging/

  local:
    provider: local
    prefix: myapp/
```

## ビルトインプロバイダー（作業中）

| タイプ               | 認証                       | 備考                                                     |
| -------------------- | -------------------------- | ------------------------------------------------------- |
| `aws-ssm`            | IAM（プロファイル/環境/インスタンス） | `path_prefix`が必要。SecureStringを使用。                |
| `aws-secretsmanager` | IAM                        | 完全なシークレット名。JSONシークレットは`name/key`に展開。 |
| `gcp-secretmanager`  | ADCまたはサービスアカウント | 最新バージョンを読み取る。書き込み時にバージョンを追加。    |
| `vault`              | トークン（環境/設定）       | KV v2。マウントパスと名前空間を設定可能。                 |
| `onepassword`        | Connectサーバー            | `connect_host`が必要。タイトルでアイテムをマッチ。         |
| `doppler`            | サービストークン            | 読み取り専用。書き込みにはDoppler CLIが必要。             |
| `local-file`         | AES-256-GCM                | ファイル（0600）または環境変数からキーを取得。ローカル開発向け。 |

## セキュリティモデル

- シークレットは通常の操作中にディスクに触れません。（すべての環境変数を保存するためにlocalstoreを使用する場合を除く）
- `set --prompt` と `set --file` のみを使用し、シークレットがシェル履歴に保存されるのを避けます。
- `env` と `get` の出力ではデフォルトで値がマスクされます。

## コントリビューション

バグ報告やコントリビューションを歓迎します—バグを見つけたらIssueを開くかPRを提出してください。

## ライセンス

Apache License Version 2.0の下でライセンスされています。詳細は[LICENSE](./LICENSE)をご覧ください。


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2026-01-21

---