# ComfyUI-MagCache

## ğŸ«– ã¯ã˜ã‚ã«  
Magnitude-aware Cacheï¼ˆMagCacheï¼‰ã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸è¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ‰‹æ³•ã§ã™ã€‚å …ç‰¢ãª**å¤§ãã•ã®è¦³æ¸¬å€¤**ã«åŸºã¥ã„ã¦æ™‚åˆ»ã‚¹ãƒ†ãƒƒãƒ—é–“ã®ãƒ¢ãƒ‡ãƒ«å‡ºåŠ›ã®å¤‰å‹•å·®ã‚’æ¨å®šã—ã€èª¤å·®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ©Ÿæ§‹ã¨é©å¿œçš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’ç”¨ã„ã¦æ¨è«–ã‚’åŠ é€Ÿã—ã¾ã™ã€‚MagCacheã¯ãƒ“ãƒ‡ã‚ªæ‹¡æ•£ãƒ¢ãƒ‡ãƒ«ã‚„ç”»åƒæ‹¡æ•£ãƒ¢ãƒ‡ãƒ«ã§åŠ¹æœçš„ã«å‹•ä½œã—ã¾ã™ã€‚è©³ç´°ã‚„çµæœã«ã¤ã„ã¦ã¯ã€[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒšãƒ¼ã‚¸](https://zehong-ma.github.io/MagCache)ãŠã‚ˆã³[ã‚³ãƒ¼ãƒ‰](https://github.com/Zehong-Ma/MagCache)ã‚’ã”è¦§ãã ã•ã„ã€‚

MagCacheã¯ç¾åœ¨ComfyUIã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ComfyUIãƒã‚¤ãƒ†ã‚£ãƒ–ãƒãƒ¼ãƒ‰ã¨äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚ComfyUI-MagCacheã¯ä½¿ã„ã‚„ã™ãã€MagCacheãƒãƒ¼ãƒ‰ã‚’ComfyUIãƒã‚¤ãƒ†ã‚£ãƒ–ãƒãƒ¼ãƒ‰ã«æ¥ç¶šã™ã‚‹ã ã‘ã§ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

## ğŸ”¥ æœ€æ–°æƒ…å ±  
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ°—ã«å…¥ã£ãŸã‚‰ã€æœ€æ–°æƒ…å ±ã‚’å¾—ã‚‹ãŸã‚ã«GitHubã§ã‚¹ã‚¿ãƒ¼â­ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚**
- [2025/6/30] ğŸ”¥ [Flux-Kontext](https://huggingface.co/black-forest-labs/FLUX.1-Kontext-dev)ã‚’2å€é€Ÿã§ã‚µãƒãƒ¼ãƒˆã€‚ãƒ‡ãƒ¢ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ [here](https://github.com/user-attachments/assets/79d5f654-5828-442d-b1a1-9b754c17e457)ã€‚
- [2025/6/19] ğŸ”¥ [FramePack](https://github.com/lllyasviel/FramePack)ã‚’Gradioãƒ‡ãƒ¢ä»˜ãã§[MagCache-FramePack](https://github.com/Zehong-Ma/MagCache)ã«ã¦ã‚µãƒãƒ¼ãƒˆã€‚
- [2025/6/18] ğŸ‘‰ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã‚’å‹Ÿé›†ä¸­ã€‚<br> ğŸ‘‰**è¨­å®šã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€ã“ã®[ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³issue](https://github.com/Zehong-Ma/ComfyUI-MagCache/issues/15)ã‚’é–‹ã„ã¦ãã ã•ã„ï¼**
- [2025/6/17] ğŸ”¥ [Wan2.1-VACE-1.3B](https://github.com/ali-vilab/VACE)ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€1.7å€ã®åŠ é€Ÿã‚’é”æˆã€‚
- [2025/6/17] ğŸ”¥ MagCacheã¯[ComfyUI-WanVideoWrapper](https://github.com/kijai/ComfyUI-WanVideoWrapper)ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚@[kijai](https://github.com/kijai)ã«æ„Ÿè¬ã€‚
- [2025/6/16] ğŸ”¥ [Chroma](https://huggingface.co/lodestones/Chroma)ã‚’ã‚µãƒãƒ¼ãƒˆã€‚ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æä¾›ã«@[kabachuha](https://github.com/kabachuha)ã«æ„Ÿè¬ã€‚
- [2025/6/10] ğŸ”¥ [Wan2.1](https://github.com/Wan-Video/Wan2.1) T2Vï¼†I2Vã€[HunyuanVideo](https://github.com/Tencent/HunyuanVideo) T2Vã€[FLUX-dev](https://github.com/black-forest-labs/flux) T2Iã‚’ã‚µãƒãƒ¼ãƒˆã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
<!-- ComfyUI-Managerã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚ãƒãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã§ComfyUI-MagCacheã‚’æ¤œç´¢ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚ -->
### æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
1. comfyUIã®custom_nodesãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã€`ComfyUI/custom_nodes/`
2. git clone https://github.com/zehong-ma/ComfyUI-MagCache.git
3. ComfyUI-MagCacheãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã€`cd ComfyUI-MagCache/`
4. pip install -r requirements.txt
5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ `ComfyUI/` ã«ç§»å‹•ã—ã€`python main.py`ã‚’å®Ÿè¡Œ

## ä½¿ã„æ–¹

### ãƒ¢ãƒ‡ãƒ«ã‚¦ã‚§ã‚¤ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
ã¾ãšã¯ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ComfyUIå½¢å¼ã®ãƒ¢ãƒ‡ãƒ«ã‚¦ã‚§ã‚¤ãƒˆã‚’æº–å‚™ã—ã¦ãã ã•ã„ï¼š
- [Wan2.1](https://comfyanonymous.github.io/ComfyUI_examples/wan/)
- [HunyuanVideo](https://comfyanonymous.github.io/ComfyUI_examples/hunyuan_video/)
- [FLUX](https://comfyanonymous.github.io/ComfyUI_examples/flux/)
- [Chroma](https://huggingface.co/lodestones/Chroma)

### MagCache

**ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã‚’å‹Ÿé›†ä¸­ã§ã™ã€‚ã“ã®[ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³issue](https://github.com/Zehong-Ma/ComfyUI-MagCache/issues/15)ã‚’é–‹ã„ã¦è¨­å®šã‚’å…±æœ‰ã—ã¦ãã ã•ã„ï¼**

MagCacheãƒãƒ¼ãƒ‰ã‚’ä½¿ã†ã«ã¯ã€`Load Diffusion Model`ãƒãƒ¼ãƒ‰ã¾ãŸã¯LoRAãŒå¿…è¦ãªå ´åˆã¯`Load LoRA`ãƒãƒ¼ãƒ‰ã®å¾Œã«`MagCache`ãƒãƒ¼ãƒ‰ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚ä¸€èˆ¬çš„ã«ã€MagCacheã¯è¦–è¦šçš„å“è³ªã®è¨±å®¹ç¯„å›²å†…ã§2å€ã‹ã‚‰3å€ã®é€Ÿåº¦å‘ä¸Šã‚’å®Ÿç¾ã—ã¾ã™ã€‚ä»¥ä¸‹ã®è¡¨ã¯å„ãƒ¢ãƒ‡ãƒ«ã«æ¨å¥¨ã•ã‚Œã‚‹magcache_threshã€retention_ratioã€ãŠã‚ˆã³magcache_Kã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š

<div align="center">

| ãƒ¢ãƒ‡ãƒ«                       |   magcache_thresh |   retention_ratio |    magcache_K     |  
|:----------------------------:|:-----------------:|:-----------------:|:-----------------:|
| FLUX                         |        0.24       |         0.1       |         5         |
| FLUX-Kontext                 |        0.05       |         0.2       |         4         |
| Chroma                       |        0.10       |         0.25      |         2         |
| HunyuanVideo-T2V             |        0.24       |         0.2       |         6         |
| Wan2.1-T2V-1.3B              |        0.12       |         0.2       |         4         |
| Wan2.1-T2V-14B               |        0.24       |         0.2       |         6         |
| Wan2.1-I2V-480P-14B          |        0.24       |         0.2       |         6         |
| Wan2.1-I2V-720P-14B          |        0.24       |         0.2       |         6         |
| Wan2.1-VACE-1.3B             |        0.02       |         0.2       |         3         |

</div>

**MagCacheé©ç”¨å¾Œã®ç”»åƒã‚„ãƒ“ãƒ‡ã‚ªã®å“è³ªãŒä½ã„å ´åˆã¯ã€`magcache_thresh`ã¨`magcache_K`ã‚’æ¸›ã‚‰ã—ã¦ãã ã•ã„ã€‚** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯éå¸¸ã«é«˜é€Ÿï¼ˆ2å€ã€œ3å€ï¼‰æ¨è«–å‘ã‘ã«è¨­å®šã•ã‚Œã¦ãŠã‚Šã€å ´åˆã«ã‚ˆã£ã¦ã¯å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ‡ãƒ¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆ[flux](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/flux.json)ã€[flux-kontext](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/flux_1_kontext_dev.json)ã€[chroma](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/chroma.json)ã€[hunyuanvideo](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/hunyuanvideo.json)ã€[wan2.1_t2v](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/wan2.1_t2v.json)ã€[wan2.1_i2v](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/wan2.1_i2v.json)ã€[wan2.1_vace](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/wan2.1_vace.json)ï¼‰ã¯examplesãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼[chroma_calibration](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./examples/chroma_calibration.json)ã¯ã€æ¨è«–ã‚¹ãƒ†ãƒƒãƒ—æ•°ãŒäº‹å‰å®šç¾©å€¤ã¨ç•°ãªã‚‹å ´åˆã«`mag_ratios`ã‚’è¼ƒæ­£ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚  
**å®Ÿé¨“ã§ã¯ã€Wan2.1ã§ç”Ÿæˆã•ã‚ŒãŸå‹•ç”»ã¯[å…ƒã®éé‡å­åŒ–ç‰ˆ](https://github.com/Wan-Video/Wan2.1)ã«æ¯”ã¹ã¦é«˜å“è³ªã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚**

### ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
Compile Modelãƒãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€`Load Diffusion Model`ãƒãƒ¼ãƒ‰ã¾ãŸã¯`MagCache`ãƒãƒ¼ãƒ‰ã®å¾Œã«`Compile Model`ãƒãƒ¼ãƒ‰ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚Compile Modelã¯`torch.compile`ã‚’ç”¨ã„ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ã‚ˆã‚ŠåŠ¹ç‡çš„ãªä¸­é–“è¡¨ç¾ï¼ˆIRï¼‰ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’æ´»ç”¨ã—ã¦æœ€é©åŒ–ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã‚’å¼·åŒ–ã—ã¾ã™ã€‚ã“ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯åˆå›å®Ÿè¡Œæ™‚ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€ä¸€åº¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹ã¨æ¨è«–ã¯éå¸¸ã«é«˜é€Ÿã«ãªã‚Šã¾ã™ã€‚  
<!-- ä½¿ç”¨ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š -->
<!-- ![](https://raw.githubusercontent.com/Zehong-Ma/ComfyUI-MagCache/main/./assets/compile.png) -->

## è¬è¾
[ComfyUI-TeaCache](https://github.com/welltop-cn/ComfyUI-TeaCache)ã€[ComfyUI](https://github.com/comfyanonymous/ComfyUI)ã€[ComfyUI-MagCache](https://github.com/wildminder/ComfyUI-MagCache)ã€[MagCache](https://github.com/Zehong-Ma/MagCache/)ã€[TeaCache](https://github.com/ali-vilab/TeaCache)ã€[HunyuanVideo](https://github.com/Tencent/HunyuanVideo)ã€[FLUX](https://github.com/black-forest-labs/flux)ã€[Chroma](https://huggingface.co/lodestones/Chroma)ã€ãŠã‚ˆã³[Wan2.1](https://github.com/Wan-Video/Wan2.1)ã«æ„Ÿè¬ã—ã¾ã™ã€‚


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-07-18

---