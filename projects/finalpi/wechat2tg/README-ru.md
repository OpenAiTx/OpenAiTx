# wechat2tg-mac

На основе протокола WeChat Mac для отправки и получения сообщений WeChat в Telegram, сервер wx2tg-server не является открытым из соображений безопасности

## TG-группа: [@Wx2TgUserGroup](https://t.me/+AD02MEZa-og3ZGY1)

## Основные функции

1. Приём сообщений личных чатов WeChat, групповых чатов, официальных аккаунтов, а также сообщений WeCom
2. Отправка сообщений из Telegram выбранному пользователю WeChat, группам или официальным аккаунтам
3. Блокировка сообщений от указанных групп

## Поддерживаемые типы сообщений

### Список поддерживаемых типов сообщений WeChat

+ [x] Текстовые сообщения
+ [x] Сообщения WeCom
+ [x] Стикеры WeChat
+ [x] Изображения
+ [x] Видеосообщения
+ [x] Аудио/видеозвонки (только уведомления)
+ [x] Файлы
+ [x] Ссылки
+ [x] Групповые чаты
+ [x] Упоминания в группах (@все и @вы конвертируются в Telegram @вы)
+ [x] Сообщения официальных аккаунтов
+ [x] emoji
+ [x] Сообщения о местоположении
+ [x] Отозванные сообщения
+ [x] Голосовые сообщения
+ [ ] Сообщения-красные конверты (только уведомление, содержимое получить невозможно)
+ [ ] Сообщения мини-программ

### Список поддерживаемых типов сообщений Telegram

+ [x] Текстовые сообщения
+ [x] Стикеры
+ [x] Изображения
+ [x] Видеосообщения
+ [x] Файлы
+ [x] Голосовые сообщения

## Важно

1. Этот проект предназначен только для технических исследований и обучения, запрещено использовать в незаконных целях
2. По любым вопросам приветствуется создание issue

## Установка и развертывание

Сначала скопируйте `.env.example` в `.env`, затем настройте переменные окружения в `.env`

Скопируйте `app.conf.example` из проекта в файл `app.conf` в директории `conf`, укажите адрес вашего Redis

### docker-compose

Создайте файл `docker-compose.yml`:

```yaml
version: '3'

services:
  wx2tg-mac:
    image: finalpi/wechat2tg-mac:latest
    container_name: wx2tg-mac
    volumes:
      - ./config:/app/storage
      - ./save-files:/app/save-files # После монтирования папки сохранения стикеры не требуют повторной конвертации
    env_file: ".env"
    restart: unless-stopped

  wx2tg-server:
    image: finalpi/wx2tg-server:latest # Получить образ
    container_name: wx2tg-server
    ports:
      - "8058:8058"
    volumes:
      - ./conf:/usr/wic-go/conf
    restart: unless-stopped

  wx2tg-redis:
    image: redis:7.2
    container_name: wx2tg-redis
    ports:
      - "16379:6379"
    volumes:
      - ./redis-data:/data
    command: ["redis-server", "--appendonly", "yes"]
    restart: unless-stopped
```

#### Запуск

```shell
docker-compose up -d
```

#### Отключить режим приватности бота

Отключите режим приватности бота: откройте BotFather, введите `/mybots`, выберите вашего бота. Перейдите в `Bot Settings` - `Group Privacy` - `Turn off`. Появится сообщение `Privacy mode is disabled for xxx`, что означает успешное отключение.

## Инструкция по использованию

### Команды BOT

- `/login`: Получить QR-код для входа; первый, кто отправит команду `/login` после запуска, становится владельцем BOT

- `/flogin`: Получить QR-код для входа для File Transfer Assistant, поддерживает получение видео и файлов

- `/update`: Обновить аватар и информацию о никнеймах групп

- `/message`: Включить/выключить получение сообщений из групп

- `/forward`: Включить/выключить пересылку сообщений других пользователей или бота внутри группы

- `/user`: Получить список пользователей WeChat; после нажатия можно создать новую группу или привязать пользователя (поиск по имени или заметке, например: `/user 张` ищет пользователей с именем или заметкой, содержащей «张»)

- `/room`: Получить список групп WeChat; после нажатия можно создать новую группу или привязать группу WeChat (поиск по имени или заметке, например: `/room 外卖` ищет группы с названием или заметкой, содержащей «外卖»)

- `/settings`: Настройки программы

- `/unbind`: Отвязать группу WeChat или пользователя WeChat (доступно только в группе)

### Описание переменных окружения

|Название| Обязательно | Описание                                                                 |
|--|-------------|--------------------------------------------------------------------------|
|`BOT_TOKEN`| Да          | Токен Telegram Bot, создаётся через [BotFather](https://t.me/BotFather) |
|`API_ID`| Да          | API ID Telegram API                                                     |
|`API_HASH`| Да          | API HASH Telegram API                                                   |
|`BASE_API`| Да          | Адрес API для контейнера wx2tg-server, требуется полный путь            |
|`PROXY_PROTOCOL`| Нет         | Тип прокси (socks5, http, https)                                         |
|`PROXY_HOST`| Нет         | URL прокси                                                             |
|`PROXY_PORT`| Нет         | Порт прокси                                                            |
|`PROXY_USERNAME`| Нет         | Имя пользователя прокси                                               |
|`PROXY_PASSWORD`| Нет         | Пароль прокси                                                         |
|`ROOM_MESSAGE`| Нет         | Формат отображения сообщений групп WeChat в BOT                        |
|`OFFICIAL_MESSAGE`| Нет         | Формат отображения сообщений официальных аккаунтов в BOT              |
|`CONTACT_MESSAGE`| Нет         | Формат отображения сообщений пользователей WeChat в BOT               |
|`ROOM_MESSAGE_GROUP`| Нет         | Формат отображения сообщений групп WeChat в группах                   |
|`CONTACT_MESSAGE_GROUP`| Нет         | Формат отображения сообщений пользователей WeChat в группах              |
|`OFFICIAL_MESSAGE_GROUP`| Нет         | Формат отображения сообщений официальных аккаунтов в группах            |
|`CREATE_ROOM_NAME`| Нет         | Формат названия группы при автоматическом создании группы WeChat         |
|`CREATE_CONTACT_NAME`| Нет         | Формат названия группы при автоматическом создании контакта WeChat      |
|`MESSAGE_DISPLAY`| Нет         | Формат отображения текстовых сообщений                                   |

---

### Описание опций команды `/settings`

1. Показывать emoji WeChat как ссылки на изображения: если включено, стикеры-эмодзи от друзей будут отображаться как ссылки на изображения

1. Синхронизировать информацию о группах при запуске: если включено, при запуске программы будет синхронизирована информация обо всех пользователях, обновятся аватары и имена групп

---

### Преобразование голоса в текст

1. Настройте `TENCENT_SECRET_ID` и `TENCENT_SECRET_KEY` в [консоли распознавания речи Tencent](https://console.cloud.tencent.com/asr). Доступен бесплатный лимит
2. Включите автоматическое преобразование голоса в текст в `/settings`

---

### Получение `API_ID` и `API_HASH`

1. Войдите в [telegram account](https://my.telegram.org/)

2. Кликните «API development tools» и заполните информацию о приложении (требуются только название и короткое имя)

3. Нажмите «Create application»

---

### Кастомизация шаблонов сообщений

Если вы хотите изменить формат отправителя сообщения, вы можете изменить переменные окружения в docker или в файле `.env`

Переменные для кастомизации шаблонов сообщений:

`#[alias]`: заметка контакта

`#[name]`: никнейм контакта

`#[topic]`: имя группового чата

`#[alias_first]`: заметка в приоритете, если её нет — никнейм контакта

`#[identity]`: текст идентификации

`#[body]`: текст сообщения

`#[br]`: перенос строки

### Как @всех

Отправьте сообщение, начинающееся с `@all`, чтобы упомянуть всех. Только для текстовых сообщений.

---

## Часто задаваемые вопросы


## Участие в разработке

1. Сделайте fork проекта, переключитесь на ветку `wx2tg-mac-dev` или создайте новую. Не отправляйте код напрямую в основную ветку
2. Создайте Pull Request в ветку `wx2tg-mac-dev`


## License

[MIT](LICENSE)


## Thanks

Благодарим Jetbrains за поддержку проекта

[<img src="https://resources.jetbrains.com/storage/products/company/brand/logos/jetbrains.png" width="200">](https://www.jetbrains.com)

---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2025-06-07

---