<div align="right">
  <details>
    <summary >ЁЯМР ржнрж╛рж╖рж╛</summary>
    <div>
      <div align="center">
        <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=en">ржЗржВрз░рж╛ржЬрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=zh-CN">рж╕рж╣ржЬ ржЪрзАржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=zh-TW">ржкрз░ржорзНржкрз░рж╛ржЧржд ржЪрзАржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=ja">ржЬрж╛ржкрж╛ржирзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=ko">ржХрзЛрз░рж┐рзЯрж╛ржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=hi">рж╣рж┐ржирзНржжрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=th">ржерж╛ржЗ</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=fr">ржлрз░рж╛ржЫрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=de">ржЬрж╛рз░рзНржорж╛ржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=es">рж╕рзНржкрзЗржирж┐ржЫ</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=it">ржЗржЯрж╛рж▓рж┐рзЯрж╛ржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=ru">рз░рж╛ржЫрж┐рзЯрж╛ржи</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=pt">ржкрз░рзНрждрзБржЧрзАржЬ</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=nl">ржбрж╛ржЪ</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=pl">ржкрзЛрж▓рж┐ржЪ</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=ar">ржЖрз░ржмрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=fa">ржлрж╛рз░рзНржЫрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=tr">рждрзБрз░рзНржХрзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=vi">ржнрж┐рзЯрзЗржЯржирж╛ржорзА</a>
        | <a href="https://openaitx.github.io/view.html?user=miquel-espinosa&project=no-time-to-train&lang=id">ржЗржгрзНржбрзЛржирзЗржЫрж┐рзЯрж╛ржи</a>
      </div>
    </div>
  </details>
</div>

<div align="center">

# ЁЯЪА ржкрзНрз░рж╢рж┐ржХрзНрж╖ржгрз░ рж╕ржорзЯ ржирж╛ржЗ!  
### ржкрзНрз░рж╢рж┐ржХрзНрж╖ржг-ржорзБржХрзНржд рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ-ржнрж┐рждрзНрждрж┐ржХ ржЗржирж╖рзНржЯрзЗржирзНрж╕ ржЫрзЗржЧржорзЗржгрзНржЯрзЗржЪржи  
[![GitHub](https://img.shields.io/badge/%E2%80%8B-No%20Time%20To%20Train-black?logo=github)](https://github.com/miquel-espinosa/no-time-to-train)
[![Website](https://img.shields.io/badge/ЁЯМР-Project%20Page-grey)](https://miquel-espinosa.github.io/no-time-to-train/)
[![arXiv](https://img.shields.io/badge/arXiv-2507.02798-b31b1b)](https://arxiv.org/abs/2507.02798)

**ржЕрждрзНржпрж╛ржзрзБржирж┐ржХ (Papers with Code)**

[**_SOTA 1-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-1-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/badge/State%20of%20the%20Art-Few--Shot%20Object%20Detection%20on%20MS--COCO%20(1--shot)-21CBCE?style=flat&logo=paperswithcode)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-1-shot?p=no-time-to-train-training-free-reference)

[**_SOTA 10-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-10-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/badge/State%20of%20the%20Art-Few--Shot%20Object%20Detection%20on%20MS--COCO%20(10--shot)-21CBCE?style=flat&logo=paperswithcode)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-10-shot?p=no-time-to-train-training-free-reference)

[**_SOTA 30-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-30-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/badge/State%20of%20the%20Art-Few--Shot%20Object%20Detection%20on%20MS--COCO%20(30--shot)-21CBCE?style=flat&logo=paperswithcode)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-30-shot?p=no-time-to-train-training-free-reference)

<!-- [**_SOTA 1-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-1-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/endpoint.svg?url=https://paperswithcode.com/badge/no-time-to-train-training-free-reference/few-shot-object-detection-on-ms-coco-1-shot)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-1-shot?p=no-time-to-train-training-free-reference)

[**_SOTA 10-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-10-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/endpoint.svg?url=https://paperswithcode.com/badge/no-time-to-train-training-free-reference/few-shot-object-detection-on-ms-coco-10-shot)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-10-shot?p=no-time-to-train-training-free-reference)

[**_SOTA 30-shot_**](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-30-shot?p=no-time-to-train-training-free-reference) | [![PWC](https://img.shields.io/endpoint.svg?url=https://paperswithcode.com/badge/no-time-to-train-training-free-reference/few-shot-object-detection-on-ms-coco-30-shot)](https://paperswithcode.com/sota/few-shot-object-detection-on-ms-coco-30-shot?p=no-time-to-train-training-free-reference) -->

</div>

---

> ЁЯЪи **ржЖржкржбрзЗржЯ (рзирзи ржЬрзБрж▓рж╛ржЗ рзирзжрзирзл):** ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛рж╕рзЗржЯрз░ ржирж┐рз░рзНржжрзЗрж╢ржирж╛ ржпрзЛржЧ ржХрз░рж╛ рж╣рзИржЫрзЗ!
> 
> ЁЯФФ **ржЖржкржбрзЗржЯ (рззрзм ржЬрзБрж▓рж╛ржЗ рзирзжрзирзл):** ржХрзЛржбржЯрзЛ ржирж┐рз░рзНржжрзЗрж╢ржирж╛рж╕рж╣ ржЖржкржбрзЗржЯ ржХрз░рж╛ рж╣рзИржЫрзЗ!

---

## ЁЯУЛ рж╕рзВржЪрзАржкрждрзНрз░

- [ЁЯОп ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп](#-highlights)
- [ЁЯУЬ рж╕ржВржХрзНрж╖рзЗржк](#-abstract)
- [ЁЯза рж╕рзНржерж╛ржкрждрзНржп](#-architecture)
- [ЁЯЫая╕П ржЗржирж╖рзНржЯрж▓рзЗрж╢рзНржпржи ржирж┐рз░рзНржжрзЗрж╢ржирж╛](#я╕П-installation-instructions)
  - [1. рз░рж┐ржк'ржЬрж┐ржЯ'рз░рзА ржХрзНрж▓рзЛржи ржХрз░ржХ](#1-clone-the-repository)
  - [2. ржХржгрзНржбрж╛ ржкрз░рж┐рз▒рзЗрж╢ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХ](#2-create-conda-environment)
  - [3. SAM2 ржЖрз░рзБ DinoV2 ржЗржирж╖рзНржЯрж▓ ржХрз░ржХ](#3-install-sam2-and-dinov2)
  - [4. ржбрзЗржЯрж╛рж╕рзЗржЯрж╕ржорзВрж╣ ржбрж╛ржЙржирж▓рзЛржб ржХрз░ржХ](#4-download-datasets)
  - [5. SAM2 ржЖрз░рзБ DinoV2 ржЪрзЗржХржкржЗржгрзНржЯ ржбрж╛ржЙржирж▓рзЛржб ржХрз░ржХ](#5-download-sam2-and-dinov2-checkpoints)
- [ЁЯУК ржЗржиржлрж╛рз░рзЗржирзНрж╕ ржХрзЛржб: Few-shot COCO-ржд рзйрзж-shot SOTA ржлрж▓рж╛ржлрж▓ ржкрзБржирз░рзБрзОржкрж╛ржжржи ржХрз░ржХ](#-inference-code)
  - [0. рз░рзЗржлрж╛рз░рзЗржирзНрж╕ ржЫрзЗржЯ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХ](#0-create-reference-set)
  - [1. рз░рзЗржлрж╛рз░рзЗржирзНрж╕рзЗрз░рзЗ ржорзЗржо'рз░рж┐ ржкрзВрз░рзНржг ржХрз░ржХ](#1-fill-memory-with-references)
  - [2. ржорзЗржо'рз░рж┐ ржмрзЗржВржХ ржк'рж╖рзНржЯ-ржкрзНрз░ржЪрзЗржЫ ржХрз░ржХ](#2-post-process-memory-bank)
  - [3. рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░рж╕ржорзВрж╣ржд ржЗржиржлрж╛рз░рзЗржирзНрж╕ ржХрз░ржХ](#3-inference-on-target-images)
  - [ржлрж▓рж╛ржлрж▓](#results)

- [ЁЯФН ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛рж╕рзЗржЯ](#-custom-dataset)
  - [0. ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛рж╕рзЗржЯ ржкрзНрз░рж╕рзНрждрзБржд ржХрз░ржХ тЫ╡ЁЯРж](#0-prepare-a-custom-dataset)
  - [0.1 ржХрзЗрз▒рж▓ bbox ржПржирзЛржЯрзЗрж╢рзНржмржи ржЙржкрж▓ржмрзНржз ржерж╛ржХрж┐рж▓рзЗ](#01-if-only-bbox-annotations-are-available)
  - [0.2 coco ржПржирзЛржЯрзЗрж╢рзНржмржи pickle ржлрж╛ржЗрж▓рж▓рзИ рз░рзВржкрж╛ржирзНрждрз░ ржХрз░ржХ](#02-convert-coco-annotations-to-pickle-file)
  - [1. ржорзЗржо'рз░рзАржд references ржнрз░рзНрждрж┐ ржХрз░ржХ](#1-fill-memory-with-references)
  - [2. ржорзЗржо'рз░рж┐ ржмрзЗржВржХ post-process ржХрз░ржХ](#2-post-process-memory-bank)
- [ЁЯУЪ ржЙржжрзНржзрзГрждрж┐](#-citation)


## ЁЯОп ржорзВрж▓ ржмрж┐рж╖рзЯржмрж╕рзНрждрзБ
- ЁЯТб **ржкрзНрз░рж╢рж┐ржХрзНрж╖ржг-рз░рж╣рж┐ржд**: ржкрзБржиржГ-ржкрзНрз░рж╢рж┐ржХрзНрж╖ржг ржирж╛ржЗ, prompt engineering ржирж╛ржЗтАФржХрзЗрз▒рж▓ ржПржЯрж╛ reference imageред  
- ЁЯЦ╝я╕П **Reference-Based**: ржХрзЗржЗржЯрж╛ржорж╛ржи ржЙржжрж╛рж╣рз░ржг ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐ ржирждрзБржи ржмрж╕рзНрждрзБ ржЪрзЗржЧржорзЗржгрзНржЯ ржХрз░ржХред  
- ЁЯФе **SOTA Performance**: Training-free ржкржжрзНржзрждрж┐ рж╕ржорзВрж╣рждржХрзИ COCO, PASCAL VOC, ржЖрз░рзБ Cross-Domain FSOD-ржд ржЙрзОржХрзГрж╖рзНржЯ ржлрж▓рж╛ржлрж▓ред

**рж▓рж┐ржВржХрж╕ржорзВрж╣:**
- ЁЯз╛ [**arXiv ржкрзЗржкрж╛рз░**](https://arxiv.org/abs/2507.02798)  
- ЁЯМР [**Project Website**](https://miquel-espinosa.github.io/no-time-to-train/)  
- ЁЯУИ [**Papers with Code**](https://paperswithcode.com/paper/no-time-to-train-training-free-reference)

## ЁЯУЬ ржкрзНрз░ржмржирзНржзрз░ рж╕ржВржХрзНрж╖рж┐ржкрзНрждрж╕рж╛рз░

> The performance of image segmentation models has historically been constrained by the high cost of collecting large-scale annotated data. The Segment Anything Model (SAM) alleviates this original problem through a promptable, semantics-agnostic, segmentation paradigm and yet still requires manual visual-prompts or complex domain-dependent prompt-generation rules to process a new image. Towards reducing this new burden, our work investigates the task of object segmentation when provided with, alternatively, only a small set of reference images. Our key insight is to leverage strong semantic priors, as learned by foundation models, to identify corresponding regions between a reference and a target image. We find that correspondences enable automatic generation of instance-level segmentation masks for downstream tasks and instantiate our ideas via a multi-stage, training-free method incorporating (1) memory bank construction; (2) representation aggregation and (3) semantic-aware feature matching. Our experiments show significant improvements on segmentation metrics, leading to state-of-the-art performance on COCO FSOD (36.8% nAP), PASCAL VOC Few-Shot (71.2% nAP50) and outperforming existing training-free approaches on the Cross-Domain FSOD benchmark (22.4% nAP).

![cdfsod-results-final-comic-sans-min](https://github.com/user-attachments/assets/ab302c02-c080-4042-99fc-0e181ba8abb9)


## ЁЯза Architecture

![training-free-architecture-comic-sans-min](https://github.com/user-attachments/assets/d84dd83a-505e-45a0-8ce3-98e1838017f9)


## ЁЯЫая╕П Installation instructions

### 1. Clone the repository

```bash
git clone https://github.com/miquel-espinosa/no-time-to-train.git
cd no-time-to-train
```

### 2. ржХржирзНржбрж╛ ржкрз░рж┐ржмрзЗрж╢ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХ

ржЖржорж┐рж╣ржБрждрзЗ ржкрзНрз░рзЯрзЛржЬржирзАрзЯ ржкрзЗржХрзЗржЬрж╕ржорзВрж╣рз░ рж╕рзИрждрзЗ ржПржЯрж╛ ржХржирзНржбрж╛ ржкрз░рж┐ржмрзЗрж╢ рж╕рзГрж╖рзНржЯрж┐ ржХрз░рж┐ржоред
```bash
conda env create -f environment.yml
conda activate no-time-to-train
```

### рзй. SAM2 ржЖрз░рзБ DinoV2 ржЗржирж╖рзНржЯрж▓ ржХрз░ржХ

ржЖржорж┐ ржЙрзОрж╕рз░ ржкрз░рж╛ SAM2 ржЖрз░рзБ DinoV2 ржЗржирж╖рзНржЯрж▓ ржХрз░рж┐ржоред
```bash
pip install -e .
cd dinov2
pip install -e .
cd ..
```

### рзк. ржбрзЗржЯрж╛ржЫрзЗржЯрж╕ржорзВрж╣ ржбрж╛ржЙржирж▓рзЛржб ржХрз░ржХ

ржЕржирзБржЧрзНрз░рж╣ ржХрз░рж┐ COCO ржбрзЗржЯрж╛ржЫрзЗржЯ ржбрж╛ржЙржирж▓рзЛржб ржХрз░рж┐ `data/coco` ржд рз░рж╛ржЦржХ

### рзл. SAM2 ржЖрз░рзБ DinoV2 ржЪрзЗржХржкржЗржгрзНржЯрж╕ржорзВрж╣ ржбрж╛ржЙржирж▓рзЛржб ржХрз░ржХ

ржЖржорж┐ ржХрж╛ржХрждржд ржмрзНржпрз▒рж╣рзГржд ржарж┐ржХ SAM2 ржЪрзЗржХржкржЗржгрзНржЯрж╕ржорзВрж╣ ржбрж╛ржЙржирж▓рзЛржб ржХрз░рж┐ржоред
(рждржерж╛ржкрж┐ржУ ржоржиржд рз░рж╛ржЦрж┐ржм, SAM2.1 ржЪрзЗржХржкржЗржгрзНржЯрж╕ржорзВрж╣ ржЗрждрж┐ржоржзрзНржпрзЗ ржЙржкрж▓ржмрзНржз ржЖрз░рзБ рж╕ржорзНржнрз▒ржд ржмрзЗржЫрж┐ ржнрж╛рж▓ржжрз░рзЗ ржХрж╛рз░рзНржпржХрз░рзА рж╣'ржм ржкрж╛рз░рзЗред)

```bash
mkdir -p checkpoints/dinov2
cd checkpoints
wget https://dl.fbaipublicfiles.com/segment_anything_2/072824/sam2_hiera_large.pt
cd dinov2
wget https://dl.fbaipublicfiles.com/dinov2/dinov2_vitl14/dinov2_vitl14_pretrain.pth
cd ../..
```


## ЁЯУК ржЕржирзБржорж╛ржи ржХрзЛржб

тЪая╕П рж╕рждрж░рзНржХрзАржХрз░ржг: ржПржЗржЯрзЛ ржЧрз▒рзЗрж╖ржгрж╛ ржХрзЛржб тАФ ржЕрж▓ржк ржмрж┐рж╢рзГржЩрзНржЦрж▓рж╛ ржЖрж╢рж╛ ржХрз░ржХ!

### Few-shot COCO-ржд рзйрзж-рж╢рзНржмржЯ SOTA ржлрж▓рж╛ржлрж▓ ржкрзБржирз░рзБрждрзНржкрж╛ржжржи ржХрз░рж╛

ржкрзНрз░рзЯрзЛржЬржирзАрзЯ ржнрзЗрз░рж┐рзЯрзЗржмрж▓рж╕ржорзВрж╣ рж╕ржВржЬрзНржЮрж╛ ржХрз░ржХ ржЖрз░рзБ ржлрж▓рж╛ржлрж▓рз░ ржмрж╛ржмрзЗ ржПржЯрж╛ ржлрзЛрж▓рзНржбрж╛рз░ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХ:

```bash
CONFIG=./no_time_to_train/new_exps/coco_fewshot_10shot_Sam2L.yaml
CLASS_SPLIT="few_shot_classes"
RESULTS_DIR=work_dirs/few_shot_results
SHOTS=30
SEED=33
GPUS=4

mkdir -p $RESULTS_DIR
FILENAME=few_shot_${SHOTS}shot_seed${SEED}.pkl
```

#### рзж. ржЙржжрзНржмрзГрждрзНржд ржЫрзЗржЯ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХ

```bash
python no_time_to_train/dataset/few_shot_sampling.py \
        --n-shot $SHOTS \
        --out-path ${RESULTS_DIR}/${FILENAME} \
        --seed $SEED \
        --dataset $CLASS_SPLIT
```

#### рзз. рж╕рзНржорзГрждрж┐ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪрзЗрз░рзЗ ржкрзВрз░ржг ржХрз░ржХ

```bash
python run_lightening.py test --config $CONFIG \
                              --model.test_mode fill_memory \
                              --out_path ${RESULTS_DIR}/memory.ckpt \
                              --model.init_args.model_cfg.memory_bank_cfg.length $SHOTS \
                              --model.init_args.dataset_cfgs.fill_memory.memory_pkl ${RESULTS_DIR}/${FILENAME} \
                              --model.init_args.dataset_cfgs.fill_memory.memory_length $SHOTS \
                              --model.init_args.dataset_cfgs.fill_memory.class_split $CLASS_SPLIT \
                              --trainer.logger.save_dir ${RESULTS_DIR}/ \
                              --trainer.devices $GPUS
```

#### 2. ржкрзЛрж╕рзНржЯ-ржкрзНрз░рж╕рзЗржЫ ржорзЗржо'рз░рж┐ ржмрзЗржВржХ

```bash
python run_lightening.py test --config $CONFIG \
                              --model.test_mode postprocess_memory \
                              --model.init_args.model_cfg.memory_bank_cfg.length $SHOTS \
                              --ckpt_path ${RESULTS_DIR}/memory.ckpt \
                              --out_path ${RESULTS_DIR}/memory_postprocessed.ckpt \
                              --trainer.devices 1
```

#### рзй. рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░рж╕ржорзВрж╣ржд ржЕржирзБржорж╛ржи

```bash
python run_lightening.py test --config $CONFIG  \
                              --ckpt_path ${RESULTS_DIR}/memory_postprocessed.ckpt \
                              --model.init_args.test_mode test \
                              --model.init_args.model_cfg.memory_bank_cfg.length $SHOTS \
                              --model.init_args.model_cfg.dataset_name $CLASS_SPLIT \
                              --model.init_args.dataset_cfgs.test.class_split $CLASS_SPLIT \
                              --trainer.logger.save_dir ${RESULTS_DIR}/ \
                              --trainer.devices $GPUS
```
ржпржжрж┐ ржЖржкрзБржирж┐ ржЕржирж▓рж╛ржЗржиржд ржЕржирзБржорж╛ржи ржлрж▓рж╛ржлрж▓рж╕ржорзВрж╣ (рждрзЗржУржБрж▓рзЛржХ ржЧржгржирж╛ рж╣рзЛрз▒рж╛ рж╕ржоржпрж╝ржд) ржЪрж╛ржм ржмрж┐ржЪрж╛рз░рзЗ, рждрзЗржирзНрждрзЗ ржпрзБржХрзНрждрж┐ ржпрзЛржЧ ржХрз░ржХ:

```bash
    --model.init_args.model_cfg.test.online_vis True
```
рж╕рзНржХ'рз░ ржерзНрз░рзЗрж╢рж╣'рж▓рзНржб `score_thr` ржкрз░рж╛ржорж┐рждрж┐ рж╕ржоржирзНржмржпрж╝ ржХрз░рж┐ржмрж▓рзИ, ржпрзБржХрзНрждрж┐ ржпрзЛржЧ ржХрз░ржХ (ржЙржжрж╛рж╣рз░ржгрж╕рзНржмрз░рзВржкрзЗ, рж╕ржХрж▓рзЛ ржЗржирж╖рзНржЯрзЗржирзНрж╕рз░ ржнрж┐ржЬрзБрз▒рзЗрж▓рж╛ржЗржЬрзЗрж╢рзНржпржи ржпрж╛рз░ рж╕рзНржХ'рз░ `0.4`рждржХрзИ ржмрзЗржЫрж┐):
```bash
    --model.init_args.model_cfg.test.vis_thr 0.4
```
ржПрждрж┐ржпрж╝рж╛ ржЫржмрж┐рж╕ржорзВрж╣ `results_analysis/few_shot_classes/`-ржд рж╕ржВрз░ржХрзНрж╖ржг ржХрз░рж╛ рж╣'ржмред ржмрж╛ржУржБржлрж╛рж▓рзЗ ржержХрж╛ ржЫржмрж┐ржЦржирзЗ ржЧрзНрз░рж╛ржЙржгрзНржб ржЯрзНрз░рзБрже ржжрзЗржЦрзБрз▒рж╛ржпрж╝, рж╕рзЛржБржлрж╛рж▓рзЗ ржержХрж╛ ржЫржмрж┐ржЦржирзЗ ржЖржорж╛рз░ ржкрзНрз░рж╢рж┐ржХрзНрж╖ржг-ржорзБржХрзНржд ржкржжрзНржзрждрж┐ржпрж╝рзЗ ржмрж┐ржЪрзНржЫрж┐ржирзНржи ржХрз░рж╛ ржЗржирж╖рзНржЯрзЗржирзНрж╕рж╕ржорзВрж╣ ржжрзЗржЦрзБрз▒рж╛ржпрж╝ред

ржоржиржд рз░рж╛ржЦрж┐ржм ржпрзЗ, ржПржЗ ржЙржжрж╛рж╣рз░ржгржд ржЖржорж┐ `few_shot_classes` ржмрж┐ржнрж╛ржЬржи ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐ ржЖржЫрзЛржБ, рж╕рзЗржЗржмрж╛ржмрзЗ, ржЖржорж┐ ржХрзЗрз▒рж▓ ржПржЗ ржмрж┐ржнрж╛ржЬржирз░ рж╢рзНрз░рзЗржгрзАрж╕ржорзВрж╣рз░ ржмрж┐ржЪрзНржЫрж┐ржирзНржи ржЗржирж╖рзНржЯрзЗржирзНрж╕рж╕ржорзВрж╣рж╣рзЗ ржЖрж╢рж╛ ржХрз░рж┐ржм рж▓рж╛ржЧрж┐ржм (COCO-рз░ рж╕ржХрж▓рзЛ рж╢рзНрз░рзЗржгрзА ржирж╣ржпрж╝)ред

#### ржлрж▓рж╛ржлрж▓рж╕ржорзВрж╣

ржнрзЗрж▓рж┐ржбрзЗрж╢рзНржпржи ржЫрзЗржЯрз░ рж╕ржХрж▓рзЛ ржЫржмрж┐ ржЪрж▓рзЛрз▒рж╛рз░ ржкрж╛ржЫржд, ржЖржкрзЛржирж╛рз░ рж▓рж╛ржн рж╣'ржм:

```
BBOX RESULTS:
  Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.368

SEGM RESULTS:
  Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.342
```
---

## ЁЯФН ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯ

ржЖржорж╛рз░ ржкрж╛ржЗржкрж▓рж╛ржЗржиржЯрзЛ ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯржд ржХрзЗржирзЗржжрз░рзЗ ржЪрж▓рж╛ржм ржкрж╛рз░рж┐ рждрж╛рз░ ржирж┐рз░рзНржжрзЗрж╢ржирж╛ ржЖржорж┐ ржжрж┐ржпрж╝рж╛ рж╣рзИржЫрзЗред ржПржирзЛржЯрзЗрж╢рзНржмржи ржлрз░рзНржорзЗржЯ рж╕ржжрж╛ржпрж╝ COCO ржлрз░рзНржорзЗржЯржд рж╣'ржм рж▓рж╛ржЧрзЗред

> **TLDR;** *ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯ* ржд рж╕ржорзНржкрзВрз░рзНржг ржкрж╛ржЗржкрж▓рж╛ржЗржи ржХрзЗржирзЗржжрз░рзЗ ржЪрж▓рж╛ржм ржкрж╛рз░рж┐ рж╕рзЗржпрж╝рж╛ рж╕рзЛржЬрж╛ржХрзИ ржЪрж╛ржмрж▓рзИ `scripts/matching_cdfsod_pipeline.sh` ржЖрз░рзБ CD-FSOD ржбрзЗржЯрж╛ржЪрзЗржЯрз░ ржЙржжрж╛рж╣рз░ржг рж╕рзНржХрзНрз░рж┐ржкрзНржЯ (ржпрзЗржирзЗ `scripts/dior_fish.sh`) ржЪрж╛ржУржХ

### 0. ржПржЯрж╛ ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯ ржкрзНрз░рж╕рзНрждрзБржд ржХрз░ржХ тЫ╡ЁЯРж

ржЪрж╛ржУржБ ржЖрж╣ржХ ржЖржорж┐ ржХрж▓рзНржкржирж╛ ржХрз░рзЛржБ ржпрзЗ ржЖржорж┐ ржПржЯрж╛ ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯржд **ржирж╛ржУ**тЫ╡ ржЖрз░рзБ **ржЪрз░рж╛ржЗ**ЁЯРж ржЪрж┐ржирж╛ржХрзНржд ржХрз░рж┐ржм ржмрж┐ржЪрж╛рз░рж┐ржЫрзЛред ржЖржорж╛рз░ ржкржжрзНржзрждрж┐ ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐ржмрж▓рзИ ржЖржкрзЛржирж╛рз░ ржкрзНрз░ржпрж╝рзЛржЬржи рж╣'ржм:
- ржкрзНрз░рждрж┐ржЯрзЛ рж╢рзНрз░рзЗржгрзАрз░ ржмрж╛ржмрзЗ ржХржорзЗржУ рзз ржЯрж╛ *ржПржирзЛржЯрзЗржЯрзЗржб* рз░рзЗржлрж╛рз░рзЗржирзНрж╕ ржЪрж┐рждрзНрз░ (ржЕрз░рзНржерж╛рзО ржирж╛ржУрз░ ржмрж╛ржмрзЗ рзз ржЯрж╛ ржЖрз░рзБ ржЪрз░рж╛ржЗрз░ ржмрж╛ржмрзЗ рзз ржЯрж╛ рз░рзЗржлрж╛рз░рзЗржирзНрж╕ ржЪрж┐рждрзНрз░)
- ржЖржорж╛рз░ ржЗржЪрзНржЫрж╛ ржХрз░рж╛ рж╢рзНрз░рзЗржгрзАрз░ ржЙржжрж╛рж╣рз░ржг ржмрж┐ржЪрж╛рз░рж┐ ржЙрж▓рж┐ржпрж╝рж╛ржмрж▓рзИ ржмрж╣рзБрждрзЛ рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░ред

ржЖржорж┐ coco images ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐ ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯ рждрзИржпрж╝рж╛рз░ ржХрз░рж┐ржмрж▓рзИ ржПржЯрж╛ рж╕рж╛ржзрж╛рз░ржг рж╕рзНржХрзНрз░рж┐ржкрзНржЯ ржкрзНрз░рж╕рзНрждрзБржд ржХрз░рж┐ржЫрзЛ, **1-shot** ржЫрзЗржЯрж┐ржВрз░ ржмрж╛ржмрзЗред
```bash
mkdir -p data/my_custom_dataset
python scripts/make_custom_dataset.py
```
ржПржЗржЯрзЛ рждрж▓ржд ржжрж┐ржпрж╝рж╛ ржлрзЛрж▓рзНржбрж╛рз░ ржЧржаржиржЯрзЛрж╕рж╣ ржПржЯрж╛ ржХрж╛рж╖рзНржЯржо ржбрзЗржЯрж╛ржЪрзЗржЯ рж╕рзГрж╖рзНржЯрж┐ ржХрз░рж┐ржм:
```
data/my_custom_dataset/
    тФЬтФАтФА annotations/
    тФВ   тФЬтФАтФА custom_references.json
    тФВ   тФЬтФАтФА custom_targets.json
    тФВ   тФФтФАтФА references_visualisations/
    тФВ       тФЬтФАтФА bird_1.jpg
    тФВ       тФФтФАтФА boat_1.jpg
    тФФтФАтФА images/
        тФЬтФАтФА 429819.jpg
        тФЬтФАтФА 101435.jpg
        тФФтФАтФА (all target and reference images)
```
**рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░рз░ ржнрж┐ржЬрзБрз▒рзЗрж▓рж╛ржЗржЬрзЗржЪржи (рзз-рж╢рзНржмржЯ):**

| ржЪрз░рж╛ржЗрз░ ржмрж╛ржмрзЗ рзз-рж╢рзНржмржЯ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░ ЁЯРж | ржирж╛ржУрз░ ржмрж╛ржмрзЗ рзз-рж╢рзНржмржЯ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░ тЫ╡ |
|:----------------------------------:|:-----------------------------------:|
| <img src="https://github.com/user-attachments/assets/e59e580d-a7db-42ac-b386-892af211fc85" alt="bird_1" width="500"/> | <img src="https://github.com/user-attachments/assets/f94ee025-ae37-4a45-9c3e-0cfe8f8cd2bc" alt="boat_1" width="500"/> |


### рзж.рзз ржХрзЗрз▒рж▓ bbox ржПржи'ржЯрзЗрж╢рзНржпржи ржЙржкрж▓ржмрзНржз ржерж╛ржХрж┐рж▓рзЗ

ржЖржорж┐ржпрж╝рзЗ SAM2 ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐ ржЗржирж╖рзНржЯрзЗржирзНрж╕-рж▓рзЗржнрзЗрж▓ ржЫрзЗржЧржорзЗржгрзНржЯрзЗрж╢рзНржпржи ржорж╛рж╕рзНржХ рж╕рзГрж╖рзНржЯрж┐ ржХрз░рж╛рз░ ржмрж╛ржмрзЗ ржПржЯрж╛ рж╕рзНржХрзНрз░рж┐ржкрзНржЯрзЛ ржкрзНрз░ржжрж╛ржи ржХрз░рзЛржБред ржПржЗржЯрзЛ ржЙржкржпрзЛржЧрзА, ржпржжрж┐ ржЖржкрзБржирж┐ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░рж╕ржорзВрж╣рз░ ржмрж╛ржмрзЗ ржХрзЗрз▒рж▓ ржмрж╛ржЙржгрзНржбрж┐ржВ ржмржХрзНрж╕ ржПржи'ржЯрзЗрж╢рзНржпржирж╣рзЗ ржЙржкрж▓ржмрзНржз рз░рж╛ржЦрзЗред


```bash
# Download sam_h checkpoint. Feel free to use more recent checkpoints (note: code might need to be adapted)
wget https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth -O checkpoints/sam_vit_h_4b8939.pth
# Run automatic instance segmentation from ground truth bounding boxes.
python no_time_to_train/dataset/sam_bbox_to_segm_batch.py \
    --input_json data/my_custom_dataset/annotations/custom_references.json \
    --image_dir data/my_custom_dataset/images \
    --sam_checkpoint checkpoints/sam_vit_h_4b8939.pth \
    --model_type vit_h \
    --device cuda \
    --batch_size 8 \
    --visualize
```
**ржЗржирж╖рзНржЯрзЗржирзНрж╕-рж╕рзНрждрз░рз░ ржЫрзЗржЧржорзЗржирзНржЯрзЗрж╢рзНржмржи ржорж╛ржХрзНрж╕ ржержХрж╛ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░рж╕ржорзВрж╣ (gt ржмрж╛ржЙржгрзНржбрж┐ржВ ржмржХрзНрж╕рз░ ржкрз░рж╛ SAM2 ржжрзНржмрж╛рз░рж╛ ржЙрзОржкржирзНржи, рзз-рж╢рзНржмржЯ):**

ржЙрзОржкржирзНржи ржХрз░рж╛ ржЫрзЗржЧржорзЗржирзНржЯрзЗрж╢рзНржмржи ржорж╛ржХрзНрж╕рз░ ржнрж┐ржЬрзБрз▒рж╛рж▓рж╛ржЗржЬрзЗржЪржи `data/my_custom_dataset/annotations/custom_references_with_SAM_segm/references_visualisations/` ржд рж╕ржВрз░ржХрзНрж╖ржг ржХрз░рж╛ рж╣рзИржЫрзЗред

| ржЪрз░рж╛ржЗрз░ ржмрж╛ржмрзЗ рзз-рж╢рзНржмржЯ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░ ЁЯРж (рж╕рзНржмржпрж╝ржВржХрзНрз░рж┐ржпрж╝ржнрж╛рз▒рзЗ SAM ржжрзНржмрж╛рз░рж╛ ржЫрзЗржЧржорзЗржирзНржЯ ржХрз░рж╛) | ржирж╛ржУрз░ ржмрж╛ржмрзЗ рзз-рж╢рзНржмржЯ рз░рзЗржлрж╛рз░рзЗржЮрзНржЪ ржЪрж┐рждрзНрз░ тЫ╡ (рж╕рзНржмржпрж╝ржВржХрзНрз░рж┐ржпрж╝ржнрж╛рз▒рзЗ SAM ржжрзНржмрж╛рз░рж╛ ржЫрзЗржЧржорзЗржирзНржЯ ржХрз░рж╛) |
|:---------------------------------:|:----------------------------------:|
| <img src="https://github.com/user-attachments/assets/65d38dc4-1454-43cd-9600-e8efc67b3a82" alt="bird_1_with_SAM_segm" width="500"/> | <img src="https://github.com/user-attachments/assets/43a558ad-50ca-4715-8285-9aa3268843c6" alt="boat_1_with_SAM_segm" width="500"/> |


### рзж.рзи ржХрзЛржХрзЛ ржПржирзЛржЯрзЗрж╢рзНржмржирж╕ржорзВрж╣ ржкрж┐ржХрж▓ ржлрж╛ржЗрж▓рж▓рзИ рз░рзВржкрж╛ржирзНрждрз░ ржХрз░рж╛



```bash
python no_time_to_train/dataset/coco_to_pkl.py \
    data/my_custom_dataset/annotations/custom_references_with_segm.json \
    data/my_custom_dataset/annotations/custom_references_with_segm.pkl \
    1
```

### рзз. рз░рзЗржлрж╛рз░рзЗржирзНрж╕рз░ рж╕рзИрждрзЗ ржорзЗржо'рз░рж┐ ржкрзВрз░ржг ржХрз░ржХ

ржкрзНрз░ржержорзЗ, ржЙржкржпрзЛржЧрзА ржнрзЗрз░рж┐ржпрж╝рзЗржмрж▓ рж╕ржВржЬрзНржЮрж╛ ржХрз░ржХ ржЖрз░рзБ ржлрж▓рж╛ржлрж▓рж╕ржорзВрж╣рз░ ржмрж╛ржмрзЗ ржПржЯрж╛ ржл'рж▓рзНржбрж╛рз░ рж╕рзГрж╖рзНржЯрж┐ ржХрз░ржХред рж▓рзЗржмрзЗрж▓рж╕ржорзВрж╣ рж╕ржарж┐ржХржнрж╛рз▒рзЗ ржжрзГрж╢рзНржпрж╛ржпрж╝рж┐ржд рж╣рзЛрз▒рж╛рз░ ржмрж╛ржмрзЗ, рж╢рзНрз░рзЗржгрзА ржирж╛ржорж╕ржорзВрж╣ ржХрзЗржЯрзЗржЧрз░рж┐ ржЖржЗ.ржбрж┐. ржЕржирзБрж╕рз░рж┐ json ржлрж╛ржЗрж▓ржд ржпрж┐ ржЕржирзБрж╕рз░рж┐ ржерж╛ржХрзЗ рж╕рзЗржЗ ржЕржирзБрж╕рж╛рз░рзЗ рж╕ржЬрзНржЬрж┐ржд рж╣'ржм рж▓рж╛ржЧрж┐ржмред ржпрзЗржирзЗ, `bird`-рз░ ржХрзЗржЯрзЗржЧрз░рж┐ ржЖржЗ.ржбрж┐. рж╣рзИржЫрзЗ `16`, `boat`-рз░ ржХрзЗржЯрзЗржЧрз░рж┐ ржЖржЗ.ржбрж┐. рж╣рзИржЫрзЗ `9`ред рж╕рзЗржЗржмрж╛ржмрзЗ, `CAT_NAMES=boat,bird`ред

```bash
DATASET_NAME=my_custom_dataset
DATASET_PATH=data/my_custom_dataset
CAT_NAMES=boat,bird
CATEGORY_NUM=2
SHOT=1
YAML_PATH=no_time_to_train/pl_configs/matching_cdfsod_template.yaml
PATH_TO_SAVE_CKPTS=./tmp_ckpts/my_custom_dataset
mkdir -p $PATH_TO_SAVE_CKPTS
```

ржзрж╛ржк рзз ржЪрж▓рж╛ржУ:
```bash
python run_lightening.py test --config $YAML_PATH \
    --model.test_mode fill_memory \
    --out_path $PATH_TO_SAVE_CKPTS/$DATASET_NAME\_$SHOT\_refs_memory.pth \
    --model.init_args.dataset_cfgs.fill_memory.root $DATASET_PATH/images \
    --model.init_args.dataset_cfgs.fill_memory.json_file $DATASET_PATH/annotations/custom_references_with_segm.json \
    --model.init_args.dataset_cfgs.fill_memory.memory_pkl $DATASET_PATH/annotations/custom_references_with_segm.pkl \
    --model.init_args.dataset_cfgs.fill_memory.memory_length $SHOT \
    --model.init_args.dataset_cfgs.fill_memory.cat_names $CAT_NAMES \
    --model.init_args.model_cfg.dataset_name $DATASET_NAME \
    --model.init_args.model_cfg.memory_bank_cfg.length $SHOT \
    --model.init_args.model_cfg.memory_bank_cfg.category_num $CATEGORY_NUM \
    --trainer.devices 1
```

### 2. ржкрзЛрж╖рзНржЯ-ржкрзНрз░рж╕рзЗржЫ ржорзЗржорз░рж┐ ржмрзЗржВржХ

```bash
python run_lightening.py test --config $YAML_PATH \
    --model.test_mode postprocess_memory \
    --ckpt_path $PATH_TO_SAVE_CKPTS/$DATASET_NAME\_$SHOT\_refs_memory.pth \
    --out_path $PATH_TO_SAVE_CKPTS/$DATASET_NAME\_$SHOT\_refs_memory_postprocessed.pth \
    --model.init_args.model_cfg.dataset_name $DATASET_NAME \
    --model.init_args.model_cfg.memory_bank_cfg.length $SHOT \
    --model.init_args.model_cfg.memory_bank_cfg.category_num $CATEGORY_NUM \
    --trainer.devices 1
```

#### 2.1 ржкрзНрз░рж╕рзЗрж╕ рж╣рзЛрз▒рж╛рз░ ржкрж╛ржЫржд ржорзЗржорз░рж┐ ржмрзЗржВржХ ржжрз░рзНрж╢ржи ржХрз░ржХ

```bash
python run_lightening.py test --config $YAML_PATH \
    --model.test_mode vis_memory \
    --ckpt_path $PATH_TO_SAVE_CKPTS/$DATASET_NAME\_$SHOT\_refs_memory_postprocessed.pth \
    --model.init_args.dataset_cfgs.fill_memory.root $DATASET_PATH/images \
    --model.init_args.dataset_cfgs.fill_memory.json_file $DATASET_PATH/annotations/custom_references_with_segm.json \
    --model.init_args.dataset_cfgs.fill_memory.memory_pkl $DATASET_PATH/annotations/custom_references_with_segm.pkl \
    --model.init_args.dataset_cfgs.fill_memory.memory_length $SHOT \
    --model.init_args.dataset_cfgs.fill_memory.cat_names $CAT_NAMES \
    --model.init_args.model_cfg.dataset_name $DATASET_NAME \
    --model.init_args.model_cfg.memory_bank_cfg.length $SHOT \
    --model.init_args.model_cfg.memory_bank_cfg.category_num $CATEGORY_NUM \
    --trainer.devices 1
```
ржорзЗржорз░рж┐ ржмрзЗржВржХ ржЫржмрж┐рж╕ржорзВрж╣рз░ ржмрж╛ржмрзЗ PCA ржЖрз░рзБ K-means ржнрж┐ржЬрзБрз▒рж╛рж▓рж╛ржЗржЬрзЗрж╢рзНржмржирж╕ржорзВрж╣ `results_analysis/memory_vis/my_custom_dataset`-ржд рж╕ржВрз░ржХрзНрж╖рж┐ржд ржЖржЫрзЗред

### рзй. рж▓ржХрзНрж╖рзНржп ржЫржмрж┐рж╕ржорзВрж╣ржд ржЗржиржлрж╛рз░рзЗржирзНрж╕

ржпржжрж┐ `ONLINE_VIS` True-ржд ржЫрзЗржЯ ржХрз░рж╛ рж╣ржпрж╝, рждрзЗржирзНрждрзЗ ржкрзВрз░рзНржмрж╛ржирзБржорж╛ржи ржлрж▓рж╛ржлрж▓рж╕ржорзВрж╣ `results_analysis/my_custom_dataset/`-ржд рж╕ржВрз░ржХрзНрж╖ржг ржХрз░рж╛ рж╣'ржм ржЖрз░рзБ ржЧржгржирж╛ ржХрз░рж╛рз░ рж▓ржЧрзЗ рж▓ржЧрзЗ ржкрзНрз░ржжрж░рзНрж╢рж┐ржд рж╣'ржмред ржоржиржд рз░рж╛ржЦрж┐ржм ржпрзЗ ржЕржирж▓рж╛ржЗржи ржнрж┐ржЬрзБрз▒рж╛рж▓рж╛ржЗржЬрзЗрж╢рзНржмржи ржЪрж▓рж╛ржЗ ржержХрж╛рз░ рж╕ржоржпрж╝ржд ржЧрждрж┐ ржпржерзЗрж╖рзНржЯ ржХржорж┐ ржпрж╛ржпрж╝ред

ржЖржкрзБржирж┐ ржЗржЪрзНржЫрж╛ ржХрз░рж┐рж▓рзЗ рж╕рзНржХ'рз░ ржерзНрз░рзЗржЫрж╣'рж▓рзНржб `VIS_THR` ржкрз░рж┐ржмрз░рзНрждржи ржХрз░рж┐ржм ржкрж╛рз░рзЗ, ржпрж╛рждрзЗ ржЕржзрж┐ржХ ржмрж╛ ржХржо ржЫрзЗржЧржорзЗржгрзНржЯ ржХрз░рж╛ ржЗржирж╖рзНржЯрзЗржирзНрж╕ ржжрзЗржЦрж┐ржмрж▓рзИ ржкрж╛ржпрж╝ред
```bash
ONLINE_VIS=True
VIS_THR=0.4
python run_lightening.py test --config $YAML_PATH \
    --model.test_mode test \
    --ckpt_path $PATH_TO_SAVE_CKPTS/$DATASET_NAME\_$SHOT\_refs_memory_postprocessed.pth \
    --model.init_args.model_cfg.dataset_name $DATASET_NAME \
    --model.init_args.model_cfg.memory_bank_cfg.length $SHOT \
    --model.init_args.model_cfg.memory_bank_cfg.category_num $CATEGORY_NUM \
    --model.init_args.model_cfg.test.imgs_path $DATASET_PATH/images \
    --model.init_args.model_cfg.test.online_vis $ONLINE_VIS \
    --model.init_args.model_cfg.test.vis_thr $VIS_THR \
    --model.init_args.dataset_cfgs.test.root $DATASET_PATH/images \
    --model.init_args.dataset_cfgs.test.json_file $DATASET_PATH/annotations/custom_targets.json \
    --model.init_args.dataset_cfgs.test.cat_names $CAT_NAMES \
    --trainer.devices 1
```

### ржлрж▓рж╛ржлрж▓

ржХрж╛рз░рзНржпрж╕ржорзНржкрж╛ржжржи ржорзЗржЯрзНрз░рж┐ржХрзНрж╕ (ржУржкрз░рз░ ржирж┐рз░рзНржжрзЗрж╢ржирж╛рж╕ржорзВрж╣рз░ ржПржХрзЗ ржПржХрзЗ ржкрз░рж╛ржорж┐рждрзНрз░рз░рзЗ) рж╣'ржм рж▓рж╛ржЧрж┐ржм:

```
BBOX RESULTS:
  Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.478

SEGM RESULTS:
  Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.458
```

ржжрзГрж╢рзНржпржорж╛ржи ржлрж▓рж╛ржлрж▓рж╕ржорзВрж╣ `results_analysis/my_custom_dataset/`-ржд рж╕ржВрз░ржХрзНрж╖рж┐ржд рж╣ржпрж╝ред рж▓ржХрзНрж╖рзНржп ржХрз░ржХ ржпрзЗ, ржЖржорж╛рз░ ржкржжрзНржзрждрж┐ржЯрзЛ ржорж┐ржЫрж╛ ржЛржгрж╛рждрзНржоржХрж╕ржорзВрж╣рз░ ржмрж╛ржмрзЗ ржХрж╛ржо ржХрз░рзЗ, ржЕрз░рзНржерж╛рзО, рж╕рзЗржЗрж╕ржХрж▓ ржЪрж┐рждрзНрз░ ржптАЩржд ржкрзНрз░ржпрж╝рзЛржЬржирзАржпрж╝ рж╢рзНрз░рзЗржгрзАрж╕ржорзВрж╣рз░ ржХрзЛржирзЛ ржЙржжрж╛рж╣рз░ржг ржирж╛ржерж╛ржХрзЗред

*ржЪрж┐рждрзНрз░рж╕ржорзВрж╣ ржбрж╛ржЩрз░ ржХрз░рж┐ржмрж▓рзИ ржХрзНрж▓рж┐ржХ ржХрз░ржХ тмЗя╕П*

| ржирзМржХрж╛ ржержХрж╛ рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░ тЫ╡ (ржмрж╛ржУржБржлрж╛рж▓рзЗ GT, рж╕рзЛржБржлрж╛рж▓рзЗ ржЕржирзБржорж╛ржи) | ржЪрз░рж╛ржЗ ржержХрж╛ рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░ ЁЯРж (ржмрж╛ржУржБржлрж╛рж▓рзЗ GT, рж╕рзЛржБржлрж╛рж▓рзЗ ржЕржирзБржорж╛ржи) |
|:----------------------:|:----------------------:|
| ![000000459673](https://github.com/user-attachments/assets/678dc15a-dd3b-49d5-9287-6290da16aa6b) | ![000000407180](https://github.com/user-attachments/assets/fe306e48-af49-4d83-ac82-76fac6c456d1) |

| ржирзМржХрж╛ ржЖрз░рзБ ржЪрз░рж╛ржЗ ржержХрж╛ рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░ тЫ╡ЁЯРж (ржмрж╛ржУржБржлрж╛рж▓рзЗ GT, рж╕рзЛржБржлрж╛рж▓рзЗ ржЕржирзБржорж╛ржи) | ржирзМржХрж╛ ржмрж╛ ржЪрз░рж╛ржЗ ржиржержХрж╛ рж▓ржХрзНрж╖рзНржп ржЪрж┐рждрзНрз░ ЁЯЪл (ржмрж╛ржУржБржлрж╛рж▓рзЗ GT, рж╕рзЛржБржлрж╛рж▓рзЗ ржЕржирзБржорж╛ржи) |
|:---------------------------------:|:----------------------------------:|
| ![000000517410](https://github.com/user-attachments/assets/9849b227-7f43-43d7-81ea-58010a623ad5) | ![000000460598](https://github.com/user-attachments/assets/7587700c-e09d-4cf6-8590-3df129c2568e) |


## ЁЯУЪ ржЙржжрзНржзрзГрждрж┐

ржЖржкрзБржирж┐ ржПржЗ ржХрж╛ржо ржмрзНржпрз▒рж╣рж╛рз░ ржХрз░рж┐рж▓рзЗ, ржЕржирзБржЧрзНрз░рж╣ ржХрз░рж┐ ржЖржорж╛ржХ ржЙржжрзНржзрзГрждрж┐ ржжрж┐ржпрж╝ржХ:

```bibtex
@article{espinosa2025notimetotrain,
  title={No time to train! Training-Free Reference-Based Instance Segmentation},
  author={Miguel Espinosa and Chenhongyi Yang and Linus Ericsson and Steven McDonagh and Elliot J. Crowley},
  journal={arXiv preprint arXiv:2507.02798},
  year={2025},
  primaryclass={cs.CV}
}
```


---

Tranlated By [Open Ai Tx](https://github.com/OpenAiTx/OpenAiTx) | Last indexed: 2026-01-15

---